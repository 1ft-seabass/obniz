"use strict";
const WSCommand = require('./WSCommand.js').default;
class WSCommandTcp extends WSCommand {
    constructor() {
        super();
        this.module = 13;
        this._MaxPort = 8;
        this._CommandConnect = 0;
        this._CommandClose = 1;
        //Notification
        this._CommandConnection = 2;
        this._CommandWrite = 3;
        //Notification
        this._CommandRead = 4;
    }
    connect(params, index) {
        let domain = new Uint8Array(Buffer.from(params.connect.domain, 'utf8'));
        let buf = new Uint8Array(domain.length + 3);
        buf[0] = index;
        buf[1] = 0xff && params.connect.port >> 8;
        buf[2] = 0xff && params.connect.port;
        for (let i = 0; i < domain.length; i++) {
            buf[3 + i] = domain[i];
        }
        this.sendCommand(this._CommandConnect, buf);
    }
    disconnect(params, index) {
        let buf = new Uint8Array([index]);
        this.sendCommand(this._CommandClose, buf);
    }
    write(params, index) {
        let buf = new Uint8Array(params.write.data.length + 1);
        buf[0] = index;
        for (let i = 0; i < params.write.data.length; i++) {
            buf[1 + i] = params.write.data[i];
        }
        this.sendCommand(this._CommandWrite, buf);
    }
    parseFromJson(json) {
        for (let i = 0; i < this._MaxPort; i++) {
            let module = json['tcp' + i];
            if (module === undefined) {
                continue;
            }
            let schemaData = [
                { uri: '/request/tcp/connect', onValid: this.connect },
                { uri: '/request/tcp/disconnect', onValid: this.disconnect },
                { uri: '/request/tcp/write', onValid: this.write },
            ];
            let res = this.validateCommandSchema(schemaData, module, 'tcp' + i, i);
            if (res.valid === 0) {
                if (res.invalidButLike.length > 0) {
                    throw new Error(res.invalidButLike[0].message);
                }
                else {
                    throw new this.WSCommandNotFoundError(`[tcp${i}]unknown command`);
                }
            }
        }
    }
    notifyFromBinary(objToSend, func, payload) {
        switch (func) {
            case this._CommandConnect: {
                let state = 'Error';
                switch (payload[1]) {
                    case 0:
                        state = 'ok';
                        break;
                    case 1:
                        state = 'Port Used';
                        break;
                    case 2:
                        state = 'Port Area Error';
                        break;
                    case 3:
                        state = 'Lookup Error';
                        break;
                    case 4:
                        state = 'Error';
                        break;
                }
                let module_index = payload[0];
                objToSend['tcp' + module_index] = {
                    connect: {
                        message: state,
                        code: payload[1],
                    },
                };
                break;
            }
            case this._CommandConnection:
                if (payload.length === 2 && payload[1] === 0) {
                    let module_index = payload[0];
                    objToSend['tcp' + module_index] = {
                        connection: {
                            connected: true,
                        },
                    };
                }
                else {
                    let module_index = payload[0];
                    objToSend['tcp' + module_index] = {
                        connection: {
                            connected: false,
                        },
                    };
                }
                break;
            case this._CommandRead:
                if (payload.length >= 1) {
                    let module_index = payload[0];
                    let arr = new Array(payload.byteLength - 1);
                    for (let i = 0; i < arr.length; i++) {
                        arr[i] = payload[i + 1];
                    }
                    objToSend['tcp' + module_index] = {
                        read: {
                            data: arr,
                        },
                    };
                }
                break;
        }
    }
}
module.exports = WSCommandTcp;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vYm5pei9saWJzL3dzY29tbWFuZC9XU0NvbW1hbmRUY3AuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUVwRCxNQUFNLFlBQWEsU0FBUSxTQUFTO0lBQ2xDO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztRQUVsQixJQUFJLENBQUMsZUFBZSxHQUFHLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQztRQUN2QixjQUFjO1FBQ2QsSUFBSSxDQUFDLGtCQUFrQixHQUFHLENBQUMsQ0FBQztRQUM1QixJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQztRQUN2QixjQUFjO1FBQ2QsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUVELE9BQU8sQ0FBQyxNQUFNLEVBQUUsS0FBSztRQUNuQixJQUFJLE1BQU0sR0FBRyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDeEUsSUFBSSxHQUFHLEdBQUcsSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM1QyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO1FBQ2YsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUM7UUFDMUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztRQUNyQyxLQUFLLElB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QU8sQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO29CQUN2QixJQUFJLFlBQVksR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQzlCLElBQUksR0FBRyxHQUFHLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQzVDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO3dCQUNuQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztxQkFDekI7b0JBQ0QsU0FBUyxDQUFDLEtBQUssR0FBRyxZQUFZLENBQUMsR0FBRzt3QkFDaEMsSUFBSSxFQUFFOzRCQUNKLElBQUksRUFBRSxHQUFHO3lCQUNWO3FCQUNGLENBQUM7aUJBQ0g7Z0JBQ0QsTUFBTTtTQUNUO0lBQ0gsQ0FBQztDQUNGO0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxZQUFZLENBQUMiLCJmaWxlIjoib2JuaXovbGlicy93c2NvbW1hbmQvV1NDb21tYW5kVGNwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgV1NDb21tYW5kID0gcmVxdWlyZSgnLi9XU0NvbW1hbmQuanMnKS5kZWZhdWx0O1xuXG5jbGFzcyBXU0NvbW1hbmRUY3AgZXh0ZW5kcyBXU0NvbW1hbmQge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMubW9kdWxlID0gMTM7XG4gICAgdGhpcy5fTWF4UG9ydCA9IDg7XG5cbiAgICB0aGlzLl9Db21tYW5kQ29ubmVjdCA9IDA7XG4gICAgdGhpcy5fQ29tbWFuZENsb3NlID0gMTtcbiAgICAvL05vdGlmaWNhdGlvblxuICAgIHRoaXMuX0NvbW1hbmRDb25uZWN0aW9uID0gMjtcbiAgICB0aGlzLl9Db21tYW5kV3JpdGUgPSAzO1xuICAgIC8vTm90aWZpY2F0aW9uXG4gICAgdGhpcy5fQ29tbWFuZFJlYWQgPSA0O1xuICB9XG5cbiAgY29ubmVjdChwYXJhbXMsIGluZGV4KSB7XG4gICAgbGV0IGRvbWFpbiA9IG5ldyBVaW50OEFycmF5KEJ1ZmZlci5mcm9tKHBhcmFtcy5jb25uZWN0LmRvbWFpbiwgJ3V0ZjgnKSk7XG4gICAgbGV0IGJ1ZiA9IG5ldyBVaW50OEFycmF5KGRvbWFpbi5sZW5ndGggKyAzKTtcbiAgICBidWZbMF0gPSBpbmRleDtcbiAgICBidWZbMV0gPSAweGZmICYmIHBhcmFtcy5jb25uZWN0LnBvcnQgPj4gODtcbiAgICBidWZbMl0gPSAweGZmICYmIHBhcmFtcy5jb25uZWN0LnBvcnQ7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkb21haW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgIGJ1ZlszICsgaV0gPSBkb21haW5baV07XG4gICAgfVxuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZENvbm5lY3QsIGJ1Zik7XG4gIH1cblxuICBkaXNjb25uZWN0KHBhcmFtcywgaW5kZXgpIHtcbiAgICBsZXQgYnVmID0gbmV3IFVpbnQ4QXJyYXkoW2luZGV4XSk7XG4gICAgdGhpcy5zZW5kQ29tbWFuZCh0aGlzLl9Db21tYW5kQ2xvc2UsIGJ1Zik7XG4gIH1cblxuICB3cml0ZShwYXJhbXMsIGluZGV4KSB7XG4gICAgbGV0IGJ1ZiA9IG5ldyBVaW50OEFycmF5KHBhcmFtcy53cml0ZS5kYXRhLmxlbmd0aCArIDEpO1xuICAgIGJ1ZlswXSA9IGluZGV4O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFyYW1zLndyaXRlLmRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGJ1ZlsxICsgaV0gPSBwYXJhbXMud3JpdGUuZGF0YVtpXTtcbiAgICB9XG4gICAgdGhpcy5zZW5kQ29tbWFuZCh0aGlzLl9Db21tYW5kV3JpdGUsIGJ1Zik7XG4gIH1cblxuICBwYXJzZUZyb21Kc29uKGpzb24pIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX01heFBvcnQ7IGkrKykge1xuICAgICAgbGV0IG1vZHVsZSA9IGpzb25bJ3RjcCcgKyBpXTtcbiAgICAgIGlmIChtb2R1bGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgbGV0IHNjaGVtYURhdGEgPSBbXG4gICAgICAgIHsgdXJpOiAnL3JlcXVlc3QvdGNwL2Nvbm5lY3QnLCBvblZhbGlkOiB0aGlzLmNvbm5lY3QgfSxcbiAgICAgICAgeyB1cmk6ICcvcmVxdWVzdC90Y3AvZGlzY29ubmVjdCcsIG9uVmFsaWQ6IHRoaXMuZGlzY29ubmVjdCB9LFxuICAgICAgICB7IHVyaTogJy9yZXF1ZXN0L3RjcC93cml0ZScsIG9uVmFsaWQ6IHRoaXMud3JpdGUgfSxcbiAgICAgIF07XG4gICAgICBsZXQgcmVzID0gdGhpcy52YWxpZGF0ZUNvbW1hbmRTY2hlbWEoc2NoZW1hRGF0YSwgbW9kdWxlLCAndGNwJyArIGksIGkpO1xuXG4gICAgICBpZiAocmVzLnZhbGlkID09PSAwKSB7XG4gICAgICAgIGlmIChyZXMuaW52YWxpZEJ1dExpa2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXMuaW52YWxpZEJ1dExpa2VbMF0ubWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IHRoaXMuV1NDb21tYW5kTm90Rm91bmRFcnJvcihgW3RjcCR7aX1ddW5rbm93biBjb21tYW5kYCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBub3RpZnlGcm9tQmluYXJ5KG9ialRvU2VuZCwgZnVuYywgcGF5bG9hZCkge1xuICAgIHN3aXRjaCAoZnVuYykge1xuICAgICAgY2FzZSB0aGlzLl9Db21tYW5kQ29ubmVjdDoge1xuICAgICAgICBsZXQgc3RhdGUgPSAnRXJyb3InO1xuICAgICAgICBzd2l0Y2ggKHBheWxvYWRbMV0pIHtcbiAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICBzdGF0ZSA9ICdvayc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICBzdGF0ZSA9ICdQb3J0IFVzZWQnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgc3RhdGUgPSAnUG9ydCBBcmVhIEVycm9yJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgIHN0YXRlID0gJ0xvb2t1cCBFcnJvcic7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICBzdGF0ZSA9ICdFcnJvcic7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBsZXQgbW9kdWxlX2luZGV4ID0gcGF5bG9hZFswXTtcbiAgICAgICAgb2JqVG9TZW5kWyd0Y3AnICsgbW9kdWxlX2luZGV4XSA9IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBtZXNzYWdlOiBzdGF0ZSxcbiAgICAgICAgICAgIGNvZGU6IHBheWxvYWRbMV0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIHRoaXMuX0NvbW1hbmRDb25uZWN0aW9uOlxuICAgICAgICBpZiAocGF5bG9hZC5sZW5ndGggPT09IDIgJiYgcGF5bG9hZFsxXSA9PT0gMCkge1xuICAgICAgICAgIGxldCBtb2R1bGVfaW5kZXggPSBwYXlsb2FkWzBdO1xuICAgICAgICAgIG9ialRvU2VuZFsndGNwJyArIG1vZHVsZV9pbmRleF0gPSB7XG4gICAgICAgICAgICBjb25uZWN0aW9uOiB7XG4gICAgICAgICAgICAgIGNvbm5lY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsZXQgbW9kdWxlX2luZGV4ID0gcGF5bG9hZFswXTtcbiAgICAgICAgICBvYmpUb1NlbmRbJ3RjcCcgKyBtb2R1bGVfaW5kZXhdID0ge1xuICAgICAgICAgICAgY29ubmVjdGlvbjoge1xuICAgICAgICAgICAgICBjb25uZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLl9Db21tYW5kUmVhZDpcbiAgICAgICAgaWYgKHBheWxvYWQubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICBsZXQgbW9kdWxlX2luZGV4ID0gcGF5bG9hZFswXTtcbiAgICAgICAgICBsZXQgYXJyID0gbmV3IEFycmF5KHBheWxvYWQuYnl0ZUxlbmd0aCAtIDEpO1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcnJbaV0gPSBwYXlsb2FkW2kgKyAxXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb2JqVG9TZW5kWyd0Y3AnICsgbW9kdWxlX2luZGV4XSA9IHtcbiAgICAgICAgICAgIHJlYWQ6IHtcbiAgICAgICAgICAgICAgZGF0YTogYXJyLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFdTQ29tbWFuZFRjcDtcbiJdfQ==
