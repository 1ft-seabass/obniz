"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const WSCommand_1 = __importDefault(require("./WSCommand"));
class WSCommandUart extends WSCommand_1.default {
    constructor() {
        super();
        this.module = 4;
        this._CommandInit = 0;
        this._CommandDeinit = 1;
        this._CommandSend = 2;
        this._CommandRecv = 3;
    }
    // Commands
    init(params, module) {
        const buf = new Uint8Array(13);
        buf[0] = module;
        buf[1] = parseInt(params.tx);
        buf[2] = parseInt(params.rx);
        buf[3] = params.baud >> (3 * 8);
        buf[4] = params.baud >> (2 * 8);
        buf[5] = params.baud >> (1 * 8);
        buf[6] = params.baud;
        if (params.stop === 1) {
            buf[7] = 1;
        }
        else if (params.stop === 1.5) {
            buf[7] = 2;
        }
        else if (params.stop === 2) {
            buf[7] = 3;
        }
        else if (params.stop === 0) {
            buf[7] = 0;
        }
        else {
            throw new Error("uart: invalid stop bits");
        }
        buf[8] = params.bits;
        if (params.parity === "even") {
            buf[9] = 2;
        }
        else if (params.parity === "odd") {
            buf[9] = 3;
        }
        if (params.flowcontrol === "rts") {
            buf[10] = 2;
        }
        else if (params.flowcontrol === "cts") {
            buf[10] = 3;
        }
        else if (params.flowcontrol === "rts-cts") {
            buf[10] = 4;
        }
        if (params.rts !== null) {
            buf[11] = params.rts;
        }
        if (params.cts !== null) {
            buf[12] = params.cts;
        }
        this.sendCommand(this._CommandInit, buf);
    }
    deinit(params, module) {
        const buf = new Uint8Array(1);
        buf[0] = module;
        this.sendCommand(this._CommandDeinit, buf);
    }
    send(params, module) {
        const buf = new Uint8Array(1 + params.data.length);
        buf[0] = module;
        buf.set(params.data, 1);
        this.sendCommand(this._CommandSend, buf);
    }
    parseFromJson(json) {
        // 0~2
        for (let i = 0; i < 3; i++) {
            const module = json["uart" + i];
            if (module === undefined) {
                continue;
            }
            const schemaData = [
                { uri: "/request/uart/init", onValid: this.init },
                { uri: "/request/uart/send", onValid: this.send },
                { uri: "/request/uart/deinit", onValid: this.deinit },
            ];
            const res = this.validateCommandSchema(schemaData, module, "uart" + i, i);
            if (res.valid === 0) {
                if (res.invalidButLike.length > 0) {
                    throw new Error(res.invalidButLike[0].message);
                }
                else {
                    throw new this.WSCommandNotFoundError(`[uart${i}]unknown command`);
                }
            }
        }
    }
    notifyFromBinary(objToSend, func, payload) {
        if (func === this._CommandRecv && payload.byteLength > 1) {
            const module_index = payload[0];
            const arr = new Array(payload.byteLength - 1);
            for (let i = 0; i < arr.length; i++) {
                arr[i] = payload[i + 1];
            }
            objToSend["uart" + module_index] = {
                data: arr,
            };
        }
        else {
            super.notifyFromBinary(objToSend, func, payload);
        }
    }
}
exports.default = WSCommandUart;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vYm5pei9saWJzL3dzY29tbWFuZC9XU0NvbW1hbmRVYXJ0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsNERBQW9DO0FBRXBDLE1BQU0sYUFBYyxTQUFRLG1CQUFTO0lBVW5DO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUVoQixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztRQUN0QixJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztRQUN0QixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBRUQsV0FBVztJQUVKLElBQUksQ0FBQyxNQUFXLEVBQUUsTUFBVztRQUNsQyxNQUFNLEdBQUcsR0FBUSxJQUFJLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDO1FBQ2hCLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzdCLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRTdCLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENB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RSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDbkMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7YUFDekI7WUFFRCxTQUFTLENBQUMsTUFBTSxHQUFHLFlBQVksQ0FBQyxHQUFHO2dCQUNqQyxJQUFJLEVBQUUsR0FBRzthQUNWLENBQUM7U0FDSDthQUFNO1lBQ0wsS0FBSyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FDbEQ7SUFDSCxDQUFDO0NBQ0Y7QUFFRCxrQkFBZSxhQUFhLENBQUMiLCJmaWxlIjoic3JjL29ibml6L2xpYnMvd3Njb21tYW5kL1dTQ29tbWFuZFVhcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgV1NDb21tYW5kIGZyb20gXCIuL1dTQ29tbWFuZFwiO1xuXG5jbGFzcyBXU0NvbW1hbmRVYXJ0IGV4dGVuZHMgV1NDb21tYW5kIHtcbiAgcHVibGljIG1vZHVsZTogYW55O1xuICBwdWJsaWMgX0NvbW1hbmRJbml0OiBhbnk7XG4gIHB1YmxpYyBfQ29tbWFuZERlaW5pdDogYW55O1xuICBwdWJsaWMgX0NvbW1hbmRTZW5kOiBhbnk7XG4gIHB1YmxpYyBfQ29tbWFuZFJlY3Y6IGFueTtcbiAgcHVibGljIHNlbmRDb21tYW5kOiBhbnk7XG4gIHB1YmxpYyB2YWxpZGF0ZUNvbW1hbmRTY2hlbWE6IGFueTtcbiAgcHVibGljIFdTQ29tbWFuZE5vdEZvdW5kRXJyb3I6IGFueTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMubW9kdWxlID0gNDtcblxuICAgIHRoaXMuX0NvbW1hbmRJbml0ID0gMDtcbiAgICB0aGlzLl9Db21tYW5kRGVpbml0ID0gMTtcbiAgICB0aGlzLl9Db21tYW5kU2VuZCA9IDI7XG4gICAgdGhpcy5fQ29tbWFuZFJlY3YgPSAzO1xuICB9XG5cbiAgLy8gQ29tbWFuZHNcblxuICBwdWJsaWMgaW5pdChwYXJhbXM6IGFueSwgbW9kdWxlOiBhbnkpIHtcbiAgICBjb25zdCBidWY6IGFueSA9IG5ldyBVaW50OEFycmF5KDEzKTtcbiAgICBidWZbMF0gPSBtb2R1bGU7XG4gICAgYnVmWzFdID0gcGFyc2VJbnQocGFyYW1zLnR4KTtcbiAgICBidWZbMl0gPSBwYXJzZUludChwYXJhbXMucngpO1xuXG4gICAgYnVmWzNdID0gcGFyYW1zLmJhdWQgPj4gKDMgKiA4KTtcbiAgICBidWZbNF0gPSBwYXJhbXMuYmF1ZCA+PiAoMiAqIDgpO1xuICAgIGJ1Zls1XSA9IHBhcmFtcy5iYXVkID4+ICgxICogOCk7XG4gICAgYnVmWzZdID0gcGFyYW1zLmJhdWQ7XG5cbiAgICBpZiAocGFyYW1zLnN0b3AgPT09IDEpIHtcbiAgICAgIGJ1Zls3XSA9IDE7XG4gICAgfSBlbHNlIGlmIChwYXJhbXMuc3RvcCA9PT0gMS41KSB7XG4gICAgICBidWZbN10gPSAyO1xuICAgIH0gZWxzZSBpZiAocGFyYW1zLnN0b3AgPT09IDIpIHtcbiAgICAgIGJ1Zls3XSA9IDM7XG4gICAgfSBlbHNlIGlmIChwYXJhbXMuc3RvcCA9PT0gMCkge1xuICAgICAgYnVmWzddID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwidWFydDogaW52YWxpZCBzdG9wIGJpdHNcIik7XG4gICAgfVxuXG4gICAgYnVmWzhdID0gcGFyYW1zLmJpdHM7XG5cbiAgICBpZiAocGFyYW1zLnBhcml0eSA9PT0gXCJldmVuXCIpIHtcbiAgICAgIGJ1Zls5XSA9IDI7XG4gICAgfSBlbHNlIGlmIChwYXJhbXMucGFyaXR5ID09PSBcIm9kZFwiKSB7XG4gICAgICBidWZbOV0gPSAzO1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMuZmxvd2NvbnRyb2wgPT09IFwicnRzXCIpIHtcbiAgICAgIGJ1ZlsxMF0gPSAyO1xuICAgIH0gZWxzZSBpZiAocGFyYW1zLmZsb3djb250cm9sID09PSBcImN0c1wiKSB7XG4gICAgICBidWZbMTBdID0gMztcbiAgICB9IGVsc2UgaWYgKHBhcmFtcy5mbG93Y29udHJvbCA9PT0gXCJydHMtY3RzXCIpIHtcbiAgICAgIGJ1ZlsxMF0gPSA0O1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMucnRzICE9PSBudWxsKSB7XG4gICAgICBidWZbMTFdID0gcGFyYW1zLnJ0cztcbiAgICB9XG4gICAgaWYgKHBhcmFtcy5jdHMgIT09IG51bGwpIHtcbiAgICAgIGJ1ZlsxMl0gPSBwYXJhbXMuY3RzO1xuICAgIH1cblxuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZEluaXQsIGJ1Zik7XG4gIH1cblxuICBwdWJsaWMgZGVpbml0KHBhcmFtczogYW55LCBtb2R1bGU6IGFueSkge1xuICAgIGNvbnN0IGJ1ZjogYW55ID0gbmV3IFVpbnQ4QXJyYXkoMSk7XG4gICAgYnVmWzBdID0gbW9kdWxlO1xuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZERlaW5pdCwgYnVmKTtcbiAgfVxuXG4gIHB1YmxpYyBzZW5kKHBhcmFtczogYW55LCBtb2R1bGU6IGFueSkge1xuICAgIGNvbnN0IGJ1ZjogYW55ID0gbmV3IFVpbnQ4QXJyYXkoMSArIHBhcmFtcy5kYXRhLmxlbmd0aCk7XG4gICAgYnVmWzBdID0gbW9kdWxlO1xuICAgIGJ1Zi5zZXQocGFyYW1zLmRhdGEsIDEpO1xuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZFNlbmQsIGJ1Zik7XG4gIH1cblxuICBwdWJsaWMgcGFyc2VGcm9tSnNvbihqc29uOiBhbnkpIHtcbiAgICAvLyAwfjJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgY29uc3QgbW9kdWxlOiBhbnkgPSBqc29uW1widWFydFwiICsgaV07XG4gICAgICBpZiAobW9kdWxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBzY2hlbWFEYXRhOiBhbnkgPSBbXG4gICAgICAgIHt1cmk6IFwiL3JlcXVlc3QvdWFydC9pbml0XCIsIG9uVmFsaWQ6IHRoaXMuaW5pdH0sXG4gICAgICAgIHt1cmk6IFwiL3JlcXVlc3QvdWFydC9zZW5kXCIsIG9uVmFsaWQ6IHRoaXMuc2VuZH0sXG4gICAgICAgIHt1cmk6IFwiL3JlcXVlc3QvdWFydC9kZWluaXRcIiwgb25WYWxpZDogdGhpcy5kZWluaXR9LFxuICAgICAgXTtcbiAgICAgIGNvbnN0IHJlczogYW55ID0gdGhpcy52YWxpZGF0ZUNvbW1hbmRTY2hlbWEoc2NoZW1hRGF0YSwgbW9kdWxlLCBcInVhcnRcIiArIGksIGkpO1xuXG4gICAgICBpZiAocmVzLnZhbGlkID09PSAwKSB7XG4gICAgICAgIGlmIChyZXMuaW52YWxpZEJ1dExpa2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXMuaW52YWxpZEJ1dExpa2VbMF0ubWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IHRoaXMuV1NDb21tYW5kTm90Rm91bmRFcnJvcihgW3VhcnQke2l9XXVua25vd24gY29tbWFuZGApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG5vdGlmeUZyb21CaW5hcnkob2JqVG9TZW5kOiBhbnksIGZ1bmM6IGFueSwgcGF5bG9hZDogYW55KSB7XG4gICAgaWYgKGZ1bmMgPT09IHRoaXMuX0NvbW1hbmRSZWN2ICYmIHBheWxvYWQuYnl0ZUxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IG1vZHVsZV9pbmRleDogYW55ID0gcGF5bG9hZFswXTtcbiAgICAgIGNvbnN0IGFycjogYW55ID0gbmV3IEFycmF5KHBheWxvYWQuYnl0ZUxlbmd0aCAtIDEpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYXJyW2ldID0gcGF5bG9hZFtpICsgMV07XG4gICAgICB9XG5cbiAgICAgIG9ialRvU2VuZFtcInVhcnRcIiArIG1vZHVsZV9pbmRleF0gPSB7XG4gICAgICAgIGRhdGE6IGFycixcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHN1cGVyLm5vdGlmeUZyb21CaW5hcnkob2JqVG9TZW5kLCBmdW5jLCBwYXlsb2FkKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgV1NDb21tYW5kVWFydDtcbiJdfQ==
