"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const WSCommand_1 = __importDefault(require("./WSCommand"));
class WSCommandTcp extends WSCommand_1.default {
    constructor() {
        super();
        this.module = 13;
        this._MaxPort = 8;
        this._CommandConnect = 0;
        this._CommandClose = 1;
        // Notification
        this._CommandConnection = 2;
        this._CommandWrite = 3;
        // Notification
        this._CommandRead = 4;
    }
    connect(params, index) {
        const domain = new Uint8Array(Buffer.from(params.connect.domain, "utf8"));
        const buf = new Uint8Array(domain.length + 3);
        buf[0] = index;
        buf[1] = 0xff && params.connect.port >> 8;
        buf[2] = 0xff && params.connect.port;
        for (let i = 0; i < domain.length; i++) {
            buf[3 + i] = domain[i];
        }
        this.sendCommand(this._CommandConnect, buf);
    }
    disconnect(params, index) {
        const buf = new Uint8Array([index]);
        this.sendCommand(this._CommandClose, buf);
    }
    write(params, index) {
        const buf = new Uint8Array(params.write.data.length + 1);
        buf[0] = index;
        for (let i = 0; i < params.write.data.length; i++) {
            buf[1 + i] = params.write.data[i];
        }
        this.sendCommand(this._CommandWrite, buf);
    }
    parseFromJson(json) {
        for (let i = 0; i < this._MaxPort; i++) {
            const module = json["tcp" + i];
            if (module === undefined) {
                continue;
            }
            const schemaData = [
                { uri: "/request/tcp/connect", onValid: this.connect },
                { uri: "/request/tcp/disconnect", onValid: this.disconnect },
                { uri: "/request/tcp/write", onValid: this.write },
            ];
            const res = this.validateCommandSchema(schemaData, module, "tcp" + i, i);
            if (res.valid === 0) {
                if (res.invalidButLike.length > 0) {
                    throw new Error(res.invalidButLike[0].message);
                }
                else {
                    throw new this.WSCommandNotFoundError(`[tcp${i}]unknown command`);
                }
            }
        }
    }
    notifyFromBinary(objToSend, func, payload) {
        switch (func) {
            case this._CommandConnect: {
                let state = "Error";
                switch (payload[1]) {
                    case 0:
                        state = "ok";
                        break;
                    case 1:
                        state = "Port Used";
                        break;
                    case 2:
                        state = "Port Area Error";
                        break;
                    case 3:
                        state = "Lookup Error";
                        break;
                    case 4:
                        state = "Error";
                        break;
                }
                const module_index = payload[0];
                objToSend["tcp" + module_index] = {
                    connect: {
                        message: state,
                        code: payload[1],
                    },
                };
                break;
            }
            case this._CommandConnection:
                if (payload.length === 2 && payload[1] === 0) {
                    const module_index = payload[0];
                    objToSend["tcp" + module_index] = {
                        connection: {
                            connected: true,
                        },
                    };
                }
                else {
                    const module_index = payload[0];
                    objToSend["tcp" + module_index] = {
                        connection: {
                            connected: false,
                        },
                    };
                }
                break;
            case this._CommandRead:
                if (payload.length >= 1) {
                    const module_index = payload[0];
                    const arr = new Array(payload.byteLength - 1);
                    for (let i = 0; i < arr.length; i++) {
                        arr[i] = payload[i + 1];
                    }
                    objToSend["tcp" + module_index] = {
                        read: {
                            data: arr,
                        },
                    };
                }
                break;
        }
    }
}
exports.default = WSCommandTcp;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vYm5pei9saWJzL3dzY29tbWFuZC9XU0NvbW1hbmRUY3AudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0REFBb0M7QUFFcEMsTUFBTSxZQUFhLFNBQVEsbUJBQVM7SUFZbEM7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBRWxCLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLGVBQWU7UUFDZixJQUFJLENBQUMsa0JBQWtCLEdBQUcsQ0FBQyxDQUFDO1FBQzVCLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLGVBQWU7UUFDZixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBRU0sT0FBTyxDQUFDLE1BQVcsRUFBRSxLQUFVO1FBQ3BDLE1BQU0sTUFBTSxHQUFRLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUMvRSxNQUFNLEdBQUcsR0FBUSxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ25ELEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7UUFDZixHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQztRQUMxQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ3JDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENB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LFlBQVksR0FBUSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3JDLE1BQU0sR0FBRyxHQUFRLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ25ELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO3dCQUNuQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztxQkFDekI7b0JBQ0QsU0FBUyxDQUFDLEtBQUssR0FBRyxZQUFZLENBQUMsR0FBRzt3QkFDaEMsSUFBSSxFQUFFOzRCQUNKLElBQUksRUFBRSxHQUFHO3lCQUNWO3FCQUNGLENBQUM7aUJBQ0g7Z0JBQ0QsTUFBTTtTQUNUO0lBQ0gsQ0FBQztDQUNGO0FBRUQsa0JBQWUsWUFBWSxDQUFDIiwiZmlsZSI6InNyYy9vYm5pei9saWJzL3dzY29tbWFuZC9XU0NvbW1hbmRUY3AuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgV1NDb21tYW5kIGZyb20gXCIuL1dTQ29tbWFuZFwiO1xuXG5jbGFzcyBXU0NvbW1hbmRUY3AgZXh0ZW5kcyBXU0NvbW1hbmQge1xuICBwdWJsaWMgbW9kdWxlOiBhbnk7XG4gIHB1YmxpYyBfTWF4UG9ydDogYW55O1xuICBwdWJsaWMgX0NvbW1hbmRDb25uZWN0OiBhbnk7XG4gIHB1YmxpYyBfQ29tbWFuZENsb3NlOiBhbnk7XG4gIHB1YmxpYyBfQ29tbWFuZENvbm5lY3Rpb246IGFueTtcbiAgcHVibGljIF9Db21tYW5kV3JpdGU6IGFueTtcbiAgcHVibGljIF9Db21tYW5kUmVhZDogYW55O1xuICBwdWJsaWMgc2VuZENvbW1hbmQ6IGFueTtcbiAgcHVibGljIHZhbGlkYXRlQ29tbWFuZFNjaGVtYTogYW55O1xuICBwdWJsaWMgV1NDb21tYW5kTm90Rm91bmRFcnJvcjogYW55O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5tb2R1bGUgPSAxMztcbiAgICB0aGlzLl9NYXhQb3J0ID0gODtcblxuICAgIHRoaXMuX0NvbW1hbmRDb25uZWN0ID0gMDtcbiAgICB0aGlzLl9Db21tYW5kQ2xvc2UgPSAxO1xuICAgIC8vIE5vdGlmaWNhdGlvblxuICAgIHRoaXMuX0NvbW1hbmRDb25uZWN0aW9uID0gMjtcbiAgICB0aGlzLl9Db21tYW5kV3JpdGUgPSAzO1xuICAgIC8vIE5vdGlmaWNhdGlvblxuICAgIHRoaXMuX0NvbW1hbmRSZWFkID0gNDtcbiAgfVxuXG4gIHB1YmxpYyBjb25uZWN0KHBhcmFtczogYW55LCBpbmRleDogYW55KSB7XG4gICAgY29uc3QgZG9tYWluOiBhbnkgPSBuZXcgVWludDhBcnJheShCdWZmZXIuZnJvbShwYXJhbXMuY29ubmVjdC5kb21haW4sIFwidXRmOFwiKSk7XG4gICAgY29uc3QgYnVmOiBhbnkgPSBuZXcgVWludDhBcnJheShkb21haW4ubGVuZ3RoICsgMyk7XG4gICAgYnVmWzBdID0gaW5kZXg7XG4gICAgYnVmWzFdID0gMHhmZiAmJiBwYXJhbXMuY29ubmVjdC5wb3J0ID4+IDg7XG4gICAgYnVmWzJdID0gMHhmZiAmJiBwYXJhbXMuY29ubmVjdC5wb3J0O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZG9tYWluLmxlbmd0aDsgaSsrKSB7XG4gICAgICBidWZbMyArIGldID0gZG9tYWluW2ldO1xuICAgIH1cbiAgICB0aGlzLnNlbmRDb21tYW5kKHRoaXMuX0NvbW1hbmRDb25uZWN0LCBidWYpO1xuICB9XG5cbiAgcHVibGljIGRpc2Nvbm5lY3QocGFyYW1zOiBhbnksIGluZGV4OiBhbnkpIHtcbiAgICBjb25zdCBidWY6IGFueSA9IG5ldyBVaW50OEFycmF5KFtpbmRleF0pO1xuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZENsb3NlLCBidWYpO1xuICB9XG5cbiAgcHVibGljIHdyaXRlKHBhcmFtczogYW55LCBpbmRleDogYW55KSB7XG4gICAgY29uc3QgYnVmOiBhbnkgPSBuZXcgVWludDhBcnJheShwYXJhbXMud3JpdGUuZGF0YS5sZW5ndGggKyAxKTtcbiAgICBidWZbMF0gPSBpbmRleDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcmFtcy53cml0ZS5kYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICBidWZbMSArIGldID0gcGFyYW1zLndyaXRlLmRhdGFbaV07XG4gICAgfVxuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZFdyaXRlLCBidWYpO1xuICB9XG5cbiAgcHVibGljIHBhcnNlRnJvbUpzb24oanNvbjogYW55KSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9NYXhQb3J0OyBpKyspIHtcbiAgICAgIGNvbnN0IG1vZHVsZTogYW55ID0ganNvbltcInRjcFwiICsgaV07XG4gICAgICBpZiAobW9kdWxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHNjaGVtYURhdGE6IGFueSA9IFtcbiAgICAgICAge3VyaTogXCIvcmVxdWVzdC90Y3AvY29ubmVjdFwiLCBvblZhbGlkOiB0aGlzLmNvbm5lY3R9LFxuICAgICAgICB7dXJpOiBcIi9yZXF1ZXN0L3RjcC9kaXNjb25uZWN0XCIsIG9uVmFsaWQ6IHRoaXMuZGlzY29ubmVjdH0sXG4gICAgICAgIHt1cmk6IFwiL3JlcXVlc3QvdGNwL3dyaXRlXCIsIG9uVmFsaWQ6IHRoaXMud3JpdGV9LFxuICAgICAgXTtcbiAgICAgIGNvbnN0IHJlczogYW55ID0gdGhpcy52YWxpZGF0ZUNvbW1hbmRTY2hlbWEoc2NoZW1hRGF0YSwgbW9kdWxlLCBcInRjcFwiICsgaSwgaSk7XG5cbiAgICAgIGlmIChyZXMudmFsaWQgPT09IDApIHtcbiAgICAgICAgaWYgKHJlcy5pbnZhbGlkQnV0TGlrZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcy5pbnZhbGlkQnV0TGlrZVswXS5tZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgdGhpcy5XU0NvbW1hbmROb3RGb3VuZEVycm9yKGBbdGNwJHtpfV11bmtub3duIGNvbW1hbmRgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBub3RpZnlGcm9tQmluYXJ5KG9ialRvU2VuZDogYW55LCBmdW5jOiBhbnksIHBheWxvYWQ6IGFueSkge1xuICAgIHN3aXRjaCAoZnVuYykge1xuICAgICAgY2FzZSB0aGlzLl9Db21tYW5kQ29ubmVjdDoge1xuICAgICAgICBsZXQgc3RhdGU6IGFueSA9IFwiRXJyb3JcIjtcbiAgICAgICAgc3dpdGNoIChwYXlsb2FkWzFdKSB7XG4gICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgc3RhdGUgPSBcIm9rXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICBzdGF0ZSA9IFwiUG9ydCBVc2VkXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICBzdGF0ZSA9IFwiUG9ydCBBcmVhIEVycm9yXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICBzdGF0ZSA9IFwiTG9va3VwIEVycm9yXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICBzdGF0ZSA9IFwiRXJyb3JcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1vZHVsZV9pbmRleDogYW55ID0gcGF5bG9hZFswXTtcbiAgICAgICAgb2JqVG9TZW5kW1widGNwXCIgKyBtb2R1bGVfaW5kZXhdID0ge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IHN0YXRlLFxuICAgICAgICAgICAgY29kZTogcGF5bG9hZFsxXSxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgdGhpcy5fQ29tbWFuZENvbm5lY3Rpb246XG4gICAgICAgIGlmIChwYXlsb2FkLmxlbmd0aCA9PT0gMiAmJiBwYXlsb2FkWzFdID09PSAwKSB7XG4gICAgICAgICAgY29uc3QgbW9kdWxlX2luZGV4OiBhbnkgPSBwYXlsb2FkWzBdO1xuICAgICAgICAgIG9ialRvU2VuZFtcInRjcFwiICsgbW9kdWxlX2luZGV4XSA9IHtcbiAgICAgICAgICAgIGNvbm5lY3Rpb246IHtcbiAgICAgICAgICAgICAgY29ubmVjdGVkOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IG1vZHVsZV9pbmRleDogYW55ID0gcGF5bG9hZFswXTtcbiAgICAgICAgICBvYmpUb1NlbmRbXCJ0Y3BcIiArIG1vZHVsZV9pbmRleF0gPSB7XG4gICAgICAgICAgICBjb25uZWN0aW9uOiB7XG4gICAgICAgICAgICAgIGNvbm5lY3RlZDogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuX0NvbW1hbmRSZWFkOlxuICAgICAgICBpZiAocGF5bG9hZC5sZW5ndGggPj0gMSkge1xuICAgICAgICAgIGNvbnN0IG1vZHVsZV9pbmRleDogYW55ID0gcGF5bG9hZFswXTtcbiAgICAgICAgICBjb25zdCBhcnI6IGFueSA9IG5ldyBBcnJheShwYXlsb2FkLmJ5dGVMZW5ndGggLSAxKTtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYXJyW2ldID0gcGF5bG9hZFtpICsgMV07XG4gICAgICAgICAgfVxuICAgICAgICAgIG9ialRvU2VuZFtcInRjcFwiICsgbW9kdWxlX2luZGV4XSA9IHtcbiAgICAgICAgICAgIHJlYWQ6IHtcbiAgICAgICAgICAgICAgZGF0YTogYXJyLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBXU0NvbW1hbmRUY3A7XG4iXX0=
