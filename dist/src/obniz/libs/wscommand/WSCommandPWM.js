"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const WSCommand_1 = __importDefault(require("./WSCommand"));
class WSCommandPWM extends WSCommand_1.default {
    constructor() {
        super();
        this.module = 3;
        this.ModuleNum = 6;
        this.resetInternalStatus();
        this._CommandInit = 0;
        this._CommandDeinit = 1;
        this._CommandSetFreq = 2;
        this._CommandSetDuty = 3;
        this._CommandAMModulate = 4;
    }
    resetInternalStatus() {
        this.pwms = [];
        for (let i = 0; i < this.ModuleNum; i++) {
            this.pwms.push({});
        }
    }
    // Commands
    init(params, module) {
        const buf = new Uint8Array(2);
        buf[0] = module;
        buf[1] = params.io;
        this.pwms[module].io = params.io;
        this.sendCommand(this._CommandInit, buf);
    }
    deinit(params, module) {
        const buf = new Uint8Array(1);
        buf[0] = module;
        this.pwms[module] = {};
        this.sendCommand(this._CommandDeinit, buf);
    }
    freq(params, module) {
        const buf = new Uint8Array(5);
        buf[0] = module;
        buf[1] = params.freq >> (8 * 3);
        buf[2] = params.freq >> (8 * 2);
        buf[3] = params.freq >> (8 * 1);
        buf[4] = params.freq;
        this.pwms[module].freq = params.freq;
        this.sendCommand(this._CommandSetFreq, buf);
    }
    pulse(params, module) {
        const buf = new Uint8Array(5);
        const pulseUSec = params.pulse * 1000;
        buf[0] = module;
        buf[1] = pulseUSec >> (8 * 3);
        buf[2] = pulseUSec >> (8 * 2);
        buf[3] = pulseUSec >> (8 * 1);
        buf[4] = pulseUSec;
        this.pwms[module].pulseUSec = pulseUSec;
        this.sendCommand(this._CommandSetDuty, buf);
    }
    amModulate(params, module) {
        const bitLength = params.modulate.data.length;
        const byteLength = Math.floor((bitLength + 7) / 8);
        const buf = new Uint8Array(5 + byteLength);
        const symbol_length_usec = params.modulate.symbol_length * 1000;
        buf[0] = module;
        buf[1] = symbol_length_usec >> (8 * 3);
        buf[2] = symbol_length_usec >> (8 * 2);
        buf[3] = symbol_length_usec >> (8 * 1);
        buf[4] = symbol_length_usec;
        let bitIndex = 0;
        for (let byte = 0; byte < byteLength; byte++) {
            buf[5 + byte] = 0;
            for (let bit = 0; bit < 8; bit++) {
                if (params.modulate.data[bitIndex++]) {
                    buf[5 + byte] |= 0x80 >>> bit;
                }
            }
        }
        this.sendCommand(this._CommandAMModulate, buf);
    }
    parseFromJson(json) {
        for (let i = 0; i < this.ModuleNum; i++) {
            const module = json["pwm" + i];
            if (module === undefined) {
                continue;
            }
            const schemaData = [
                { uri: "/request/pwm/init", onValid: this.init },
                { uri: "/request/pwm/freq", onValid: this.freq },
                { uri: "/request/pwm/pulse", onValid: this.pulse },
                { uri: "/request/pwm/modulate", onValid: this.amModulate },
                { uri: "/request/pwm/deinit", onValid: this.deinit },
            ];
            const res = this.validateCommandSchema(schemaData, module, "pwm" + i, i);
            if (res.valid === 0) {
                if (res.invalidButLike.length > 0) {
                    throw new Error(res.invalidButLike[0].message);
                }
                else {
                    throw new this.WSCommandNotFoundError(`[pwm${i}]unknown command`);
                }
            }
        }
    }
}
exports.default = WSCommandPWM;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vYm5pei9saWJzL3dzY29tbWFuZC9XU0NvbW1hbmRQV00udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0REFBb0M7QUFFcEMsTUFBTSxZQUFhLFNBQVEsbUJBQVM7SUFhbEM7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1FBRTNCLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVNLG1CQUFtQjtRQUN4QixJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNmLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3BCO0lBQ0gsQ0FBQztJQUVELFdBQVc7SUFFSixJQUFJLENBQUMsTUFBVyxFQUFFLE1BQVc7UUFDbEMsTUFBTSxHQUFHLEdBQVEsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQztRQUNoQixHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsR0FBRyxNQUFNLENBQUMs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QU0sVUFBVSxHQUFRO2dCQUN0QixFQUFDLEdBQUcsRUFBRSxtQkFBbUIsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBQztnQkFDOUMsRUFBQyxHQUFHLEVBQUUsbUJBQW1CLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUM7Z0JBQzlDLEVBQUMsR0FBRyxFQUFFLG9CQUFvQixFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFDO2dCQUNoRCxFQUFDLEdBQUcsRUFBRSx1QkFBdUIsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBQztnQkFDeEQsRUFBQyxHQUFHLEVBQUUscUJBQXFCLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUM7YUFDbkQsQ0FBQztZQUNGLE1BQU0sR0FBRyxHQUFRLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLEVBQUUsTUFBTSxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFOUUsSUFBSSxHQUFHLENBQUMsS0FBSyxLQUFLLENBQUMsRUFBRTtnQkFDbkIsSUFBSSxHQUFHLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQ2pDLE1BQU0sSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztpQkFDaEQ7cUJBQU07b0JBQ0wsTUFBTSxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztpQkFDbkU7YUFDRjtTQUNGO0lBQ0gsQ0FBQztDQUNGO0FBRUQsa0JBQWUsWUFBWSxDQUFDIiwiZmlsZSI6InNyYy9vYm5pei9saWJzL3dzY29tbWFuZC9XU0NvbW1hbmRQV00uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgV1NDb21tYW5kIGZyb20gXCIuL1dTQ29tbWFuZFwiO1xuXG5jbGFzcyBXU0NvbW1hbmRQV00gZXh0ZW5kcyBXU0NvbW1hbmQge1xuICBwdWJsaWMgbW9kdWxlOiBhbnk7XG4gIHB1YmxpYyBNb2R1bGVOdW06IGFueTtcbiAgcHVibGljIF9Db21tYW5kSW5pdDogYW55O1xuICBwdWJsaWMgX0NvbW1hbmREZWluaXQ6IGFueTtcbiAgcHVibGljIF9Db21tYW5kU2V0RnJlcTogYW55O1xuICBwdWJsaWMgX0NvbW1hbmRTZXREdXR5OiBhbnk7XG4gIHB1YmxpYyBfQ29tbWFuZEFNTW9kdWxhdGU6IGFueTtcbiAgcHVibGljIHB3bXM6IGFueTtcbiAgcHVibGljIHNlbmRDb21tYW5kOiBhbnk7XG4gIHB1YmxpYyB2YWxpZGF0ZUNvbW1hbmRTY2hlbWE6IGFueTtcbiAgcHVibGljIFdTQ29tbWFuZE5vdEZvdW5kRXJyb3I6IGFueTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMubW9kdWxlID0gMztcbiAgICB0aGlzLk1vZHVsZU51bSA9IDY7XG4gICAgdGhpcy5yZXNldEludGVybmFsU3RhdHVzKCk7XG5cbiAgICB0aGlzLl9Db21tYW5kSW5pdCA9IDA7XG4gICAgdGhpcy5fQ29tbWFuZERlaW5pdCA9IDE7XG4gICAgdGhpcy5fQ29tbWFuZFNldEZyZXEgPSAyO1xuICAgIHRoaXMuX0NvbW1hbmRTZXREdXR5ID0gMztcbiAgICB0aGlzLl9Db21tYW5kQU1Nb2R1bGF0ZSA9IDQ7XG4gIH1cblxuICBwdWJsaWMgcmVzZXRJbnRlcm5hbFN0YXR1cygpIHtcbiAgICB0aGlzLnB3bXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuTW9kdWxlTnVtOyBpKyspIHtcbiAgICAgIHRoaXMucHdtcy5wdXNoKHt9KTtcbiAgICB9XG4gIH1cblxuICAvLyBDb21tYW5kc1xuXG4gIHB1YmxpYyBpbml0KHBhcmFtczogYW55LCBtb2R1bGU6IGFueSkge1xuICAgIGNvbnN0IGJ1ZjogYW55ID0gbmV3IFVpbnQ4QXJyYXkoMik7XG4gICAgYnVmWzBdID0gbW9kdWxlO1xuICAgIGJ1ZlsxXSA9IHBhcmFtcy5pbztcbiAgICB0aGlzLnB3bXNbbW9kdWxlXS5pbyA9IHBhcmFtcy5pbztcbiAgICB0aGlzLnNlbmRDb21tYW5kKHRoaXMuX0NvbW1hbmRJbml0LCBidWYpO1xuICB9XG5cbiAgcHVibGljIGRlaW5pdChwYXJhbXM6IGFueSwgbW9kdWxlOiBhbnkpIHtcbiAgICBjb25zdCBidWY6IGFueSA9IG5ldyBVaW50OEFycmF5KDEpO1xuICAgIGJ1ZlswXSA9IG1vZHVsZTtcbiAgICB0aGlzLnB3bXNbbW9kdWxlXSA9IHt9O1xuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZERlaW5pdCwgYnVmKTtcbiAgfVxuXG4gIHB1YmxpYyBmcmVxKHBhcmFtczogYW55LCBtb2R1bGU6IGFueSkge1xuICAgIGNvbnN0IGJ1ZjogYW55ID0gbmV3IFVpbnQ4QXJyYXkoNSk7XG4gICAgYnVmWzBdID0gbW9kdWxlO1xuICAgIGJ1ZlsxXSA9IHBhcmFtcy5mcmVxID4+ICg4ICogMyk7XG4gICAgYnVmWzJdID0gcGFyYW1zLmZyZXEgPj4gKDggKiAyKTtcbiAgICBidWZbM10gPSBwYXJhbXMuZnJlcSA+PiAoOCAqIDEpO1xuICAgIGJ1Zls0XSA9IHBhcmFtcy5mcmVxO1xuICAgIHRoaXMucHdtc1ttb2R1bGVdLmZyZXEgPSBwYXJhbXMuZnJlcTtcbiAgICB0aGlzLnNlbmRDb21tYW5kKHRoaXMuX0NvbW1hbmRTZXRGcmVxLCBidWYpO1xuICB9XG5cbiAgcHVibGljIHB1bHNlKHBhcmFtczogYW55LCBtb2R1bGU6IGFueSkge1xuICAgIGNvbnN0IGJ1ZjogYW55ID0gbmV3IFVpbnQ4QXJyYXkoNSk7XG4gICAgY29uc3QgcHVsc2VVU2VjOiBhbnkgPSBwYXJhbXMucHVsc2UgKiAxMDAwO1xuICAgIGJ1ZlswXSA9IG1vZHVsZTtcbiAgICBidWZbMV0gPSBwdWxzZVVTZWMgPj4gKDggKiAzKTtcbiAgICBidWZbMl0gPSBwdWxzZVVTZWMgPj4gKDggKiAyKTtcbiAgICBidWZbM10gPSBwdWxzZVVTZWMgPj4gKDggKiAxKTtcbiAgICBidWZbNF0gPSBwdWxzZVVTZWM7XG4gICAgdGhpcy5wd21zW21vZHVsZV0ucHVsc2VVU2VjID0gcHVsc2VVU2VjO1xuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZFNldER1dHksIGJ1Zik7XG4gIH1cblxuICBwdWJsaWMgYW1Nb2R1bGF0ZShwYXJhbXM6IGFueSwgbW9kdWxlOiBhbnkpIHtcbiAgICBjb25zdCBiaXRMZW5ndGg6IGFueSA9IHBhcmFtcy5tb2R1bGF0ZS5kYXRhLmxlbmd0aDtcbiAgICBjb25zdCBieXRlTGVuZ3RoOiBhbnkgPSBNYXRoLmZsb29yKChiaXRMZW5ndGggKyA3KSAvIDgpO1xuICAgIGNvbnN0IGJ1ZjogYW55ID0gbmV3IFVpbnQ4QXJyYXkoNSArIGJ5dGVMZW5ndGgpO1xuICAgIGNvbnN0IHN5bWJvbF9sZW5ndGhfdXNlYzogYW55ID0gcGFyYW1zLm1vZHVsYXRlLnN5bWJvbF9sZW5ndGggKiAxMDAwO1xuICAgIGJ1ZlswXSA9IG1vZHVsZTtcbiAgICBidWZbMV0gPSBzeW1ib2xfbGVuZ3RoX3VzZWMgPj4gKDggKiAzKTtcbiAgICBidWZbMl0gPSBzeW1ib2xfbGVuZ3RoX3VzZWMgPj4gKDggKiAyKTtcbiAgICBidWZbM10gPSBzeW1ib2xfbGVuZ3RoX3VzZWMgPj4gKDggKiAxKTtcbiAgICBidWZbNF0gPSBzeW1ib2xfbGVuZ3RoX3VzZWM7XG4gICAgbGV0IGJpdEluZGV4OiBhbnkgPSAwO1xuICAgIGZvciAobGV0IGJ5dGUgPSAwOyBieXRlIDwgYnl0ZUxlbmd0aDsgYnl0ZSsrKSB7XG4gICAgICBidWZbNSArIGJ5dGVdID0gMDtcbiAgICAgIGZvciAobGV0IGJpdCA9IDA7IGJpdCA8IDg7IGJpdCsrKSB7XG4gICAgICAgIGlmIChwYXJhbXMubW9kdWxhdGUuZGF0YVtiaXRJbmRleCsrXSkge1xuICAgICAgICAgIGJ1Zls1ICsgYnl0ZV0gfD0gMHg4MCA+Pj4gYml0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZEFNTW9kdWxhdGUsIGJ1Zik7XG4gIH1cblxuICBwdWJsaWMgcGFyc2VGcm9tSnNvbihqc29uOiBhbnkpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuTW9kdWxlTnVtOyBpKyspIHtcbiAgICAgIGNvbnN0IG1vZHVsZTogYW55ID0ganNvbltcInB3bVwiICsgaV07XG4gICAgICBpZiAobW9kdWxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHNjaGVtYURhdGE6IGFueSA9IFtcbiAgICAgICAge3VyaTogXCIvcmVxdWVzdC9wd20vaW5pdFwiLCBvblZhbGlkOiB0aGlzLmluaXR9LFxuICAgICAgICB7dXJpOiBcIi9yZXF1ZXN0L3B3bS9mcmVxXCIsIG9uVmFsaWQ6IHRoaXMuZnJlcX0sXG4gICAgICAgIHt1cmk6IFwiL3JlcXVlc3QvcHdtL3B1bHNlXCIsIG9uVmFsaWQ6IHRoaXMucHVsc2V9LFxuICAgICAgICB7dXJpOiBcIi9yZXF1ZXN0L3B3bS9tb2R1bGF0ZVwiLCBvblZhbGlkOiB0aGlzLmFtTW9kdWxhdGV9LFxuICAgICAgICB7dXJpOiBcIi9yZXF1ZXN0L3B3bS9kZWluaXRcIiwgb25WYWxpZDogdGhpcy5kZWluaXR9LFxuICAgICAgXTtcbiAgICAgIGNvbnN0IHJlczogYW55ID0gdGhpcy52YWxpZGF0ZUNvbW1hbmRTY2hlbWEoc2NoZW1hRGF0YSwgbW9kdWxlLCBcInB3bVwiICsgaSwgaSk7XG5cbiAgICAgIGlmIChyZXMudmFsaWQgPT09IDApIHtcbiAgICAgICAgaWYgKHJlcy5pbnZhbGlkQnV0TGlrZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcy5pbnZhbGlkQnV0TGlrZVswXS5tZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgdGhpcy5XU0NvbW1hbmROb3RGb3VuZEVycm9yKGBbcHdtJHtpfV11bmtub3duIGNvbW1hbmRgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBXU0NvbW1hbmRQV007XG4iXX0=
