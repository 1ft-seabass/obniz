"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const WSCommand_1 = __importDefault(require("./WSCommand"));
class WSCommandSPI extends WSCommand_1.default {
    constructor() {
        super();
        this.module = 5;
        this._CommandInit = 0;
        this._CommandDeinit = 1;
        this._CommandWriteRead = 2;
        this._CommandWrite = 3;
    }
    // Commands
    initMaster(params, module) {
        const mode = 0; // master mode
        let clk = params.clk;
        let mosi = params.mosi;
        let miso = params.miso;
        let cs = params.cs;
        const clock = params.clock;
        if (clk === null && mosi === null && miso === null) {
            throw new Error("spi: master mode require one of clk/mosi/miso");
        }
        if (clk === null) {
            clk = this.ioNotUsed;
        }
        if (mosi === null) {
            mosi = this.ioNotUsed;
        }
        if (miso === null) {
            miso = this.ioNotUsed;
        }
        if (cs === null) {
            cs = this.ioNotUsed;
        }
        const buf = new Uint8Array(11);
        buf[0] = module;
        buf[1] = mode;
        buf[2] = clk;
        buf[3] = mosi;
        buf[4] = miso;
        buf[5] = this.ioNotUsed; // wp
        buf[6] = this.ioNotUsed; // hd
        buf[7] = clock >> (3 * 8);
        buf[8] = clock >> (2 * 8);
        buf[9] = clock >> (1 * 8);
        buf[10] = clock;
        buf[11] = cs;
        this.sendCommand(this._CommandInit, buf);
    }
    deinit(params, module) {
        const buf = new Uint8Array([module]);
        this.sendCommand(this._CommandDeinit, buf);
    }
    write(params, module) {
        const buf = new Uint8Array(1 + params.data.length);
        buf[0] = module;
        buf.set(params.data, 1);
        if (params.read) {
            this.sendCommand(this._CommandWriteRead, buf);
        }
        else {
            this.sendCommand(this._CommandWrite, buf);
        }
    }
    parseFromJson(json) {
        for (let i = 0; i < 2; i++) {
            const module = json["spi" + i];
            if (module === undefined) {
                continue;
            }
            const schemaData = [
                { uri: "/request/spi/init_master", onValid: this.initMaster },
                { uri: "/request/spi/write", onValid: this.write },
                { uri: "/request/spi/deinit", onValid: this.deinit },
            ];
            const res = this.validateCommandSchema(schemaData, module, "spi" + i, i);
            if (res.valid === 0) {
                if (res.invalidButLike.length > 0) {
                    throw new Error(res.invalidButLike[0].message);
                }
                else {
                    throw new this.WSCommandNotFoundError(`[spi${i}]unknown command`);
                }
            }
        }
    }
    notifyFromBinary(objToSend, func, payload) {
        if (func === this._CommandWriteRead && payload.byteLength > 1) {
            const module_index = payload[0];
            // var received = payload.slice(1);
            const arr = new Array(payload.byteLength - 1);
            for (let i = 0; i < arr.length; i++) {
                arr[i] = payload[i + 1];
            }
            objToSend["spi" + module_index] = {
                data: arr,
            };
        }
        else {
            super.notifyFromBinary(objToSend, func, payload);
        }
    }
}
exports.default = WSCommandSPI;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vYm5pei9saWJzL3dzY29tbWFuZC9XU0NvbW1hbmRTUEkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0REFBb0M7QUFFcEMsTUFBTSxZQUFhLFNBQVEsbUJBQVM7SUFXbEM7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBRWhCLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxDQUFDLENBQUM7UUFDM0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUVELFdBQVc7SUFFSixVQUFVLENBQUMsTUFBVyxFQUFFLE1BQVc7UUFDeEMsTUFBTSxJQUFJLEdBQVEsQ0FBQyxDQUFDLENBQUMsY0FBYztRQUVuQyxJQUFJLEdBQUcsR0FBUSxNQUFNLENBQUMsR0FBRyxDQUFDO1FBQzFCLElBQUksSUFBSSxHQUFRLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDNUIsSUFBSSxJQUFJLEdBQVEsTUFBTSxDQUFDLElBQUksQ0FBQztRQUM1QixJQUFJLEVBQUUsR0FBUSxNQUFNLENBQUMsRUFBRSxDQUFDO1FBRXhCLE1BQU0sS0FBSyxHQUFRLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFFaEMsSUFBSSxHQUFHLEtBQUssSUFBSSxJQUFJLElBQUksS0FBSyxJQUFJLElBQUksSUFBSSxLQUFLLElBQUksRUFBRTtZQUNsRCxNQUFNLElBQUksS0FBSyxDQUFDLCtDQUErQyxDQUFDLENBQUM7U0FDbEU7UUFFRCxJQUFJLEdBQUcsS0FBSyxJQUFJLEVBQUU7WUFDaEIsR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7U0FDdEI7UUFDRCxJQUFJLElBQUksS0FBSyxJQUFJLEVBQUU7WUFDakIsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7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Q0FBQztTQUNIO2FBQU07WUFDTCxLQUFLLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztTQUNsRDtJQUNILENBQUM7Q0FDRjtBQUVELGtCQUFlLFlBQVksQ0FBQyIsImZpbGUiOiJzcmMvb2JuaXovbGlicy93c2NvbW1hbmQvV1NDb21tYW5kU1BJLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFdTQ29tbWFuZCBmcm9tIFwiLi9XU0NvbW1hbmRcIjtcblxuY2xhc3MgV1NDb21tYW5kU1BJIGV4dGVuZHMgV1NDb21tYW5kIHtcbiAgcHVibGljIG1vZHVsZTogYW55O1xuICBwdWJsaWMgX0NvbW1hbmRJbml0OiBhbnk7XG4gIHB1YmxpYyBfQ29tbWFuZERlaW5pdDogYW55O1xuICBwdWJsaWMgX0NvbW1hbmRXcml0ZVJlYWQ6IGFueTtcbiAgcHVibGljIF9Db21tYW5kV3JpdGU6IGFueTtcbiAgcHVibGljIGlvTm90VXNlZDogYW55O1xuICBwdWJsaWMgc2VuZENvbW1hbmQ6IGFueTtcbiAgcHVibGljIHZhbGlkYXRlQ29tbWFuZFNjaGVtYTogYW55O1xuICBwdWJsaWMgV1NDb21tYW5kTm90Rm91bmRFcnJvcjogYW55O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5tb2R1bGUgPSA1O1xuXG4gICAgdGhpcy5fQ29tbWFuZEluaXQgPSAwO1xuICAgIHRoaXMuX0NvbW1hbmREZWluaXQgPSAxO1xuICAgIHRoaXMuX0NvbW1hbmRXcml0ZVJlYWQgPSAyO1xuICAgIHRoaXMuX0NvbW1hbmRXcml0ZSA9IDM7XG4gIH1cblxuICAvLyBDb21tYW5kc1xuXG4gIHB1YmxpYyBpbml0TWFzdGVyKHBhcmFtczogYW55LCBtb2R1bGU6IGFueSkge1xuICAgIGNvbnN0IG1vZGU6IGFueSA9IDA7IC8vIG1hc3RlciBtb2RlXG5cbiAgICBsZXQgY2xrOiBhbnkgPSBwYXJhbXMuY2xrO1xuICAgIGxldCBtb3NpOiBhbnkgPSBwYXJhbXMubW9zaTtcbiAgICBsZXQgbWlzbzogYW55ID0gcGFyYW1zLm1pc287XG4gICAgbGV0IGNzOiBhbnkgPSBwYXJhbXMuY3M7XG5cbiAgICBjb25zdCBjbG9jazogYW55ID0gcGFyYW1zLmNsb2NrO1xuXG4gICAgaWYgKGNsayA9PT0gbnVsbCAmJiBtb3NpID09PSBudWxsICYmIG1pc28gPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcInNwaTogbWFzdGVyIG1vZGUgcmVxdWlyZSBvbmUgb2YgY2xrL21vc2kvbWlzb1wiKTtcbiAgICB9XG5cbiAgICBpZiAoY2xrID09PSBudWxsKSB7XG4gICAgICBjbGsgPSB0aGlzLmlvTm90VXNlZDtcbiAgICB9XG4gICAgaWYgKG1vc2kgPT09IG51bGwpIHtcbiAgICAgIG1vc2kgPSB0aGlzLmlvTm90VXNlZDtcbiAgICB9XG4gICAgaWYgKG1pc28gPT09IG51bGwpIHtcbiAgICAgIG1pc28gPSB0aGlzLmlvTm90VXNlZDtcbiAgICB9XG4gICAgaWYgKGNzID09PSBudWxsKSB7XG4gICAgICBjcyA9IHRoaXMuaW9Ob3RVc2VkO1xuICAgIH1cblxuICAgIGNvbnN0IGJ1ZjogYW55ID0gbmV3IFVpbnQ4QXJyYXkoMTEpO1xuICAgIGJ1ZlswXSA9IG1vZHVsZTtcbiAgICBidWZbMV0gPSBtb2RlO1xuICAgIGJ1ZlsyXSA9IGNsaztcbiAgICBidWZbM10gPSBtb3NpO1xuICAgIGJ1Zls0XSA9IG1pc287XG4gICAgYnVmWzVdID0gdGhpcy5pb05vdFVzZWQ7IC8vIHdwXG4gICAgYnVmWzZdID0gdGhpcy5pb05vdFVzZWQ7IC8vIGhkXG4gICAgYnVmWzddID0gY2xvY2sgPj4gKDMgKiA4KTtcbiAgICBidWZbOF0gPSBjbG9jayA+PiAoMiAqIDgpO1xuICAgIGJ1Zls5XSA9IGNsb2NrID4+ICgxICogOCk7XG4gICAgYnVmWzEwXSA9IGNsb2NrO1xuICAgIGJ1ZlsxMV0gPSBjcztcblxuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZEluaXQsIGJ1Zik7XG4gIH1cblxuICBwdWJsaWMgZGVpbml0KHBhcmFtczogYW55LCBtb2R1bGU6IGFueSkge1xuICAgIGNvbnN0IGJ1ZjogYW55ID0gbmV3IFVpbnQ4QXJyYXkoW21vZHVsZV0pO1xuICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZERlaW5pdCwgYnVmKTtcbiAgfVxuXG4gIHB1YmxpYyB3cml0ZShwYXJhbXM6IGFueSwgbW9kdWxlOiBhbnkpIHtcbiAgICBjb25zdCBidWY6IGFueSA9IG5ldyBVaW50OEFycmF5KDEgKyBwYXJhbXMuZGF0YS5sZW5ndGgpO1xuICAgIGJ1ZlswXSA9IG1vZHVsZTtcbiAgICBidWYuc2V0KHBhcmFtcy5kYXRhLCAxKTtcbiAgICBpZiAocGFyYW1zLnJlYWQpIHtcbiAgICAgIHRoaXMuc2VuZENvbW1hbmQodGhpcy5fQ29tbWFuZFdyaXRlUmVhZCwgYnVmKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZW5kQ29tbWFuZCh0aGlzLl9Db21tYW5kV3JpdGUsIGJ1Zik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHBhcnNlRnJvbUpzb24oanNvbjogYW55KSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyBpKyspIHtcbiAgICAgIGNvbnN0IG1vZHVsZTogYW55ID0ganNvbltcInNwaVwiICsgaV07XG4gICAgICBpZiAobW9kdWxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHNjaGVtYURhdGE6IGFueSA9IFtcbiAgICAgICAge3VyaTogXCIvcmVxdWVzdC9zcGkvaW5pdF9tYXN0ZXJcIiwgb25WYWxpZDogdGhpcy5pbml0TWFzdGVyfSxcbiAgICAgICAge3VyaTogXCIvcmVxdWVzdC9zcGkvd3JpdGVcIiwgb25WYWxpZDogdGhpcy53cml0ZX0sXG4gICAgICAgIHt1cmk6IFwiL3JlcXVlc3Qvc3BpL2RlaW5pdFwiLCBvblZhbGlkOiB0aGlzLmRlaW5pdH0sXG4gICAgICBdO1xuICAgICAgY29uc3QgcmVzOiBhbnkgPSB0aGlzLnZhbGlkYXRlQ29tbWFuZFNjaGVtYShzY2hlbWFEYXRhLCBtb2R1bGUsIFwic3BpXCIgKyBpLCBpKTtcblxuICAgICAgaWYgKHJlcy52YWxpZCA9PT0gMCkge1xuICAgICAgICBpZiAocmVzLmludmFsaWRCdXRMaWtlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmludmFsaWRCdXRMaWtlWzBdLm1lc3NhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyB0aGlzLldTQ29tbWFuZE5vdEZvdW5kRXJyb3IoYFtzcGkke2l9XXVua25vd24gY29tbWFuZGApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG5vdGlmeUZyb21CaW5hcnkob2JqVG9TZW5kOiBhbnksIGZ1bmM6IGFueSwgcGF5bG9hZDogYW55KSB7XG4gICAgaWYgKGZ1bmMgPT09IHRoaXMuX0NvbW1hbmRXcml0ZVJlYWQgJiYgcGF5bG9hZC5ieXRlTGVuZ3RoID4gMSkge1xuICAgICAgY29uc3QgbW9kdWxlX2luZGV4OiBhbnkgPSBwYXlsb2FkWzBdO1xuICAgICAgLy8gdmFyIHJlY2VpdmVkID0gcGF5bG9hZC5zbGljZSgxKTtcblxuICAgICAgY29uc3QgYXJyOiBhbnkgPSBuZXcgQXJyYXkocGF5bG9hZC5ieXRlTGVuZ3RoIC0gMSk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICBhcnJbaV0gPSBwYXlsb2FkW2kgKyAxXTtcbiAgICAgIH1cbiAgICAgIG9ialRvU2VuZFtcInNwaVwiICsgbW9kdWxlX2luZGV4XSA9IHtcbiAgICAgICAgZGF0YTogYXJyLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3VwZXIubm90aWZ5RnJvbUJpbmFyeShvYmpUb1NlbmQsIGZ1bmMsIHBheWxvYWQpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBXU0NvbW1hbmRTUEk7XG4iXX0=
