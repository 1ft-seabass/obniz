"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
class AXP192 {
    constructor() {
        this.requiredKeys = [];
        this.keys = ["sda", "scl", "i2c"];
    }
    static info() {
        return {
            name: "AXP192",
        };
    }
    wired(obniz) {
        this.params.mode = "master"; // for i2c
        this.params.clock = 400 * 1000; // for i2c
        this.i2c = obniz.getI2CWithConfig(this.params);
    }
    // Module functions
    set(address, data) {
        this.i2c.write(AXP192_ADDRESS, [address, data]);
    }
    getWait(address) {
        return __awaiter(this, void 0, void 0, function* () {
            this.i2c.write(AXP192_ADDRESS, [address]);
            return yield this.i2c.readWait(AXP192_ADDRESS, 1);
        });
    }
    setLDO2Voltage(voltage) {
        return __awaiter(this, void 0, void 0, function* () {
            if (voltage < 1.8) {
                voltage = 1.8;
            }
            if (voltage > 3.3) {
                voltage = 3.3;
            }
            let set = yield this.getWait(REG_VOLT_SET_LDO2_3);
            let offset = (voltage - 1.8) * 10;
            if (offset > 15) {
                offset = 15;
            }
            set = (set & 0x0f) | (offset << 4);
            console.log("set voltage to ", set);
            this.set(REG_VOLT_SET_LDO2_3, set);
        });
    }
    setLDO3Voltage(voltage) {
        return __awaiter(this, void 0, void 0, function* () {
            if (voltage < 1.8) {
                voltage = 1.8;
            }
            if (voltage > 3.3) {
                voltage = 3.3;
            }
            let set = yield this.getWait(REG_VOLT_SET_LDO2_3);
            let offset = (voltage - 1.8) * 10;
            if (offset > 15) {
                offset = 15;
            }
            set = (set & 0xf0) | offset;
            this.set(REG_VOLT_SET_LDO2_3, set);
        });
    }
    set3VLDO2_3() {
        this.set(REG_VOLT_SET_LDO2_3, 0xcc);
    }
    enableLDO2_3() {
        this.set(REG_EN_DC1_LDO2_3, 0x4d);
    }
    toggleLDO2(val) {
        return __awaiter(this, void 0, void 0, function* () {
            const bit = val ? 1 : 0;
            let state = yield this.getWait(REG_EN_DC1_LDO2_3);
            state = (state & LDO2_EN_MASK) | (bit << 2);
            this.set(REG_EN_DC1_LDO2_3, state);
        });
    }
    toggleLDO3(val) {
        return __awaiter(this, void 0, void 0, function* () {
            const bit = val ? 1 : 0;
            let state = yield this.getWait(REG_EN_DC1_LDO2_3);
            state = (state & LDO3_EN_MASK) | (bit << 3);
            this.set(REG_EN_DC1_LDO2_3, state);
        });
    }
    initM5StickC() {
        this.i2c.write(AXP192_ADDRESS, [REG_EN_EXT_DC2, 0xff]);
        this.i2c.write(AXP192_ADDRESS, [REG_VOLT_SET_LDO2_3, 0xcc]);
        this.i2c.write(AXP192_ADDRESS, [REG_ADC_EN1, 0xff]);
        this.i2c.write(AXP192_ADDRESS, [REG_CHARGE_CTRL1, 0xc0]);
        this.i2c.write(AXP192_ADDRESS, [REG_CCOUNTER, 0x80]);
        this.i2c.write(AXP192_ADDRESS, [REG_EN_DC1_LDO2_3, 0x4d]);
        this.i2c.write(AXP192_ADDRESS, [REG_PEK, 0x0c]);
        this.i2c.write(AXP192_ADDRESS, [REG_GPIO0, 0x02]);
        this.i2c.write(AXP192_ADDRESS, [REG_VBUS_IPSOUT, 0xe0]);
        this.i2c.write(AXP192_ADDRESS, [REG_CHARGE_OVTEMP, 0xfc]);
        this.i2c.write(AXP192_ADDRESS, [REG_BCKUP_BAT, 0xa2]);
    }
    getVbat() {
        return __awaiter(this, void 0, void 0, function* () {
            this.i2c.write(AXP192_ADDRESS, [REG_VBAT_LSB]);
            const vbat_lsb = yield this.readWait(AXP192_ADDRESS, 1);
            this.i2c.write(AXP192_ADDRESS, [REG_VBAT_MSB]);
            const vbat_msb = yield this.readWait(AXP192_ADDRESS, 1);
            return (vbat_lsb << 4) + vbat_msb;
        });
    }
}
exports.default = AXP192;
const AXP192_ADDRESS = 0x34;
const REG_EN_EXT_DC2 = 0x10;
const REG_EN_DC1_LDO2_3 = 0x12;
const REG_VOLT_SET_LDO2_3 = 0x28;
const REG_VBUS_IPSOUT = 0x30;
const REG_CHARGE_CTRL1 = 0x33;
const REG_BCKUP_BAT = 0x35;
const REG_PEK = 0x36;
const REG_CHARGE_OVTEMP = 0x39;
const REG_VBAT_LSB = 0x78;
const REG_VBAT_MSB = 0x79;
const REG_ADC_EN1 = 0x82;
const REG_GPIO0 = 0x90;
const REG_CCOUNTER = 0xb8;
const LDO2_EN_MASK = 0xfb;
const LDO3_EN_MASK = 0xf7;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9Qb3dlci9BWFAxOTIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSxNQUFNLE1BQU07SUFjVjtRQUNFLElBQUksQ0FBQyxZQUFZLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFmTSxNQUFNLENBQUMsSUFBSTtRQUNoQixPQUFPO1lBQ0wsSUFBSSxFQUFFLFFBQVE7U0FDZixDQUFDO0lBQ0osQ0FBQztJQWFNLEtBQUssQ0FBQyxLQUFVO1FBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxDQUFDLFVBQVU7UUFDdkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLFVBQVU7UUFDMUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRCxtQkFBbUI7SUFDWixHQUFHLENBQUMsT0FBWSxFQUFFLElBQVM7UUFDaEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVZLE9BQU8sQ0FBQyxPQUFZOztZQUMvQixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQzFDLE9BQU8sTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDcEQsQ0FBQztLQUFBO0lBRVksY0FBYyxDQUFDLE9BQVk7O1lBQ3RDLElBQUksT0FBTyxHQUFHLEdBQUcsRUFBRTtnQkFDakIsT0FB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SSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDN0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUMvQyxNQUFNLFFBQVEsR0FBUSxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzdELE9BQU8sQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDO1FBQ3BDLENBQUM7S0FBQTtDQUNGO0FBRUQsa0JBQWUsTUFBTSxDQUFDO0FBRXRCLE1BQU0sY0FBYyxHQUFRLElBQUksQ0FBQztBQUVqQyxNQUFNLGNBQWMsR0FBUSxJQUFJLENBQUM7QUFDakMsTUFBTSxpQkFBaUIsR0FBUSxJQUFJLENBQUM7QUFDcEMsTUFBTSxtQkFBbUIsR0FBUSxJQUFJLENBQUM7QUFDdEMsTUFBTSxlQUFlLEdBQVEsSUFBSSxDQUFDO0FBQ2xDLE1BQU0sZ0JBQWdCLEdBQVEsSUFBSSxDQUFDO0FBQ25DLE1BQU0sYUFBYSxHQUFRLElBQUksQ0FBQztBQUNoQyxNQUFNLE9BQU8sR0FBUSxJQUFJLENBQUM7QUFDMUIsTUFBTSxpQkFBaUIsR0FBUSxJQUFJLENBQUM7QUFDcEMsTUFBTSxZQUFZLEdBQVEsSUFBSSxDQUFDO0FBQy9CLE1BQU0sWUFBWSxHQUFRLElBQUksQ0FBQztBQUMvQixNQUFNLFdBQVcsR0FBUSxJQUFJLENBQUM7QUFDOUIsTUFBTSxTQUFTLEdBQVEsSUFBSSxDQUFDO0FBQzVCLE1BQU0sWUFBWSxHQUFRLElBQUksQ0FBQztBQUUvQixNQUFNLFlBQVksR0FBUSxJQUFJLENBQUM7QUFDL0IsTUFBTSxZQUFZLEdBQVEsSUFBSSxDQUFDIiwiZmlsZSI6InNyYy9wYXJ0cy9Qb3dlci9BWFAxOTIvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBBWFAxOTIge1xuXG4gIHB1YmxpYyBzdGF0aWMgaW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogXCJBWFAxOTJcIixcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHJlcXVpcmVkS2V5czogYW55O1xuICBwdWJsaWMga2V5czogYW55O1xuICBwdWJsaWMgcGFyYW1zOiBhbnk7XG4gIHB1YmxpYyBpMmM6IGFueTtcbiAgcHVibGljIHJlYWRXYWl0OiBhbnk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5yZXF1aXJlZEtleXMgPSBbXTtcbiAgICB0aGlzLmtleXMgPSBbXCJzZGFcIiwgXCJzY2xcIiwgXCJpMmNcIl07XG4gIH1cblxuICBwdWJsaWMgd2lyZWQob2JuaXo6IGFueSkge1xuICAgIHRoaXMucGFyYW1zLm1vZGUgPSBcIm1hc3RlclwiOyAvLyBmb3IgaTJjXG4gICAgdGhpcy5wYXJhbXMuY2xvY2sgPSA0MDAgKiAxMDAwOyAvLyBmb3IgaTJjXG4gICAgdGhpcy5pMmMgPSBvYm5pei5nZXRJMkNXaXRoQ29uZmlnKHRoaXMucGFyYW1zKTtcbiAgfVxuXG4gIC8vIE1vZHVsZSBmdW5jdGlvbnNcbiAgcHVibGljIHNldChhZGRyZXNzOiBhbnksIGRhdGE6IGFueSkge1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbYWRkcmVzcywgZGF0YV0pO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldFdhaXQoYWRkcmVzczogYW55KSB7XG4gICAgdGhpcy5pMmMud3JpdGUoQVhQMTkyX0FERFJFU1MsIFthZGRyZXNzXSk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuaTJjLnJlYWRXYWl0KEFYUDE5Ml9BRERSRVNTLCAxKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzZXRMRE8yVm9sdGFnZSh2b2x0YWdlOiBhbnkpIHtcbiAgICBpZiAodm9sdGFnZSA8IDEuOCkge1xuICAgICAgdm9sdGFnZSA9IDEuODtcbiAgICB9XG4gICAgaWYgKHZvbHRhZ2UgPiAzLjMpIHtcbiAgICAgIHZvbHRhZ2UgPSAzLjM7XG4gICAgfVxuICAgIGxldCBzZXQ6IGFueSA9IGF3YWl0IHRoaXMuZ2V0V2FpdChSRUdfVk9MVF9TRVRfTERPMl8zKTtcbiAgICBsZXQgb2Zmc2V0OiBhbnkgPSAodm9sdGFnZSAtIDEuOCkgKiAxMDtcbiAgICBpZiAob2Zmc2V0ID4gMTUpIHtcbiAgICAgIG9mZnNldCA9IDE1O1xuICAgIH1cbiAgICBzZXQgPSAoc2V0ICYgMHgwZikgfCAob2Zmc2V0IDw8IDQpO1xuICAgIGNvbnNvbGUubG9nKFwic2V0IHZvbHRhZ2UgdG8gXCIsIHNldCk7XG4gICAgdGhpcy5zZXQoUkVHX1ZPTFRfU0VUX0xETzJfMywgc2V0KTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzZXRMRE8zVm9sdGFnZSh2b2x0YWdlOiBhbnkpIHtcbiAgICBpZiAodm9sdGFnZSA8IDEuOCkge1xuICAgICAgdm9sdGFnZSA9IDEuODtcbiAgICB9XG4gICAgaWYgKHZvbHRhZ2UgPiAzLjMpIHtcbiAgICAgIHZvbHRhZ2UgPSAzLjM7XG4gICAgfVxuICAgIGxldCBzZXQ6IGFueSA9IGF3YWl0IHRoaXMuZ2V0V2FpdChSRUdfVk9MVF9TRVRfTERPMl8zKTtcbiAgICBsZXQgb2Zmc2V0OiBhbnkgPSAodm9sdGFnZSAtIDEuOCkgKiAxMDtcbiAgICBpZiAob2Zmc2V0ID4gMTUpIHtcbiAgICAgIG9mZnNldCA9IDE1O1xuICAgIH1cbiAgICBzZXQgPSAoc2V0ICYgMHhmMCkgfCBvZmZzZXQ7XG4gICAgdGhpcy5zZXQoUkVHX1ZPTFRfU0VUX0xETzJfMywgc2V0KTtcbiAgfVxuXG4gIHB1YmxpYyBzZXQzVkxETzJfMygpIHtcbiAgICB0aGlzLnNldChSRUdfVk9MVF9TRVRfTERPMl8zLCAweGNjKTtcbiAgfVxuXG4gIHB1YmxpYyBlbmFibGVMRE8yXzMoKSB7XG4gICAgdGhpcy5zZXQoUkVHX0VOX0RDMV9MRE8yXzMsIDB4NGQpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHRvZ2dsZUxETzIodmFsOiBhbnkpIHtcbiAgICBjb25zdCBiaXQ6IGFueSA9IHZhbCA/IDEgOiAwO1xuICAgIGxldCBzdGF0ZTogYW55ID0gYXdhaXQgdGhpcy5nZXRXYWl0KFJFR19FTl9EQzFfTERPMl8zKTtcbiAgICBzdGF0ZSA9IChzdGF0ZSAmIExETzJfRU5fTUFTSykgfCAoYml0IDw8IDIpO1xuICAgIHRoaXMuc2V0KFJFR19FTl9EQzFfTERPMl8zLCBzdGF0ZSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgdG9nZ2xlTERPMyh2YWw6IGFueSkge1xuICAgIGNvbnN0IGJpdDogYW55ID0gdmFsID8gMSA6IDA7XG4gICAgbGV0IHN0YXRlOiBhbnkgPSBhd2FpdCB0aGlzLmdldFdhaXQoUkVHX0VOX0RDMV9MRE8yXzMpO1xuICAgIHN0YXRlID0gKHN0YXRlICYgTERPM19FTl9NQVNLKSB8IChiaXQgPDwgMyk7XG4gICAgdGhpcy5zZXQoUkVHX0VOX0RDMV9MRE8yXzMsIHN0YXRlKTtcbiAgfVxuXG4gIHB1YmxpYyBpbml0TTVTdGlja0MoKSB7XG4gICAgdGhpcy5pMmMud3JpdGUoQVhQMTkyX0FERFJFU1MsIFtSRUdfRU5fRVhUX0RDMiwgMHhmZl0pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX1ZPTFRfU0VUX0xETzJfMywgMHhjY10pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX0FEQ19FTjEsIDB4ZmZdKTtcbiAgICB0aGlzLmkyYy53cml0ZShBWFAxOTJfQUREUkVTUywgW1JFR19DSEFSR0VfQ1RSTDEsIDB4YzBdKTtcbiAgICB0aGlzLmkyYy53cml0ZShBWFAxOTJfQUREUkVTUywgW1JFR19DQ09VTlRFUiwgMHg4MF0pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX0VOX0RDMV9MRE8yXzMsIDB4NGRdKTtcbiAgICB0aGlzLmkyYy53cml0ZShBWFAxOTJfQUREUkVTUywgW1JFR19QRUssIDB4MGNdKTtcbiAgICB0aGlzLmkyYy53cml0ZShBWFAxOTJfQUREUkVTUywgW1JFR19HUElPMCwgMHgwMl0pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX1ZCVVNfSVBTT1VULCAweGUwXSk7XG4gICAgdGhpcy5pMmMud3JpdGUoQVhQMTkyX0FERFJFU1MsIFtSRUdfQ0hBUkdFX09WVEVNUCwgMHhmY10pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX0JDS1VQX0JBVCwgMHhhMl0pO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldFZiYXQoKSB7XG4gICAgdGhpcy5pMmMud3JpdGUoQVhQMTkyX0FERFJFU1MsIFtSRUdfVkJBVF9MU0JdKTtcbiAgICBjb25zdCB2YmF0X2xzYjogYW55ID0gYXdhaXQgdGhpcy5yZWFkV2FpdChBWFAxOTJfQUREUkVTUywgMSk7XG4gICAgdGhpcy5pMmMud3JpdGUoQVhQMTkyX0FERFJFU1MsIFtSRUdfVkJBVF9NU0JdKTtcbiAgICBjb25zdCB2YmF0X21zYjogYW55ID0gYXdhaXQgdGhpcy5yZWFkV2FpdChBWFAxOTJfQUREUkVTUywgMSk7XG4gICAgcmV0dXJuICh2YmF0X2xzYiA8PCA0KSArIHZiYXRfbXNiO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFYUDE5MjtcblxuY29uc3QgQVhQMTkyX0FERFJFU1M6IGFueSA9IDB4MzQ7XG5cbmNvbnN0IFJFR19FTl9FWFRfREMyOiBhbnkgPSAweDEwO1xuY29uc3QgUkVHX0VOX0RDMV9MRE8yXzM6IGFueSA9IDB4MTI7XG5jb25zdCBSRUdfVk9MVF9TRVRfTERPMl8zOiBhbnkgPSAweDI4O1xuY29uc3QgUkVHX1ZCVVNfSVBTT1VUOiBhbnkgPSAweDMwO1xuY29uc3QgUkVHX0NIQVJHRV9DVFJMMTogYW55ID0gMHgzMztcbmNvbnN0IFJFR19CQ0tVUF9CQVQ6IGFueSA9IDB4MzU7XG5jb25zdCBSRUdfUEVLOiBhbnkgPSAweDM2O1xuY29uc3QgUkVHX0NIQVJHRV9PVlRFTVA6IGFueSA9IDB4Mzk7XG5jb25zdCBSRUdfVkJBVF9MU0I6IGFueSA9IDB4Nzg7XG5jb25zdCBSRUdfVkJBVF9NU0I6IGFueSA9IDB4Nzk7XG5jb25zdCBSRUdfQURDX0VOMTogYW55ID0gMHg4MjtcbmNvbnN0IFJFR19HUElPMDogYW55ID0gMHg5MDtcbmNvbnN0IFJFR19DQ09VTlRFUjogYW55ID0gMHhiODtcblxuY29uc3QgTERPMl9FTl9NQVNLOiBhbnkgPSAweGZiO1xuY29uc3QgTERPM19FTl9NQVNLOiBhbnkgPSAweGY3O1xuIl19
