{"version":3,"sources":["../src/parts/MovementSensor/MPU6886/index.ts"],"names":[],"mappings":"AAAA,OAAO,QAAQ,MAAM,gBAAgB,CAAC;AAEtC,cAAM,OAAQ,SAAQ,QAAQ;WAEd,IAAI;;;IAMX,QAAQ,EAAE,GAAG,CAAC;IACd,QAAQ,EAAE,GAAG,CAAC;IACd,KAAK,EAAE,GAAG,CAAC;IACX,KAAK,EAAE,GAAG,CAAC;IACX,MAAM,EAAE,GAAG,CAAC;IACZ,YAAY,EAAE,GAAG,CAAC;IAClB,WAAW,EAAE,GAAG,CAAC;IACjB,UAAU,EAAE,GAAG,CAAC;;IAqChB,KAAK,CAAC,KAAK,EAAE,GAAG;IAMhB,OAAO;;;;;IAQP,UAAU;IAIV,IAAI;IA8BJ,SAAS,CAAC,mBAAmB,EAAE,GAAG,EAAE,eAAe,EAAE,GAAG;IAuClD,cAAc;;;;;IAyBd,WAAW;IAIX,YAAY;IAIZ,WAAW;CAGzB;AAED,eAAe,OAAO,CAAC","file":"index.d.ts","sourcesContent":["import i2cParts from \"../../i2cParts\";\n\nclass MPU6886 extends i2cParts {\n\n  public static info() {\n    return {\n      name: \"MPU6886\",\n    };\n  }\n\n  public commands: any;\n  public readWait: any;\n  public write: any;\n  public obniz: any;\n  public params: any;\n  public _accel_range: any;\n  public _gyro_range: any;\n  public char2short: any;\n\n  constructor() {\n    super();\n    this.commands = {};\n    this.commands.whoami = 0x75;\n    this.commands.accelIntelCtrl = 0x69;\n    this.commands.smplrtDiv = 0x19;\n    this.commands.intPinCfg = 0x37;\n    this.commands.intEnable = 0x38;\n    this.commands.accelXoutH = 0x3b;\n    this.commands.accelXoutL = 0x3c;\n    this.commands.accelYoutH = 0x3d;\n    this.commands.accelYoutL = 0x3e;\n    this.commands.accelZoutH = 0x3f;\n    this.commands.accelZoutL = 0x40;\n\n    this.commands.tempOutH = 0x41;\n    this.commands.tempOutL = 0x42;\n\n    this.commands.gyroXoutH = 0x43;\n    this.commands.gyroXoutL = 0x44;\n    this.commands.gyroYoutH = 0x45;\n    this.commands.gyroYoutL = 0x46;\n    this.commands.gyroZoutH = 0x47;\n    this.commands.gyroZoutL = 0x48;\n\n    this.commands.userCtrl = 0x6a;\n    this.commands.pwrMgmt1 = 0x6b;\n    this.commands.pwrMgmt2 = 0x6c;\n    this.commands.config = 0x1a;\n    this.commands.gyroConfig = 0x1b;\n    this.commands.accelConfig = 0x1c;\n    this.commands.accelConfig2 = 0x1d;\n    this.commands.fifoEn = 0x23;\n  }\n\n  public wired(obniz: any) {\n    super.wired(obniz);\n\n    this.init();\n  }\n\n  public i2cInfo() {\n    return {\n      address: 0x68,\n      clock: 100000,\n      voltage: \"3v\",\n    };\n  }\n\n  public whoamiWait() {\n    return this.readWait(this.commands.whoami, 1)[0];\n  }\n\n  public init() {\n    this.write(this.commands.pwrMgmt1, 0x00);\n    this.obniz.wait(10);\n    this.write(this.commands.pwrMgmt1, 0x01 << 7);\n    this.obniz.wait(10);\n    this.write(this.commands.pwrMgmt1, 0x01 << 0);\n    this.obniz.wait(10);\n    this.setConfig(\n      this.params.accelerometer_range || 2,\n      this.params.gyroscope_range || 250,\n    );\n    this.obniz.wait(1);\n    this.write(this.commands.config, 0x01);\n    this.obniz.wait(1);\n    this.write(this.commands.smplrtDiv, 0x05);\n    this.obniz.wait(1);\n    this.write(this.commands.intEnable, 0x00);\n    this.obniz.wait(1);\n    this.write(this.commands.accelConfig2, 0x00);\n    this.obniz.wait(1);\n    this.write(this.commands.userCtrl, 0x00);\n    this.obniz.wait(1);\n    this.write(this.commands.fifoEn, 0x00);\n    this.obniz.wait(1);\n    this.write(this.commands.intPinCfg, 0x22);\n    this.obniz.wait(1);\n    this.write(this.commands.intEnable, 0x01);\n    this.obniz.wait(1);\n  }\n\n  public setConfig(accelerometer_range: any, gyroscope_range: any) {\n    // accel range set (0x00:2g, 0x08:4g, 0x10:8g, 0x18:16g)\n    switch (accelerometer_range) {\n      case 2:\n        this.write(this.commands.accelConfig, 0x00);\n        break;\n      case 4:\n        this.write(this.commands.accelConfig, 0x08);\n        break;\n      case 8:\n        this.write(this.commands.accelConfig, 0x10);\n        break;\n      case 16:\n        this.write(this.commands.accelConfig, 0x18);\n        break;\n      default:\n        throw new Error(\"accel_range variable 2,4,8,16 setting\");\n    }\n    // gyro range & LPF set (0x00:250, 0x08:500, 0x10:1000, 0x18:2000[deg/s])\n    switch (gyroscope_range) {\n      case 250:\n        this.write(this.commands.gyroConfig, 0x00);\n        break;\n      case 500:\n        this.write(this.commands.gyroConfig, 0x08);\n        break;\n      case 1000:\n        this.write(this.commands.gyroConfig, 0x10);\n        break;\n      case 2000:\n        this.write(this.commands.gyroConfig, 0x18);\n        break;\n      default:\n        throw new Error(\"accel_range variable 250,500,1000,2000 setting\");\n    }\n    this._accel_range = accelerometer_range;\n    this._gyro_range = gyroscope_range;\n  }\n\n  public async getAllDataWait() {\n    const raw_data: any = await this.readWait(this.commands.accelXoutH, 14); // request all data\n    const ac_scale: any = this._accel_range / 32768;\n    const gy_scale: any = this._gyro_range / 32768;\n\n    const accelerometer: any = {\n      x: this.char2short(raw_data[0], raw_data[1]) * ac_scale,\n      y: this.char2short(raw_data[2], raw_data[3]) * ac_scale,\n      z: this.char2short(raw_data[4], raw_data[5]) * ac_scale,\n    };\n    const temperature: any =\n      this.char2short(raw_data[6], raw_data[7]) / 326.8 + 25.0;\n    const gyroscope: any = {\n      x: this.char2short(raw_data[8], raw_data[9]) * gy_scale,\n      y: this.char2short(raw_data[10], raw_data[11]) * gy_scale,\n      z: this.char2short(raw_data[12], raw_data[13]) * gy_scale,\n    };\n\n    return {\n      accelerometer,\n      temperature,\n      gyroscope,\n    };\n  }\n\n  public async getTempWait() {\n    return (await this.getAllDataWait()).temperature;\n  }\n\n  public async getAccelWait() {\n    return (await this.getAllDataWait()).accelerometer;\n  }\n\n  public async getGyroWait() {\n    return (await this.getAllDataWait()).gyroscope;\n  }\n}\n\nexport default MPU6886;\n"]}