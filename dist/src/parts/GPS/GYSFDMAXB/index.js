"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class GYSFDMAXB {
    constructor() {
        this.keys = ["vcc", "txd", "rxd", "gnd", "Opps"];
        this.requiredKeys = ["txd", "rxd"];
        this.ioKeys = this.keys;
        this.displayName = "gps";
        this.displayIoNames = { txd: "txd", rxd: "rxd", Opps: "1pps" };
    }
    // -------------------
    get latitude() {
        return this.nmea2dd(this._latitude);
    }
    get longitude() {
        return this.nmea2dd(this._longitude);
    }
    static info() {
        return {
            name: "GYSFDMAXB",
        };
    }
    wired(obniz) {
        this.obniz = obniz;
        this.tx = this.params.txd;
        this.rx = this.params.rxd;
        this.vcc = this.params.vcc;
        this.gnd = this.params.gnd;
        this.Opps = this.params.Opps;
        this.obniz.setVccGnd(this.params.vcc, this.params.gnd, "5v");
        this.uart = obniz.getFreeUart();
        this.uart.start({
            tx: this.params.txd,
            rx: this.params.rxd,
            baud: 9600,
            drive: "3v",
        });
        this.editedData = {};
        this.editedData.enable = false;
        this.editedData.GPGSV = new Array(4);
        this.on1pps = null;
        this.last1pps = 0;
        this.gpsInfo = {};
        this.gpsInfo._sentenceType = {
            GPGGA: 0x0001,
            GPGSA: 0x0002,
            GPGSV: 0x0004,
            GPRMC: 0x0008,
            GPVTG: 0x0010,
            GPZDA: 0x0020,
        };
        this.gpsInfo.status = "V";
        this.gpsInfo.sentences = new Set(); // Set specifying sentence of MNEA from which data have been obtained
        this.gpsInfo.satelliteInfo = {
            satellites: [],
            inView: 0,
        };
    }
    start1pps(callback) {
        this.on1pps = callback;
        if (callback) {
            this.last1pps = 2;
            this.obniz.getAD(this.Opps).self = this;
            this.obniz.getAD(this.Opps).start((voltage) => {
                const vol = Math.round(voltage);
                if (vol !== this.self.last1pps) {
                    this.self.last1pps = vol;
                    if (vol === 0 && this.self.on1pps) {
                        this.self.on1pps();
                    }
                }
            });
        }
        else {
            this.obniz.getAD(this.Opps).end();
        }
    }
    readSentence() {
        let results = [];
        if (this.uart.isDataExists()) {
            const pos = this.uart.received.indexOf(0x0a);
            if (pos >= 0) {
                results = this.uart.received.slice(0, pos - 1);
                this.uart.received.splice(0, pos + 1);
                return this.uart.tryConvertString(results);
            }
        }
        return "";
    }
    getEditedData() {
        let n;
        let utc;
        let format;
        let sentence = this.readSentence();
        this.editedData.enable = false;
        this.editedData.GPGSV = new Array(4);
        while (sentence.length > 0) {
            const part = sentence.split(",");
            if (sentence.slice(-4, -3) !== ",") {
                const st = part[part.length - 1].slice(0, -3);
                part.push(part[part.length - 1].slice(-3));
                part[part.length - 2] = st;
            }
            this.editedData.sentence = part.join(",");
            switch (part[0]) {
                case "$GPGGA":
                    this.editedData.GPGGA = part;
                    break;
                case "$GPGLL":
                    this.editedData.GPGLL = part;
                    break;
                case "$GPGSA":
                    this.editedData.GPGSA = part;
                    break;
                case "$GPGSV":
                    n = Number(part[2]);
                    if (n > this.editedData.GPGSV.length) {
                        while (n > this.editedData.GPGSV.length) {
                            this.editedData.GPGSV.push([]);
                        }
                    }
                    this.editedData.GPGSV[n - 1] = part;
                    break;
                case "$GPRMC":
                    this.editedData.GPRMC = part;
                    break;
                case "$GPVTG":
                    this.editedData.GPVTG = part;
                    break;
                case "$GPZDA":
                    this.editedData.GPZDA = part;
                    utc =
                        part[4] +
                            "/" +
                            part[3] +
                            "/" +
                            part[2] +
                            " " +
                            part[1].substring(0, 2) +
                            ":" +
                            part[1].substring(2, 4) +
                            ":" +
                            part[1].substring(4, 6) +
                            " +00:00";
                    this.editedData.timestamp = new Date(utc);
                    break;
                default:
                    format = part[0].substr(1);
                    this.editedData[format] = part;
            }
            this.editedData.enable = true;
            sentence = this.readSentence();
        }
        return this.editedData;
    }
    getGpsInfo(editedData) {
        const NMEA_SATINSENTENCE = 4;
        const NMEA_MAXSAT = 12;
        editedData = editedData || this.getEditedData();
        this.gpsInfo.status = "V";
        if (editedData.enable) {
            if (editedData.GPGGA) {
                const gga = editedData.GPGGA;
                this.gpsInfo.gpsQuality = parseFloat(gga[6]); // Fix Quality: 0 = Invalid, 1 = GPS fix, 2 = DGPS fix
                this.gpsInfo.hdop = parseFloat(gga[8]); // Horizontal Dilution of Precision (HDOP)
                this.gpsInfo.altitude = parseFloat(gga[9]); // Antenna Altitude meters above mean sea level
                const latitude = this.nmea2dd(parseFloat(gga[2]));
                this.gpsInfo.latitude = gga[3] === "N" ? latitude : -latitude;
                const longitude = this.nmea2dd(parseFloat(gga[4]));
                this.gpsInfo.longitude = gga[5] === "E" ? longitude : -longitude;
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGGA);
            }
            if (editedData.GPGSV) {
                for (let n = 0; n < editedData.GPGSV.length; n++) {
                    if (editedData.GPGSV[n]) {
                        const gsv = editedData.GPGSV[n].map((v) => parseFloat(v));
                        const pack_count = gsv[1];
                        const pack_index = gsv[2];
                        const sat_count = gsv[3];
                        if (pack_index > pack_count) {
                            continue;
                        }
                        this.gpsInfo.satelliteInfo.inView = sat_count;
                        let nsat = (pack_index - 1) * NMEA_SATINSENTENCE;
                        nsat =
                            nsat + NMEA_SATINSENTENCE > sat_count
                                ? sat_count - nsat
                                : NMEA_SATINSENTENCE;
                        for (let isat = 0; isat < nsat; ++isat) {
                            const isi = (pack_index - 1) * NMEA_SATINSENTENCE + isat;
                            if (this.gpsInfo.satelliteInfo.satellites.length <= isi) {
                                this.gpsInfo.satelliteInfo.satellites.push({});
                            }
                            const isatn = isat * NMEA_SATINSENTENCE;
                            this.gpsInfo.satelliteInfo.satellites[isi] = {
                                id: gsv[isatn + 4],
                                elevation: gsv[isatn + 5],
                                azimuth: gsv[isatn + 6],
                                snr: gsv[isatn + 7],
                                inUse: false,
                            };
                        }
                        this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSV);
                    }
                }
            }
            if (editedData.GPGSA) {
                const gsa = editedData.GPGSA;
                let nuse = 0;
                this.gpsInfo.fixMode = parseFloat(gsa[2]); // Fix Mode: 1=Fix not available, 2=2D, 3=3D
                this.gpsInfo.pdop = parseFloat(gsa[15]); // PDOP: Position Dilution of Precision
                this.gpsInfo.hdop = parseFloat(gsa[16]); // HDOP: Horizontal Dilution of Precision
                this.gpsInfo.vdop = parseFloat(gsa[17]); // VDOP: Vertical Dilution of Position
                for (let i = 0; i < NMEA_MAXSAT; ++i) {
                    for (let j = 0; j < this.gpsInfo.satelliteInfo.inView; ++j) {
                        if (this.gpsInfo.satelliteInfo.satellites[j] &&
                            gsa[i + 3] === this.gpsInfo.satelliteInfo.satellites[j].id) {
                            this.gpsInfo.satelliteInfo.satellites[j].inUse = true;
                            nuse++;
                        }
                    }
                }
                this.gpsInfo.satelliteInfo.inUse = nuse;
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSA);
            }
            if (editedData.GPRMC) {
                const rmc = editedData.GPRMC;
                this.gpsInfo.status = rmc[2]; // Status Active or Void
                const latitude = this.nmea2dd(parseFloat(rmc[3]));
                this.gpsInfo.latitude = rmc[4] === "N" ? latitude : -latitude;
                const longitude = this.nmea2dd(parseFloat(rmc[5]));
                this.gpsInfo.longitude = rmc[6] === "E" ? longitude : -longitude;
                const NMEA_TUD_KNOTS = 1.852; // 1knot=1.852km/h
                this.gpsInfo.speed = parseFloat(rmc[7]) * NMEA_TUD_KNOTS; // unit: km/h
                this.gpsInfo.direction = rmc[8];
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPRMC);
            }
            if (editedData.GPVTG) {
                const vtg = editedData.GPVTG;
                this.gpsInfo.direction = parseFloat(vtg[1]);
                this.gpsInfo.declination = parseFloat(vtg[3]);
                this.gpsInfo.speed = parseFloat(vtg[7]);
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPVTG);
            }
            if (editedData.GPZDA) {
                this.gpsInfo.utc = editedData.timestamp;
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPZDA);
            }
        }
        return this.gpsInfo;
    }
    _mneaTo(format, value) {
        let result = this.nmea2dd(value);
        if (typeof format === "string") {
            switch (format.toUpperCase()) {
                case "DMS":
                    result = this.nmea2dms(value);
                    break;
                case "DM":
                    result = this.nmea2dm(value);
                    break;
                case "S":
                    result = this.nmea2s(value);
                    break;
                default:
            }
        }
        return result;
    }
    latitudeTo(format) {
        return this._mneaTo(format, this._latitude);
    }
    longitudeTo(format) {
        return this._mneaTo(format, this._longitude);
    }
    status2string(status) {
        status = status || this.status;
        if (status === "A") {
            return "Active";
        }
        if (status === "V") {
            return "Void";
        }
        return status;
    }
    fixMode2string(fixMode) {
        fixMode = fixMode || this.fixMode;
        if (fixMode === 1) {
            return "Fix not available";
        }
        if (fixMode === 2) {
            return "2D";
        }
        if (fixMode === 3) {
            return "3D";
        }
        return fixMode;
    }
    gpsQuality2string(gpsQuality) {
        gpsQuality = gpsQuality || this.gpsQuality;
        if (gpsQuality === 0) {
            return "Invalid";
        }
        if (gpsQuality === 1) {
            return "GPS fix";
        }
        if (gpsQuality === 2) {
            return "DGPS fix";
        }
        return gpsQuality;
    }
    // --- latitude/longitude MNEA format change to each unit
    nmea2dms(val) {
        // NMEA format to DMS format string (999° 99'99.9")
        val = parseFloat(val);
        const d = Math.floor(val / 100);
        const m = Math.floor((val / 100.0 - d) * 100.0);
        const s = ((val / 100.0 - d) * 100.0 - m) * 60;
        return d + "°" + m + "'" + s.toFixed(1) + '"';
    }
    nmea2dm(val) {
        // NMEA format to DM format string (999° 99.9999')
        val = parseFloat(val);
        const d = Math.floor(val / 100.0);
        const m = (val / 100.0 - d) * 100.0;
        return d + "°" + m.toFixed(4) + "'";
    }
    nmea2dd(val) {
        // NMEA format to DD format decimal (999.999999)
        val = parseFloat(val);
        const d = Math.floor(val / 100.0);
        const m = Math.floor(((val / 100.0 - d) * 100.0) / 60);
        const s = (((val / 100.0 - d) * 100.0 - m) * 60) / (60 * 60);
        return parseFloat((d + m + s).toFixed(6));
    }
    nmea2s(val) {
        // NMEA format to S format decimal (99999.9999)
        val = parseFloat(val);
        const d = Math.floor(val / 100.0);
        const m = Math.floor(((val / 100.0 - d) * 100.0) / 60);
        const s = (((val / 100.0 - d) * 100.0 - m) * 60) / (60 * 60);
        return (d + m + s) / (1.0 / 60.0 / 60.0);
    }
}
exports.default = GYSFDMAXB;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9HUFMvR1lTRkRNQVhCL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTSxTQUFTO0lBd0NiO1FBQ0UsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRW5DLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztRQUN6QixJQUFJLENBQUMsY0FBYyxHQUFHLEVBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUMsQ0FBQztJQUMvRCxDQUFDO0lBOUNELHNCQUFzQjtJQUN0QixJQUFJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxJQUFJLFNBQVM7UUFDWCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFTSxNQUFNLENBQUMsSUFBSTtRQUNoQixPQUFPO1lBQ0wsSUFBSSxFQUFFLFdBQVc7U0FDbEIsQ0FBQztJQUNKLENBQUM7SUFtQ00sS0FBSyxDQUFDLEtBQVU7UUFDckIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQztRQUMxQixJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBQzFCLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FB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LENBQUMsQ0FBQztRQUNsRSxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDM0MsQ0FBQztDQUNGO0FBRUQsa0JBQWUsU0FBUyxDQUFDIiwiZmlsZSI6InNyYy9wYXJ0cy9HUFMvR1lTRkRNQVhCL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgR1lTRkRNQVhCIHtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBnZXQgbGF0aXR1ZGUoKSB7XG4gICAgcmV0dXJuIHRoaXMubm1lYTJkZCh0aGlzLl9sYXRpdHVkZSk7XG4gIH1cblxuICBnZXQgbG9uZ2l0dWRlKCkge1xuICAgIHJldHVybiB0aGlzLm5tZWEyZGQodGhpcy5fbG9uZ2l0dWRlKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgaW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogXCJHWVNGRE1BWEJcIixcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGtleXM6IGFueTtcbiAgcHVibGljIHJlcXVpcmVkS2V5czogYW55O1xuICBwdWJsaWMgaW9LZXlzOiBhbnk7XG4gIHB1YmxpYyBkaXNwbGF5TmFtZTogYW55O1xuICBwdWJsaWMgZGlzcGxheUlvTmFtZXM6IGFueTtcbiAgcHVibGljIG9ibml6OiBhbnk7XG4gIHB1YmxpYyB0eDogYW55O1xuICBwdWJsaWMgcGFyYW1zOiBhbnk7XG4gIHB1YmxpYyByeDogYW55O1xuICBwdWJsaWMgdmNjOiBhbnk7XG4gIHB1YmxpYyBnbmQ6IGFueTtcbiAgcHVibGljIE9wcHM6IGFueTtcbiAgcHVibGljIHVhcnQ6IGFueTtcbiAgcHVibGljIGVkaXRlZERhdGE6IGFueTtcbiAgcHVibGljIG9uMXBwczogYW55O1xuICBwdWJsaWMgbGFzdDFwcHM6IGFueTtcbiAgcHVibGljIGdwc0luZm86IGFueTtcbiAgcHVibGljIHNlbGY6IGFueTtcbiAgcHVibGljIF9sYXRpdHVkZTogYW55O1xuICBwdWJsaWMgX2xvbmdpdHVkZTogYW55O1xuICBwdWJsaWMgc3RhdHVzOiBhbnk7XG4gIHB1YmxpYyBmaXhNb2RlOiBhbnk7XG4gIHB1YmxpYyBncHNRdWFsaXR5OiBhbnk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5rZXlzID0gW1widmNjXCIsIFwidHhkXCIsIFwicnhkXCIsIFwiZ25kXCIsIFwiT3Bwc1wiXTtcbiAgICB0aGlzLnJlcXVpcmVkS2V5cyA9IFtcInR4ZFwiLCBcInJ4ZFwiXTtcblxuICAgIHRoaXMuaW9LZXlzID0gdGhpcy5rZXlzO1xuICAgIHRoaXMuZGlzcGxheU5hbWUgPSBcImdwc1wiO1xuICAgIHRoaXMuZGlzcGxheUlvTmFtZXMgPSB7dHhkOiBcInR4ZFwiLCByeGQ6IFwicnhkXCIsIE9wcHM6IFwiMXBwc1wifTtcbiAgfVxuXG4gIHB1YmxpYyB3aXJlZChvYm5pejogYW55KSB7XG4gICAgdGhpcy5vYm5peiA9IG9ibml6O1xuICAgIHRoaXMudHggPSB0aGlzLnBhcmFtcy50eGQ7XG4gICAgdGhpcy5yeCA9IHRoaXMucGFyYW1zLnJ4ZDtcbiAgICB0aGlzLnZjYyA9IHRoaXMucGFyYW1zLnZjYztcbiAgICB0aGlzLmduZCA9IHRoaXMucGFyYW1zLmduZDtcbiAgICB0aGlzLk9wcHMgPSB0aGlzLnBhcmFtcy5PcHBzO1xuXG4gICAgdGhpcy5vYm5pei5zZXRWY2NHbmQodGhpcy5wYXJhbXMudmNjLCB0aGlzLnBhcmFtcy5nbmQsIFwiNXZcIik7XG4gICAgdGhpcy51YXJ0ID0gb2JuaXouZ2V0RnJlZVVhcnQoKTtcbiAgICB0aGlzLnVhcnQuc3RhcnQoe1xuICAgICAgdHg6IHRoaXMucGFyYW1zLnR4ZCxcbiAgICAgIHJ4OiB0aGlzLnBhcmFtcy5yeGQsXG4gICAgICBiYXVkOiA5NjAwLFxuICAgICAgZHJpdmU6IFwiM3ZcIixcbiAgICB9KTtcblxuICAgIHRoaXMuZWRpdGVkRGF0YSA9IHt9O1xuICAgIHRoaXMuZWRpdGVkRGF0YS5lbmFibGUgPSBmYWxzZTtcbiAgICB0aGlzLmVkaXRlZERhdGEuR1BHU1YgPSBuZXcgQXJyYXkoNCk7XG5cbiAgICB0aGlzLm9uMXBwcyA9IG51bGw7XG4gICAgdGhpcy5sYXN0MXBwcyA9IDA7XG5cbiAgICB0aGlzLmdwc0luZm8gPSB7fTtcbiAgICB0aGlzLmdwc0luZm8uX3NlbnRlbmNlVHlwZSA9IHtcbiAgICAgIEdQR0dBOiAweDAwMDEsIC8vIEdHQSAtIEdsb2JhbCBQb3NpdGlvbmluZyBTeXN0ZW0gRml4IERhdGFcbiAgICAgIEdQR1NBOiAweDAwMDIsIC8vIEdTQSAtIEdOU1MgRE9QIGFuZCBhY3RpdmUgc2F0ZWxsaXRlc1xuICAgICAgR1BHU1Y6IDB4MDAwNCwgLy8gR1NWIC0gU2F0ZWxsaXRlcyBpbiB2aWV3XG4gICAgICBHUFJNQzogMHgwMDA4LCAvLyBSTUMgLSBSZWNvbW1lbmRlZCBtaW5pbXVtIHNwZWNpZmljIEdOU1MgZGF0YVxuICAgICAgR1BWVEc6IDB4MDAxMCwgLy8gVlRHIC0gVHJhY2sgbWFkZSBnb29kIGFuZCBncm91bmQgc3BlZWRcbiAgICAgIEdQWkRBOiAweDAwMjAsIC8vIFpEQSAtIERhdGUgJiBUaW1lXG4gICAgfTtcbiAgICB0aGlzLmdwc0luZm8uc3RhdHVzID0gXCJWXCI7XG4gICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcyA9IG5ldyBTZXQoKTsgLy8gU2V0IHNwZWNpZnlpbmcgc2VudGVuY2Ugb2YgTU5FQSBmcm9tIHdoaWNoIGRhdGEgaGF2ZSBiZWVuIG9idGFpbmVkXG4gICAgdGhpcy5ncHNJbmZvLnNhdGVsbGl0ZUluZm8gPSB7XG4gICAgICBzYXRlbGxpdGVzOiBbXSxcbiAgICAgIGluVmlldzogMCxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHN0YXJ0MXBwcyhjYWxsYmFjazogYW55KSB7XG4gICAgdGhpcy5vbjFwcHMgPSBjYWxsYmFjaztcbiAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgIHRoaXMubGFzdDFwcHMgPSAyO1xuICAgICAgdGhpcy5vYm5pei5nZXRBRCh0aGlzLk9wcHMpLnNlbGYgPSB0aGlzO1xuICAgICAgdGhpcy5vYm5pei5nZXRBRCh0aGlzLk9wcHMpLnN0YXJ0KCh2b2x0YWdlOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3Qgdm9sOiBhbnkgPSBNYXRoLnJvdW5kKHZvbHRhZ2UpO1xuICAgICAgICBpZiAodm9sICE9PSB0aGlzLnNlbGYubGFzdDFwcHMpIHtcbiAgICAgICAgICB0aGlzLnNlbGYubGFzdDFwcHMgPSB2b2w7XG4gICAgICAgICAgaWYgKHZvbCA9PT0gMCAmJiB0aGlzLnNlbGYub24xcHBzKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGYub24xcHBzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vYm5pei5nZXRBRCh0aGlzLk9wcHMpLmVuZCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyByZWFkU2VudGVuY2UoKSB7XG4gICAgbGV0IHJlc3VsdHM6IGFueSA9IFtdO1xuICAgIGlmICh0aGlzLnVhcnQuaXNEYXRhRXhpc3RzKCkpIHtcbiAgICAgIGNvbnN0IHBvczogYW55ID0gdGhpcy51YXJ0LnJlY2VpdmVkLmluZGV4T2YoMHgwYSk7XG4gICAgICBpZiAocG9zID49IDApIHtcbiAgICAgICAgcmVzdWx0cyA9IHRoaXMudWFydC5yZWNlaXZlZC5zbGljZSgwLCBwb3MgLSAxKTtcbiAgICAgICAgdGhpcy51YXJ0LnJlY2VpdmVkLnNwbGljZSgwLCBwb3MgKyAxKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudWFydC50cnlDb252ZXJ0U3RyaW5nKHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuXG4gIHB1YmxpYyBnZXRFZGl0ZWREYXRhKCkge1xuICAgIGxldCBuOiBhbnk7IGxldCAgdXRjOiBhbnk7IGxldCAgZm9ybWF0OiBhbnk7XG4gICAgbGV0IHNlbnRlbmNlOiBhbnkgPSB0aGlzLnJlYWRTZW50ZW5jZSgpO1xuICAgIHRoaXMuZWRpdGVkRGF0YS5lbmFibGUgPSBmYWxzZTtcbiAgICB0aGlzLmVkaXRlZERhdGEuR1BHU1YgPSBuZXcgQXJyYXkoNCk7XG4gICAgd2hpbGUgKHNlbnRlbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHBhcnQ6IGFueSA9IHNlbnRlbmNlLnNwbGl0KFwiLFwiKTtcbiAgICAgIGlmIChzZW50ZW5jZS5zbGljZSgtNCwgLTMpICE9PSBcIixcIikge1xuICAgICAgICBjb25zdCBzdDogYW55ID0gcGFydFtwYXJ0Lmxlbmd0aCAtIDFdLnNsaWNlKDAsIC0zKTtcbiAgICAgICAgcGFydC5wdXNoKHBhcnRbcGFydC5sZW5ndGggLSAxXS5zbGljZSgtMykpO1xuICAgICAgICBwYXJ0W3BhcnQubGVuZ3RoIC0gMl0gPSBzdDtcbiAgICAgIH1cbiAgICAgIHRoaXMuZWRpdGVkRGF0YS5zZW50ZW5jZSA9IHBhcnQuam9pbihcIixcIik7XG4gICAgICBzd2l0Y2ggKHBhcnRbMF0pIHtcbiAgICAgICAgY2FzZSBcIiRHUEdHQVwiOlxuICAgICAgICAgIHRoaXMuZWRpdGVkRGF0YS5HUEdHQSA9IHBhcnQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCIkR1BHTExcIjpcbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGEuR1BHTEwgPSBwYXJ0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiJEdQR1NBXCI6XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLkdQR1NBID0gcGFydDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIiRHUEdTVlwiOlxuICAgICAgICAgIG4gPSBOdW1iZXIocGFydFsyXSk7XG4gICAgICAgICAgaWYgKG4gPiB0aGlzLmVkaXRlZERhdGEuR1BHU1YubGVuZ3RoKSB7XG4gICAgICAgICAgICB3aGlsZSAobiA+IHRoaXMuZWRpdGVkRGF0YS5HUEdTVi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLkdQR1NWLnB1c2goW10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGEuR1BHU1ZbbiAtIDFdID0gcGFydDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIiRHUFJNQ1wiOlxuICAgICAgICAgIHRoaXMuZWRpdGVkRGF0YS5HUFJNQyA9IHBhcnQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCIkR1BWVEdcIjpcbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGEuR1BWVEcgPSBwYXJ0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiJEdQWkRBXCI6XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLkdQWkRBID0gcGFydDtcbiAgICAgICAgICB1dGMgPVxuICAgICAgICAgICAgcGFydFs0XSArXG4gICAgICAgICAgICBcIi9cIiArXG4gICAgICAgICAgICBwYXJ0WzNdICtcbiAgICAgICAgICAgIFwiL1wiICtcbiAgICAgICAgICAgIHBhcnRbMl0gK1xuICAgICAgICAgICAgXCIgXCIgK1xuICAgICAgICAgICAgcGFydFsxXS5zdWJzdHJpbmcoMCwgMikgK1xuICAgICAgICAgICAgXCI6XCIgK1xuICAgICAgICAgICAgcGFydFsxXS5zdWJzdHJpbmcoMiwgNCkgK1xuICAgICAgICAgICAgXCI6XCIgK1xuICAgICAgICAgICAgcGFydFsxXS5zdWJzdHJpbmcoNCwgNikgK1xuICAgICAgICAgICAgXCIgKzAwOjAwXCI7XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLnRpbWVzdGFtcCA9IG5ldyBEYXRlKHV0Yyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgZm9ybWF0ID0gcGFydFswXS5zdWJzdHIoMSk7XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhW2Zvcm1hdF0gPSBwYXJ0O1xuICAgICAgfVxuXG4gICAgICB0aGlzLmVkaXRlZERhdGEuZW5hYmxlID0gdHJ1ZTtcbiAgICAgIHNlbnRlbmNlID0gdGhpcy5yZWFkU2VudGVuY2UoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZWRpdGVkRGF0YTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRHcHNJbmZvKGVkaXRlZERhdGE6IGFueSkge1xuICAgIGNvbnN0IE5NRUFfU0FUSU5TRU5URU5DRTogYW55ID0gNDsgY29uc3QgTk1FQV9NQVhTQVQ6IGFueSA9IDEyO1xuICAgIGVkaXRlZERhdGEgPSBlZGl0ZWREYXRhIHx8IHRoaXMuZ2V0RWRpdGVkRGF0YSgpO1xuICAgIHRoaXMuZ3BzSW5mby5zdGF0dXMgPSBcIlZcIjtcbiAgICBpZiAoZWRpdGVkRGF0YS5lbmFibGUpIHtcbiAgICAgIGlmIChlZGl0ZWREYXRhLkdQR0dBKSB7XG4gICAgICAgIGNvbnN0IGdnYTogYW55ID0gZWRpdGVkRGF0YS5HUEdHQTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLmdwc1F1YWxpdHkgPSBwYXJzZUZsb2F0KGdnYVs2XSk7IC8vIEZpeCBRdWFsaXR5OiAwID0gSW52YWxpZCwgMSA9IEdQUyBmaXgsIDIgPSBER1BTIGZpeFxuICAgICAgICB0aGlzLmdwc0luZm8uaGRvcCA9IHBhcnNlRmxvYXQoZ2dhWzhdKTsgLy8gSG9yaXpvbnRhbCBEaWx1dGlvbiBvZiBQcmVjaXNpb24gKEhET1ApXG4gICAgICAgIHRoaXMuZ3BzSW5mby5hbHRpdHVkZSA9IHBhcnNlRmxvYXQoZ2dhWzldKTsgLy8gQW50ZW5uYSBBbHRpdHVkZSBtZXRlcnMgYWJvdmUgbWVhbiBzZWEgbGV2ZWxcbiAgICAgICAgY29uc3QgbGF0aXR1ZGU6IGFueSA9IHRoaXMubm1lYTJkZChwYXJzZUZsb2F0KGdnYVsyXSkpO1xuICAgICAgICB0aGlzLmdwc0luZm8ubGF0aXR1ZGUgPSBnZ2FbM10gPT09IFwiTlwiID8gbGF0aXR1ZGUgOiAtbGF0aXR1ZGU7XG4gICAgICAgIGNvbnN0IGxvbmdpdHVkZTogYW55ID0gdGhpcy5ubWVhMmRkKHBhcnNlRmxvYXQoZ2dhWzRdKSk7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5sb25naXR1ZGUgPSBnZ2FbNV0gPT09IFwiRVwiID8gbG9uZ2l0dWRlIDogLWxvbmdpdHVkZTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BHR0EpO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BHU1YpIHtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlZGl0ZWREYXRhLkdQR1NWLmxlbmd0aDsgbisrKSB7XG4gICAgICAgICAgaWYgKGVkaXRlZERhdGEuR1BHU1Zbbl0pIHtcbiAgICAgICAgICAgIGNvbnN0IGdzdjogYW55ID0gZWRpdGVkRGF0YS5HUEdTVltuXS5tYXAoKHY6IGFueSkgPT4gcGFyc2VGbG9hdCh2KSk7XG4gICAgICAgICAgICBjb25zdCBwYWNrX2NvdW50OiBhbnkgPSBnc3ZbMV07IGNvbnN0IHBhY2tfaW5kZXg6IGFueSA9IGdzdlsyXTsgY29uc3Qgc2F0X2NvdW50OiBhbnkgPSBnc3ZbM107XG4gICAgICAgICAgICBpZiAocGFja19pbmRleCA+IHBhY2tfY291bnQpIHtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLmluVmlldyA9IHNhdF9jb3VudDtcbiAgICAgICAgICAgIGxldCBuc2F0OiBhbnkgPSAocGFja19pbmRleCAtIDEpICogTk1FQV9TQVRJTlNFTlRFTkNFO1xuICAgICAgICAgICAgbnNhdCA9XG4gICAgICAgICAgICAgIG5zYXQgKyBOTUVBX1NBVElOU0VOVEVOQ0UgPiBzYXRfY291bnRcbiAgICAgICAgICAgICAgICA/IHNhdF9jb3VudCAtIG5zYXRcbiAgICAgICAgICAgICAgICA6IE5NRUFfU0FUSU5TRU5URU5DRTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaXNhdCA9IDA7IGlzYXQgPCBuc2F0OyArK2lzYXQpIHtcbiAgICAgICAgICAgICAgY29uc3QgaXNpOiBhbnkgPSAocGFja19pbmRleCAtIDEpICogTk1FQV9TQVRJTlNFTlRFTkNFICsgaXNhdDtcbiAgICAgICAgICAgICAgaWYgKHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXMubGVuZ3RoIDw9IGlzaSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXMucHVzaCh7fSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc3QgaXNhdG46IGFueSA9IGlzYXQgKiBOTUVBX1NBVElOU0VOVEVOQ0U7XG4gICAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXNbaXNpXSA9IHtcbiAgICAgICAgICAgICAgICBpZDogZ3N2W2lzYXRuICsgNF0sIC8vIFNWIFBSTiBudW1iZXJcbiAgICAgICAgICAgICAgICBlbGV2YXRpb246IGdzdltpc2F0biArIDVdLCAvLyBFbGV2YXRpb24gaW4gZGVncmVlcywgOTAgbWF4aW11bVxuICAgICAgICAgICAgICAgIGF6aW11dGg6IGdzdltpc2F0biArIDZdLCAvLyBBemltdXRoLCBkZWdyZWVzIGZyb20gdHJ1ZSBub3J0aCwgMDAwIHRvIDM1OVxuICAgICAgICAgICAgICAgIHNucjogZ3N2W2lzYXRuICsgN10sIC8vIFNOUiwgMDAtOTkgZEIgKG51bGwgd2hlbiBub3QgdHJhY2tpbmcpXG4gICAgICAgICAgICAgICAgaW5Vc2U6IGZhbHNlLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BHU1YpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BHU0EpIHtcbiAgICAgICAgY29uc3QgZ3NhOiBhbnkgPSBlZGl0ZWREYXRhLkdQR1NBO1xuICAgICAgICBsZXQgbnVzZTogYW55ID0gMDtcbiAgICAgICAgdGhpcy5ncHNJbmZvLmZpeE1vZGUgPSBwYXJzZUZsb2F0KGdzYVsyXSk7IC8vIEZpeCBNb2RlOiAxPUZpeCBub3QgYXZhaWxhYmxlLCAyPTJELCAzPTNEXG4gICAgICAgIHRoaXMuZ3BzSW5mby5wZG9wID0gcGFyc2VGbG9hdChnc2FbMTVdKTsgLy8gUERPUDogUG9zaXRpb24gRGlsdXRpb24gb2YgUHJlY2lzaW9uXG4gICAgICAgIHRoaXMuZ3BzSW5mby5oZG9wID0gcGFyc2VGbG9hdChnc2FbMTZdKTsgLy8gSERPUDogSG9yaXpvbnRhbCBEaWx1dGlvbiBvZiBQcmVjaXNpb25cbiAgICAgICAgdGhpcy5ncHNJbmZvLnZkb3AgPSBwYXJzZUZsb2F0KGdzYVsxN10pOyAvLyBWRE9QOiBWZXJ0aWNhbCBEaWx1dGlvbiBvZiBQb3NpdGlvblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5NRUFfTUFYU0FUOyArK2kpIHtcbiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLmluVmlldzsgKytqKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXNbal0gJiZcbiAgICAgICAgICAgICAgZ3NhW2kgKyAzXSA9PT0gdGhpcy5ncHNJbmZvLnNhdGVsbGl0ZUluZm8uc2F0ZWxsaXRlc1tqXS5pZFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXNbal0uaW5Vc2UgPSB0cnVlO1xuICAgICAgICAgICAgICBudXNlKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLmluVXNlID0gbnVzZTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BHU0EpO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BSTUMpIHtcbiAgICAgICAgY29uc3Qgcm1jOiBhbnkgPSBlZGl0ZWREYXRhLkdQUk1DO1xuICAgICAgICB0aGlzLmdwc0luZm8uc3RhdHVzID0gcm1jWzJdOyAvLyBTdGF0dXMgQWN0aXZlIG9yIFZvaWRcbiAgICAgICAgY29uc3QgbGF0aXR1ZGU6IGFueSA9IHRoaXMubm1lYTJkZChwYXJzZUZsb2F0KHJtY1szXSkpO1xuICAgICAgICB0aGlzLmdwc0luZm8ubGF0aXR1ZGUgPSBybWNbNF0gPT09IFwiTlwiID8gbGF0aXR1ZGUgOiAtbGF0aXR1ZGU7XG4gICAgICAgIGNvbnN0IGxvbmdpdHVkZTogYW55ID0gdGhpcy5ubWVhMmRkKHBhcnNlRmxvYXQocm1jWzVdKSk7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5sb25naXR1ZGUgPSBybWNbNl0gPT09IFwiRVwiID8gbG9uZ2l0dWRlIDogLWxvbmdpdHVkZTtcbiAgICAgICAgY29uc3QgTk1FQV9UVURfS05PVFM6IGFueSA9IDEuODUyOyAvLyAxa25vdD0xLjg1MmttL2hcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNwZWVkID0gcGFyc2VGbG9hdChybWNbN10pICogTk1FQV9UVURfS05PVFM7IC8vIHVuaXQ6IGttL2hcbiAgICAgICAgdGhpcy5ncHNJbmZvLmRpcmVjdGlvbiA9IHJtY1s4XTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BSTUMpO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BWVEcpIHtcbiAgICAgICAgY29uc3QgdnRnOiBhbnkgPSBlZGl0ZWREYXRhLkdQVlRHO1xuICAgICAgICB0aGlzLmdwc0luZm8uZGlyZWN0aW9uID0gcGFyc2VGbG9hdCh2dGdbMV0pO1xuICAgICAgICB0aGlzLmdwc0luZm8uZGVjbGluYXRpb24gPSBwYXJzZUZsb2F0KHZ0Z1szXSk7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5zcGVlZCA9IHBhcnNlRmxvYXQodnRnWzddKTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BWVEcpO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BaREEpIHtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnV0YyA9IGVkaXRlZERhdGEudGltZXN0YW1wO1xuICAgICAgICB0aGlzLmdwc0luZm8uc2VudGVuY2VzLmFkZCh0aGlzLmdwc0luZm8uX3NlbnRlbmNlVHlwZS5HUFpEQSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmdwc0luZm87XG4gIH1cblxuICBwdWJsaWMgX21uZWFUbyhmb3JtYXQ6IGFueSwgdmFsdWU6IGFueSkge1xuICAgIGxldCByZXN1bHQ6IGFueSA9IHRoaXMubm1lYTJkZCh2YWx1ZSk7XG4gICAgaWYgKHR5cGVvZiBmb3JtYXQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHN3aXRjaCAoZm9ybWF0LnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgICAgY2FzZSBcIkRNU1wiOlxuICAgICAgICAgIHJlc3VsdCA9IHRoaXMubm1lYTJkbXModmFsdWUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiRE1cIjpcbiAgICAgICAgICByZXN1bHQgPSB0aGlzLm5tZWEyZG0odmFsdWUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiU1wiOlxuICAgICAgICAgIHJlc3VsdCA9IHRoaXMubm1lYTJzKHZhbHVlKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHB1YmxpYyBsYXRpdHVkZVRvKGZvcm1hdDogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMuX21uZWFUbyhmb3JtYXQsIHRoaXMuX2xhdGl0dWRlKTtcbiAgfVxuXG4gIHB1YmxpYyBsb25naXR1ZGVUbyhmb3JtYXQ6IGFueSkge1xuICAgIHJldHVybiB0aGlzLl9tbmVhVG8oZm9ybWF0LCB0aGlzLl9sb25naXR1ZGUpO1xuICB9XG5cbiAgcHVibGljIHN0YXR1czJzdHJpbmcoc3RhdHVzOiBhbnkpIHtcbiAgICBzdGF0dXMgPSBzdGF0dXMgfHwgdGhpcy5zdGF0dXM7XG4gICAgaWYgKHN0YXR1cyA9PT0gXCJBXCIpIHtcbiAgICAgIHJldHVybiBcIkFjdGl2ZVwiO1xuICAgIH1cbiAgICBpZiAoc3RhdHVzID09PSBcIlZcIikge1xuICAgICAgcmV0dXJuIFwiVm9pZFwiO1xuICAgIH1cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9XG5cbiAgcHVibGljIGZpeE1vZGUyc3RyaW5nKGZpeE1vZGU6IGFueSkge1xuICAgIGZpeE1vZGUgPSBmaXhNb2RlIHx8IHRoaXMuZml4TW9kZTtcbiAgICBpZiAoZml4TW9kZSA9PT0gMSkge1xuICAgICAgcmV0dXJuIFwiRml4IG5vdCBhdmFpbGFibGVcIjtcbiAgICB9XG4gICAgaWYgKGZpeE1vZGUgPT09IDIpIHtcbiAgICAgIHJldHVybiBcIjJEXCI7XG4gICAgfVxuICAgIGlmIChmaXhNb2RlID09PSAzKSB7XG4gICAgICByZXR1cm4gXCIzRFwiO1xuICAgIH1cbiAgICByZXR1cm4gZml4TW9kZTtcbiAgfVxuXG4gIHB1YmxpYyBncHNRdWFsaXR5MnN0cmluZyhncHNRdWFsaXR5OiBhbnkpIHtcbiAgICBncHNRdWFsaXR5ID0gZ3BzUXVhbGl0eSB8fCB0aGlzLmdwc1F1YWxpdHk7XG4gICAgaWYgKGdwc1F1YWxpdHkgPT09IDApIHtcbiAgICAgIHJldHVybiBcIkludmFsaWRcIjtcbiAgICB9XG4gICAgaWYgKGdwc1F1YWxpdHkgPT09IDEpIHtcbiAgICAgIHJldHVybiBcIkdQUyBmaXhcIjtcbiAgICB9XG4gICAgaWYgKGdwc1F1YWxpdHkgPT09IDIpIHtcbiAgICAgIHJldHVybiBcIkRHUFMgZml4XCI7XG4gICAgfVxuICAgIHJldHVybiBncHNRdWFsaXR5O1xuICB9XG5cbiAgLy8gLS0tIGxhdGl0dWRlL2xvbmdpdHVkZSBNTkVBIGZvcm1hdCBjaGFuZ2UgdG8gZWFjaCB1bml0XG4gIHB1YmxpYyBubWVhMmRtcyh2YWw6IGFueSkge1xuICAgIC8vIE5NRUEgZm9ybWF0IHRvIERNUyBmb3JtYXQgc3RyaW5nICg5OTnCsCA5OSc5OS45XCIpXG4gICAgdmFsID0gcGFyc2VGbG9hdCh2YWwpO1xuICAgIGNvbnN0IGQ6IGFueSA9IE1hdGguZmxvb3IodmFsIC8gMTAwKTtcbiAgICBjb25zdCBtOiBhbnkgPSBNYXRoLmZsb29yKCh2YWwgLyAxMDAuMCAtIGQpICogMTAwLjApO1xuICAgIGNvbnN0IHM6IGFueSA9ICgodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wIC0gbSkgKiA2MDtcbiAgICByZXR1cm4gZCArIFwiwrBcIiArIG0gKyBcIidcIiArIHMudG9GaXhlZCgxKSArICdcIic7XG4gIH1cblxuICBwdWJsaWMgbm1lYTJkbSh2YWw6IGFueSkge1xuICAgIC8vIE5NRUEgZm9ybWF0IHRvIERNIGZvcm1hdCBzdHJpbmcgKDk5OcKwIDk5Ljk5OTknKVxuICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcbiAgICBjb25zdCBkOiBhbnkgPSBNYXRoLmZsb29yKHZhbCAvIDEwMC4wKTtcbiAgICBjb25zdCBtOiBhbnkgPSAodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wO1xuICAgIHJldHVybiBkICsgXCLCsFwiICsgbS50b0ZpeGVkKDQpICsgXCInXCI7XG4gIH1cblxuICBwdWJsaWMgbm1lYTJkZCh2YWw6IGFueSkge1xuICAgIC8vIE5NRUEgZm9ybWF0IHRvIEREIGZvcm1hdCBkZWNpbWFsICg5OTkuOTk5OTk5KVxuICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcbiAgICBjb25zdCBkOiBhbnkgPSBNYXRoLmZsb29yKHZhbCAvIDEwMC4wKTtcbiAgICBjb25zdCBtOiBhbnkgPSBNYXRoLmZsb29yKCgodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wKSAvIDYwKTtcbiAgICBjb25zdCBzOiBhbnkgPSAoKCh2YWwgLyAxMDAuMCAtIGQpICogMTAwLjAgLSBtKSAqIDYwKSAvICg2MCAqIDYwKTtcbiAgICByZXR1cm4gcGFyc2VGbG9hdCgoZCArIG0gKyBzKS50b0ZpeGVkKDYpKTtcbiAgfVxuXG4gIHB1YmxpYyBubWVhMnModmFsOiBhbnkpIHtcbiAgICAvLyBOTUVBIGZvcm1hdCB0byBTIGZvcm1hdCBkZWNpbWFsICg5OTk5OS45OTk5KVxuICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcbiAgICBjb25zdCBkOiBhbnkgPSBNYXRoLmZsb29yKHZhbCAvIDEwMC4wKTtcbiAgICBjb25zdCBtOiBhbnkgPSBNYXRoLmZsb29yKCgodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wKSAvIDYwKTtcbiAgICBjb25zdCBzOiBhbnkgPSAoKCh2YWwgLyAxMDAuMCAtIGQpICogMTAwLjAgLSBtKSAqIDYwKSAvICg2MCAqIDYwKTtcbiAgICByZXR1cm4gKGQgKyBtICsgcykgLyAoMS4wIC8gNjAuMCAvIDYwLjApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdZU0ZETUFYQjtcbiJdfQ==
