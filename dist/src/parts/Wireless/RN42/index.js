"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class RN42 {
    constructor() {
        this.keys = ["tx", "rx", "gnd"];
        this.requiredKeys = ["tx", "rx"];
    }
    static info() {
        return {
            name: "RN42",
        };
    }
    wired(obniz) {
        if (obniz.isValidIO(this.params.gnd)) {
            obniz.getIO(this.params.gnd).output(false);
        }
        this.uart = obniz.getFreeUart();
        this.uart.start({
            tx: this.params.tx,
            rx: this.params.rx,
            baud: 115200,
            drive: "3v",
        });
        const self = this;
        this.uart.onreceive = (data, text) => {
            // this is not perfect. separation is possible.
            if (text.indexOf("CONNECT") >= 0) {
                console.log("connected");
            }
            else if (text.indexOf("DISCONNECT") >= 0) {
                console.log("disconnected");
            }
            if (typeof self.onreceive === "function") {
                self.onreceive(data, text);
            }
        };
    }
    send(data) {
        this.uart.send(data);
    }
    sendCommand(data) {
        this.uart.send(data + "\n");
        this.obniz.wait(100);
    }
    enterCommandMode() {
        this.send("$$$");
        this.obniz.wait(100);
    }
    config(json) {
        this.enterCommandMode();
        if (typeof json !== "object") {
            // TODO: warning
            return;
        }
        // remove noize data
        this.sendCommand("");
        if (json.master_slave) {
            this.config_masterslave(json.master_slave);
        }
        if (json.auth) {
            this.config_auth(json.auth);
        }
        if (json.hid_flag) {
            this.config_HIDflag(json.hid_flag);
        }
        if (json.profile) {
            this.config_profile(json.profile);
        }
        if (json.power) {
            this.config_power(json.power);
        }
        if (json.display_name) {
            this.config_displayName(json.display_name);
        }
        this.config_reboot();
    }
    config_reboot() {
        this.sendCommand("R,1");
    }
    config_masterslave(mode) {
        let val = -1;
        if (typeof mode === "number") {
            val = mode;
        }
        else if (typeof mode === "string") {
            const modes = [
                "slave",
                "master",
                "trigger",
                "auto-connect-master",
                "auto-connect-dtr",
                "auto-connect-any",
                "pairing",
            ];
            for (let i = 0; i < modes.length; i++) {
                if (modes[i] === mode) {
                    val = i;
                    break;
                }
            }
        }
        if (val === -1) {
            // TODO: warning
            return;
        }
        this.sendCommand("SM," + val);
    }
    config_displayName(name) {
        this.sendCommand("SN," + name);
    }
    // // SH,0200 HID Flag register. Descriptor=keyboard
    config_HIDflag(flag) {
        this.sendCommand("SH," + flag);
    }
    config_profile(mode) {
        let val = -1;
        if (typeof mode === "number") {
            val = mode;
        }
        else if (typeof mode === "string") {
            const modes = [
                "SPP",
                "DUN-DCE",
                "DUN-DTE",
                "MDM-SPP",
                "SPP-DUN-DCE",
                "APL",
                "HID",
            ];
            for (let i = 0; i < modes.length; i++) {
                if (modes[i] === mode) {
                    val = i;
                    break;
                }
            }
        }
        if (val === -1) {
            // TODO: warning
            return;
        }
        this.sendCommand("S~," + val);
    }
    config_revert_localecho() {
        this.sendCommand("+");
    }
    config_auth(mode) {
        let val = -1;
        if (typeof mode === "number") {
            val = mode;
        }
        else if (typeof mode === "string") {
            const modes = ["open", "ssp-keyboard", "just-work", "pincode"];
            for (let i = 0; i < modes.length; i++) {
                if (modes[i] === mode) {
                    val = i;
                    break;
                }
            }
        }
        if (val === -1) {
            // TODO: warning
            return;
        }
        this.sendCommand("SA," + val);
    }
    config_power(dbm) {
        let val = "0010";
        if (16 > dbm && dbm >= 12) {
            val = "000C";
        }
        else if (12 > dbm && dbm >= 8) {
            val = "0008";
        }
        else if (8 > dbm && dbm >= 4) {
            val = "0004";
        }
        else if (4 > dbm && dbm >= 0) {
            val = "0000";
        }
        else if (0 > dbm && dbm >= -4) {
            val = "FFFC";
        }
        else if (-4 > dbm && dbm >= -8) {
            val = "FFF8";
        }
        else if (-8 > dbm) {
            val = "FFF4";
        }
        this.sendCommand("SY," + val);
    }
    config_get_setting() {
        this.sendCommand("D");
    }
    config_get_extendSetting() {
        this.sendCommand("E");
    }
}
exports.default = RN42;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9XaXJlbGVzcy9STjQyL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTSxJQUFJO0lBZVI7UUFDRSxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFoQk0sTUFBTSxDQUFDLElBQUk7UUFDaEIsT0FBTztZQUNMLElBQUksRUFBRSxNQUFNO1NBQ2IsQ0FBQztJQUNKLENBQUM7SUFjTSxLQUFLLENBQUMsS0FBVTtRQUNyQixJQUFJLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNwQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzVDO1FBRUQsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDZCxFQUFFLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ2xCLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDbEIsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsSUFBSTtTQUNaLENBQUMsQ0FBQztRQUNILE1BQU0sSUFBSSxHQUFRLElBQUksQ0FBQztRQUN2QixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLElBQVMsRUFBRSxJQUFTLEVBQUUsRUFBRTtZQUM3QywrQ0FBK0M7WUFDL0MsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDaEMsT0FBTyxDQUFDLEdBQUcs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R0FBRyxHQUFHLE1BQU0sQ0FBQztTQUNkO2FBQU0sSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUU7WUFDOUIsR0FBRyxHQUFHLE1BQU0sQ0FBQztTQUNkO2FBQU0sSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsRUFBRTtZQUMvQixHQUFHLEdBQUcsTUFBTSxDQUFDO1NBQ2Q7YUFBTSxJQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLEVBQUU7WUFDaEMsR0FBRyxHQUFHLE1BQU0sQ0FBQztTQUNkO2FBQU0sSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLEVBQUU7WUFDbkIsR0FBRyxHQUFHLE1BQU0sQ0FBQztTQUNkO1FBRUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVNLGtCQUFrQjtRQUN2QixJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLENBQUM7SUFFTSx3QkFBd0I7UUFDN0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN4QixDQUFDO0NBQ0Y7QUFFRCxrQkFBZSxJQUFJLENBQUMiLCJmaWxlIjoic3JjL3BhcnRzL1dpcmVsZXNzL1JONDIvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBSTjQyIHtcblxuICBwdWJsaWMgc3RhdGljIGluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IFwiUk40MlwiLFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMga2V5czogYW55O1xuICBwdWJsaWMgcmVxdWlyZWRLZXlzOiBhbnk7XG4gIHB1YmxpYyBwYXJhbXM6IGFueTtcbiAgcHVibGljIHVhcnQ6IGFueTtcbiAgcHVibGljIG9ibml6OiBhbnk7XG4gIHB1YmxpYyBvbnJlY2VpdmU6IGFueTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmtleXMgPSBbXCJ0eFwiLCBcInJ4XCIsIFwiZ25kXCJdO1xuICAgIHRoaXMucmVxdWlyZWRLZXlzID0gW1widHhcIiwgXCJyeFwiXTtcbiAgfVxuXG4gIHB1YmxpYyB3aXJlZChvYm5pejogYW55KSB7XG4gICAgaWYgKG9ibml6LmlzVmFsaWRJTyh0aGlzLnBhcmFtcy5nbmQpKSB7XG4gICAgICBvYm5pei5nZXRJTyh0aGlzLnBhcmFtcy5nbmQpLm91dHB1dChmYWxzZSk7XG4gICAgfVxuXG4gICAgdGhpcy51YXJ0ID0gb2JuaXouZ2V0RnJlZVVhcnQoKTtcblxuICAgIHRoaXMudWFydC5zdGFydCh7XG4gICAgICB0eDogdGhpcy5wYXJhbXMudHgsXG4gICAgICByeDogdGhpcy5wYXJhbXMucngsXG4gICAgICBiYXVkOiAxMTUyMDAsXG4gICAgICBkcml2ZTogXCIzdlwiLFxuICAgIH0pO1xuICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XG4gICAgdGhpcy51YXJ0Lm9ucmVjZWl2ZSA9IChkYXRhOiBhbnksIHRleHQ6IGFueSkgPT4ge1xuICAgICAgLy8gdGhpcyBpcyBub3QgcGVyZmVjdC4gc2VwYXJhdGlvbiBpcyBwb3NzaWJsZS5cbiAgICAgIGlmICh0ZXh0LmluZGV4T2YoXCJDT05ORUNUXCIpID49IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjb25uZWN0ZWRcIik7XG4gICAgICB9IGVsc2UgaWYgKHRleHQuaW5kZXhPZihcIkRJU0NPTk5FQ1RcIikgPj0gMCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImRpc2Nvbm5lY3RlZFwiKTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2Ygc2VsZi5vbnJlY2VpdmUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBzZWxmLm9ucmVjZWl2ZShkYXRhLCB0ZXh0KTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHNlbmQoZGF0YTogYW55KSB7XG4gICAgdGhpcy51YXJ0LnNlbmQoZGF0YSk7XG4gIH1cblxuICBwdWJsaWMgc2VuZENvbW1hbmQoZGF0YTogYW55KSB7XG4gICAgdGhpcy51YXJ0LnNlbmQoZGF0YSArIFwiXFxuXCIpO1xuICAgIHRoaXMub2JuaXoud2FpdCgxMDApO1xuICB9XG5cbiAgcHVibGljIGVudGVyQ29tbWFuZE1vZGUoKSB7XG4gICAgdGhpcy5zZW5kKFwiJCQkXCIpO1xuICAgIHRoaXMub2JuaXoud2FpdCgxMDApO1xuICB9XG5cbiAgcHVibGljIGNvbmZpZyhqc29uOiBhbnkpIHtcbiAgICB0aGlzLmVudGVyQ29tbWFuZE1vZGUoKTtcbiAgICBpZiAodHlwZW9mIGpzb24gIT09IFwib2JqZWN0XCIpIHtcbiAgICAgIC8vIFRPRE86IHdhcm5pbmdcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gcmVtb3ZlIG5vaXplIGRhdGFcbiAgICB0aGlzLnNlbmRDb21tYW5kKFwiXCIpO1xuXG4gICAgaWYgKGpzb24ubWFzdGVyX3NsYXZlKSB7XG4gICAgICB0aGlzLmNvbmZpZ19tYXN0ZXJzbGF2ZShqc29uLm1hc3Rlcl9zbGF2ZSk7XG4gICAgfVxuICAgIGlmIChqc29uLmF1dGgpIHtcbiAgICAgIHRoaXMuY29uZmlnX2F1dGgoanNvbi5hdXRoKTtcbiAgICB9XG4gICAgaWYgKGpzb24uaGlkX2ZsYWcpIHtcbiAgICAgIHRoaXMuY29uZmlnX0hJRGZsYWcoanNvbi5oaWRfZmxhZyk7XG4gICAgfVxuICAgIGlmIChqc29uLnByb2ZpbGUpIHtcbiAgICAgIHRoaXMuY29uZmlnX3Byb2ZpbGUoanNvbi5wcm9maWxlKTtcbiAgICB9XG4gICAgaWYgKGpzb24ucG93ZXIpIHtcbiAgICAgIHRoaXMuY29uZmlnX3Bvd2VyKGpzb24ucG93ZXIpO1xuICAgIH1cbiAgICBpZiAoanNvbi5kaXNwbGF5X25hbWUpIHtcbiAgICAgIHRoaXMuY29uZmlnX2Rpc3BsYXlOYW1lKGpzb24uZGlzcGxheV9uYW1lKTtcbiAgICB9XG4gICAgdGhpcy5jb25maWdfcmVib290KCk7XG4gIH1cblxuICBwdWJsaWMgY29uZmlnX3JlYm9vdCgpIHtcbiAgICB0aGlzLnNlbmRDb21tYW5kKFwiUiwxXCIpO1xuICB9XG5cbiAgcHVibGljIGNvbmZpZ19tYXN0ZXJzbGF2ZShtb2RlOiBhbnkpIHtcbiAgICBsZXQgdmFsOiBhbnkgPSAtMTtcbiAgICBpZiAodHlwZW9mIG1vZGUgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgIHZhbCA9IG1vZGU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbW9kZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgY29uc3QgbW9kZXM6IGFueSA9IFtcbiAgICAgICAgXCJzbGF2ZVwiLFxuICAgICAgICBcIm1hc3RlclwiLFxuICAgICAgICBcInRyaWdnZXJcIixcbiAgICAgICAgXCJhdXRvLWNvbm5lY3QtbWFzdGVyXCIsXG4gICAgICAgIFwiYXV0by1jb25uZWN0LWR0clwiLFxuICAgICAgICBcImF1dG8tY29ubmVjdC1hbnlcIixcbiAgICAgICAgXCJwYWlyaW5nXCIsXG4gICAgICBdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAobW9kZXNbaV0gPT09IG1vZGUpIHtcbiAgICAgICAgICB2YWwgPSBpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh2YWwgPT09IC0xKSB7XG4gICAgICAvLyBUT0RPOiB3YXJuaW5nXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2VuZENvbW1hbmQoXCJTTSxcIiArIHZhbCk7XG4gIH1cblxuICBwdWJsaWMgY29uZmlnX2Rpc3BsYXlOYW1lKG5hbWU6IGFueSkge1xuICAgIHRoaXMuc2VuZENvbW1hbmQoXCJTTixcIiArIG5hbWUpO1xuICB9XG5cbiAgLy8gLy8gU0gsMDIwMCBISUQgRmxhZyByZWdpc3Rlci4gRGVzY3JpcHRvcj1rZXlib2FyZFxuICBwdWJsaWMgY29uZmlnX0hJRGZsYWcoZmxhZzogYW55KSB7XG4gICAgdGhpcy5zZW5kQ29tbWFuZChcIlNILFwiICsgZmxhZyk7XG4gIH1cblxuICBwdWJsaWMgY29uZmlnX3Byb2ZpbGUobW9kZTogYW55KSB7XG4gICAgbGV0IHZhbDogYW55ID0gLTE7XG4gICAgaWYgKHR5cGVvZiBtb2RlID09PSBcIm51bWJlclwiKSB7XG4gICAgICB2YWwgPSBtb2RlO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vZGUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGNvbnN0IG1vZGVzOiBhbnkgPSBbXG4gICAgICAgIFwiU1BQXCIsXG4gICAgICAgIFwiRFVOLURDRVwiLFxuICAgICAgICBcIkRVTi1EVEVcIixcbiAgICAgICAgXCJNRE0tU1BQXCIsXG4gICAgICAgIFwiU1BQLURVTi1EQ0VcIixcbiAgICAgICAgXCJBUExcIixcbiAgICAgICAgXCJISURcIixcbiAgICAgIF07XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChtb2Rlc1tpXSA9PT0gbW9kZSkge1xuICAgICAgICAgIHZhbCA9IGk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHZhbCA9PT0gLTEpIHtcbiAgICAgIC8vIFRPRE86IHdhcm5pbmdcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZW5kQ29tbWFuZChcIlN+LFwiICsgdmFsKTtcbiAgfVxuXG4gIHB1YmxpYyBjb25maWdfcmV2ZXJ0X2xvY2FsZWNobygpIHtcbiAgICB0aGlzLnNlbmRDb21tYW5kKFwiK1wiKTtcbiAgfVxuXG4gIHB1YmxpYyBjb25maWdfYXV0aChtb2RlOiBhbnkpIHtcbiAgICBsZXQgdmFsOiBhbnkgPSAtMTtcbiAgICBpZiAodHlwZW9mIG1vZGUgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgIHZhbCA9IG1vZGU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbW9kZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgY29uc3QgbW9kZXM6IGFueSA9IFtcIm9wZW5cIiwgXCJzc3Ata2V5Ym9hcmRcIiwgXCJqdXN0LXdvcmtcIiwgXCJwaW5jb2RlXCJdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAobW9kZXNbaV0gPT09IG1vZGUpIHtcbiAgICAgICAgICB2YWwgPSBpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh2YWwgPT09IC0xKSB7XG4gICAgICAvLyBUT0RPOiB3YXJuaW5nXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2VuZENvbW1hbmQoXCJTQSxcIiArIHZhbCk7XG4gIH1cblxuICBwdWJsaWMgY29uZmlnX3Bvd2VyKGRibTogYW55KSB7XG4gICAgbGV0IHZhbDogYW55ID0gXCIwMDEwXCI7XG4gICAgaWYgKDE2ID4gZGJtICYmIGRibSA+PSAxMikge1xuICAgICAgdmFsID0gXCIwMDBDXCI7XG4gICAgfSBlbHNlIGlmICgxMiA+IGRibSAmJiBkYm0gPj0gOCkge1xuICAgICAgdmFsID0gXCIwMDA4XCI7XG4gICAgfSBlbHNlIGlmICg4ID4gZGJtICYmIGRibSA+PSA0KSB7XG4gICAgICB2YWwgPSBcIjAwMDRcIjtcbiAgICB9IGVsc2UgaWYgKDQgPiBkYm0gJiYgZGJtID49IDApIHtcbiAgICAgIHZhbCA9IFwiMDAwMFwiO1xuICAgIH0gZWxzZSBpZiAoMCA+IGRibSAmJiBkYm0gPj0gLTQpIHtcbiAgICAgIHZhbCA9IFwiRkZGQ1wiO1xuICAgIH0gZWxzZSBpZiAoLTQgPiBkYm0gJiYgZGJtID49IC04KSB7XG4gICAgICB2YWwgPSBcIkZGRjhcIjtcbiAgICB9IGVsc2UgaWYgKC04ID4gZGJtKSB7XG4gICAgICB2YWwgPSBcIkZGRjRcIjtcbiAgICB9XG5cbiAgICB0aGlzLnNlbmRDb21tYW5kKFwiU1ksXCIgKyB2YWwpO1xuICB9XG5cbiAgcHVibGljIGNvbmZpZ19nZXRfc2V0dGluZygpIHtcbiAgICB0aGlzLnNlbmRDb21tYW5kKFwiRFwiKTtcbiAgfVxuXG4gIHB1YmxpYyBjb25maWdfZ2V0X2V4dGVuZFNldHRpbmcoKSB7XG4gICAgdGhpcy5zZW5kQ29tbWFuZChcIkVcIik7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUk40MjtcbiJdfQ==
