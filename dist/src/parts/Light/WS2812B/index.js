"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class WS2812B {
    constructor() {
        this.keys = ["din", "vcc", "gnd"];
        this.requiredKeys = ["din"];
    }
    static info() {
        return {
            name: "WS2812B",
        };
    }
    static _generateFromByte(val) {
        // T0H 0.35us+-0.15us
        // T1H 0.9us+-0.15us
        // T0L 0.9us+-0.15us
        // T1L 0.35us+-0.15us
        // 0.3-0.9 and 0.9-0.3 at 3.33Mhz
        val = parseInt(val);
        const zero = 0x8;
        const one = 0xe;
        const ret = [];
        for (let i = 0; i < 8; i += 2) {
            let byte = 0;
            if (val & (0x80 >> i)) {
                byte = one << 4;
            }
            else {
                byte = zero << 4;
            }
            if (val & (0x80 >> (i + 1))) {
                byte |= one;
            }
            else {
                byte |= zero;
            }
            ret.push(byte);
        }
        return ret;
    }
    static _generateColor(r, g, b) {
        let array = WS2812B._generateFromByte(g);
        array = array.concat(WS2812B._generateFromByte(r));
        array = array.concat(WS2812B._generateFromByte(b));
        return array;
    }
    static _generateHsvColor(h, s, v) {
        const C = v * s;
        const Hp = h / 60;
        const X = C * (1 - Math.abs((Hp % 2) - 1));
        let R;
        let G;
        let B;
        if (0 <= Hp && Hp < 1) {
            [R, G, B] = [C, X, 0];
        }
        if (1 <= Hp && Hp < 2) {
            [R, G, B] = [X, C, 0];
        }
        if (2 <= Hp && Hp < 3) {
            [R, G, B] = [0, C, X];
        }
        if (3 <= Hp && Hp < 4) {
            [R, G, B] = [0, X, C];
        }
        if (4 <= Hp && Hp < 5) {
            [R, G, B] = [X, 0, C];
        }
        if (5 <= Hp && Hp < 6) {
            [R, G, B] = [C, 0, X];
        }
        const m = v - C;
        [R, G, B] = [R + m, G + m, B + m];
        R = Math.floor(R * 255);
        G = Math.floor(G * 255);
        B = Math.floor(B * 255);
        return WS2812B._generateColor(R, G, B);
    }
    wired(obniz) {
        this.obniz = obniz;
        obniz.setVccGnd(this.params.vcc, this.params.gnd, "5v");
        this.params.mode = "master";
        this.params.frequency = Math.floor(3.33 * 1000 * 1000);
        this.params.mosi = this.params.din;
        this.params.drive = "5v"; // It over spec for frequency. But VIN-HI require 0.7VCC<=.
        this.spi = this.obniz.getSpiWithConfig(this.params);
    }
    rgb(r, g, b) {
        this.spi.write(WS2812B._generateColor(r, g, b));
    }
    hsv(h, s, v) {
        this.spi.write(WS2812B._generateHsvColor(h, s, v));
    }
    rgbs(array) {
        let bytes = [];
        for (let i = 0; i < array.length; i++) {
            const oneArray = array[i];
            bytes = bytes.concat(WS2812B._generateColor(oneArray[0], oneArray[1], oneArray[2]));
        }
        this.spi.write(bytes);
    }
    hsvs(array) {
        let bytes = [];
        for (let i = 0; i < array.length; i++) {
            const oneArray = array[i];
            bytes = bytes.concat(WS2812B._generateHsvColor(oneArray[0], oneArray[1], oneArray[2]));
        }
        this.spi.write(bytes);
    }
}
exports.default = WS2812B;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9MaWdodC9XUzI4MTJCL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTSxPQUFPO0lBcUZYO1FBQ0UsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUF0Rk0sTUFBTSxDQUFDLElBQUk7UUFDaEIsT0FBTztZQUNMLElBQUksRUFBRSxTQUFTO1NBQ2hCLENBQUM7SUFDSixDQUFDO0lBRU0sTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQVE7UUFDdEMscUJBQXFCO1FBQ3JCLG9CQUFvQjtRQUNwQixvQkFBb0I7UUFDcEIscUJBQXFCO1FBRXJCLGlDQUFpQztRQUVqQyxHQUFHLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BCLE1BQU0sSUFBSSxHQUFRLEdBQUcsQ0FBQztRQUN0QixNQUFNLEdBQUcsR0FBUSxHQUFHLENBQUM7UUFDckIsTUFBTSxHQUFHLEdBQVEsRUFBRSxDQUFDO1FBQ3BCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM3QixJQUFJLElBQUksR0FBUSxDQUFDLENBQUM7WUFDbEIsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLEVBQUU7Z0JBQ3JCLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDO2FBQ2pCO2lCQUFNO2dCQUNMLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDO2FBQ2xCO1lBQ0QsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDM0IsSUFBSSxJQUFJLEdBQUcsQ0FBQzthQUNiO2lCQUFNO2dCQUNMLElBQUksSUFBSSxJQUFJLENBQUM7YUFDZDtZQUNELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDaEI7UUFDRCxPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFTSxNQUFNLENBQUMsY0FBYyxDQUFDLENBQU0sRUFBRSxDQUFNLEVBQUUsQ0FBTTtRQUNqRCxJQUFJLEtBQUssR0FBUSxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkQsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRU0sTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQU0sRUFBRSxDQUFNLEVBQUUsQ0FBTTtRQUNwRCxNQUFNLENBQUMsR0FBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sRUFBRSxHQUFRLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDdkIsTUFBTSxDQUFDLEdBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVoRCxJQUFJLENBQU0sQ0FBQztRQUFDLElBQUksQ0FBTSxDQUFDO1FBQUMsSUFBSSxDQUFNLENBQUM7UUFDbkMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDckIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN2QjtRQUNELElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDdkI7UUFDRCxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRTtZQUNyQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDckIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN2QjtRQUNELElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDdkI7UUFDRCxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRTtZQUNyQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBRUQsTUFBTSxDQUFDLEdBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRWxDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUN4QixDQUFDLEdBQUcsSUFBSSxDQUFD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dHMvTGlnaHQvV1MyODEyQi9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFdTMjgxMkIge1xuXG4gIHB1YmxpYyBzdGF0aWMgaW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogXCJXUzI4MTJCXCIsXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgX2dlbmVyYXRlRnJvbUJ5dGUodmFsOiBhbnkpIHtcbiAgICAvLyBUMEggMC4zNXVzKy0wLjE1dXNcbiAgICAvLyBUMUggMC45dXMrLTAuMTV1c1xuICAgIC8vIFQwTCAwLjl1cystMC4xNXVzXG4gICAgLy8gVDFMIDAuMzV1cystMC4xNXVzXG5cbiAgICAvLyAwLjMtMC45IGFuZCAwLjktMC4zIGF0IDMuMzNNaHpcblxuICAgIHZhbCA9IHBhcnNlSW50KHZhbCk7XG4gICAgY29uc3QgemVybzogYW55ID0gMHg4O1xuICAgIGNvbnN0IG9uZTogYW55ID0gMHhlO1xuICAgIGNvbnN0IHJldDogYW55ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpICs9IDIpIHtcbiAgICAgIGxldCBieXRlOiBhbnkgPSAwO1xuICAgICAgaWYgKHZhbCAmICgweDgwID4+IGkpKSB7XG4gICAgICAgIGJ5dGUgPSBvbmUgPDwgNDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJ5dGUgPSB6ZXJvIDw8IDQ7XG4gICAgICB9XG4gICAgICBpZiAodmFsICYgKDB4ODAgPj4gKGkgKyAxKSkpIHtcbiAgICAgICAgYnl0ZSB8PSBvbmU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBieXRlIHw9IHplcm87XG4gICAgICB9XG4gICAgICByZXQucHVzaChieXRlKTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgX2dlbmVyYXRlQ29sb3IocjogYW55LCBnOiBhbnksIGI6IGFueSkge1xuICAgIGxldCBhcnJheTogYW55ID0gV1MyODEyQi5fZ2VuZXJhdGVGcm9tQnl0ZShnKTtcbiAgICBhcnJheSA9IGFycmF5LmNvbmNhdChXUzI4MTJCLl9nZW5lcmF0ZUZyb21CeXRlKHIpKTtcbiAgICBhcnJheSA9IGFycmF5LmNvbmNhdChXUzI4MTJCLl9nZW5lcmF0ZUZyb21CeXRlKGIpKTtcbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIF9nZW5lcmF0ZUhzdkNvbG9yKGg6IGFueSwgczogYW55LCB2OiBhbnkpIHtcbiAgICBjb25zdCBDOiBhbnkgPSB2ICogcztcbiAgICBjb25zdCBIcDogYW55ID0gaCAvIDYwO1xuICAgIGNvbnN0IFg6IGFueSA9IEMgKiAoMSAtIE1hdGguYWJzKChIcCAlIDIpIC0gMSkpO1xuXG4gICAgbGV0IFI6IGFueTsgbGV0IEc6IGFueTsgbGV0IEI6IGFueTtcbiAgICBpZiAoMCA8PSBIcCAmJiBIcCA8IDEpIHtcbiAgICAgIFtSLCBHLCBCXSA9IFtDLCBYLCAwXTtcbiAgICB9XG4gICAgaWYgKDEgPD0gSHAgJiYgSHAgPCAyKSB7XG4gICAgICBbUiwgRywgQl0gPSBbWCwgQywgMF07XG4gICAgfVxuICAgIGlmICgyIDw9IEhwICYmIEhwIDwgMykge1xuICAgICAgW1IsIEcsIEJdID0gWzAsIEMsIFhdO1xuICAgIH1cbiAgICBpZiAoMyA8PSBIcCAmJiBIcCA8IDQpIHtcbiAgICAgIFtSLCBHLCBCXSA9IFswLCBYLCBDXTtcbiAgICB9XG4gICAgaWYgKDQgPD0gSHAgJiYgSHAgPCA1KSB7XG4gICAgICBbUiwgRywgQl0gPSBbWCwgMCwgQ107XG4gICAgfVxuICAgIGlmICg1IDw9IEhwICYmIEhwIDwgNikge1xuICAgICAgW1IsIEcsIEJdID0gW0MsIDAsIFhdO1xuICAgIH1cblxuICAgIGNvbnN0IG06IGFueSA9IHYgLSBDO1xuICAgIFtSLCBHLCBCXSA9IFtSICsgbSwgRyArIG0sIEIgKyBtXTtcblxuICAgIFIgPSBNYXRoLmZsb29yKFIgKiAyNTUpO1xuICAgIEcgPSBNYXRoLmZsb29yKEcgKiAyNTUpO1xuICAgIEIgPSBNYXRoLmZsb29yKEIgKiAyNTUpO1xuXG4gICAgcmV0dXJuIFdTMjgxMkIuX2dlbmVyYXRlQ29sb3IoUiwgRywgQik7XG4gIH1cblxuICBwdWJsaWMga2V5czogYW55O1xuICBwdWJsaWMgcmVxdWlyZWRLZXlzOiBhbnk7XG4gIHB1YmxpYyBvYm5pejogYW55O1xuICBwdWJsaWMgcGFyYW1zOiBhbnk7XG4gIHB1YmxpYyBzcGk6IGFueTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmtleXMgPSBbXCJkaW5cIiwgXCJ2Y2NcIiwgXCJnbmRcIl07XG4gICAgdGhpcy5yZXF1aXJlZEtleXMgPSBbXCJkaW5cIl07XG4gIH1cblxuICBwdWJsaWMgd2lyZWQob2JuaXo6IGFueSkge1xuICAgIHRoaXMub2JuaXogPSBvYm5pejtcblxuICAgIG9ibml6LnNldFZjY0duZCh0aGlzLnBhcmFtcy52Y2MsIHRoaXMucGFyYW1zLmduZCwgXCI1dlwiKTtcblxuICAgIHRoaXMucGFyYW1zLm1vZGUgPSBcIm1hc3RlclwiO1xuICAgIHRoaXMucGFyYW1zLmZyZXF1ZW5jeSA9IE1hdGguZmxvb3IoMy4zMyAqIDEwMDAgKiAxMDAwKTtcbiAgICB0aGlzLnBhcmFtcy5tb3NpID0gdGhpcy5wYXJhbXMuZGluO1xuICAgIHRoaXMucGFyYW1zLmRyaXZlID0gXCI1dlwiOyAvLyBJdCBvdmVyIHNwZWMgZm9yIGZyZXF1ZW5jeS4gQnV0IFZJTi1ISSByZXF1aXJlIDAuN1ZDQzw9LlxuICAgIHRoaXMuc3BpID0gdGhpcy5vYm5pei5nZXRTcGlXaXRoQ29uZmlnKHRoaXMucGFyYW1zKTtcbiAgfVxuXG4gIHB1YmxpYyByZ2IocjogYW55LCBnOiBhbnksIGI6IGFueSkge1xuICAgIHRoaXMuc3BpLndyaXRlKFdTMjgxMkIuX2dlbmVyYXRlQ29sb3IociwgZywgYikpO1xuICB9XG5cbiAgcHVibGljIGhzdihoOiBhbnksIHM6IGFueSwgdjogYW55KSB7XG4gICAgdGhpcy5zcGkud3JpdGUoV1MyODEyQi5fZ2VuZXJhdGVIc3ZDb2xvcihoLCBzLCB2KSk7XG4gIH1cblxuICBwdWJsaWMgcmdicyhhcnJheTogYW55KSB7XG4gICAgbGV0IGJ5dGVzOiBhbnkgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBvbmVBcnJheTogYW55ID0gYXJyYXlbaV07XG4gICAgICBieXRlcyA9IGJ5dGVzLmNvbmNhdChcbiAgICAgICAgV1MyODEyQi5fZ2VuZXJhdGVDb2xvcihvbmVBcnJheVswXSwgb25lQXJyYXlbMV0sIG9uZUFycmF5WzJdKSxcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuc3BpLndyaXRlKGJ5dGVzKTtcbiAgfVxuXG4gIHB1YmxpYyBoc3ZzKGFycmF5OiBhbnkpIHtcbiAgICBsZXQgYnl0ZXM6IGFueSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IG9uZUFycmF5OiBhbnkgPSBhcnJheVtpXTtcbiAgICAgIGJ5dGVzID0gYnl0ZXMuY29uY2F0KFxuICAgICAgICBXUzI4MTJCLl9nZW5lcmF0ZUhzdkNvbG9yKG9uZUFycmF5WzBdLCBvbmVBcnJheVsxXSwgb25lQXJyYXlbMl0pLFxuICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5zcGkud3JpdGUoYnl0ZXMpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFdTMjgxMkI7XG4iXX0=
