"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class WS2811 {
    constructor() {
        this.keys = ["din", "vcc", "gnd"];
        this.requiredKeys = ["din"];
    }
    static info() {
        return {
            name: "WS2811",
        };
    }
    static _generateFromByte(val) {
        // T0H 0.5us+-0.15us
        // T1H 1.2us+-0.15us
        // T0L 2.0us+-0.15us
        // T1L 1.3us+-0.15us
        val = parseInt(val);
        const zero = 0x8;
        const one = 0xe;
        const ret = [];
        for (let i = 0; i < 8; i += 2) {
            let byte = 0;
            if (val & (0x80 >> i)) {
                byte = one << 4;
            }
            else {
                byte = zero << 4;
            }
            if (val & (0x80 >> (i + 1))) {
                byte |= one;
            }
            else {
                byte |= zero;
            }
            ret.push(byte);
        }
        return ret;
    }
    static _generateColor(r, g, b) {
        let array = WS2811._generateFromByte(r);
        array = array.concat(WS2811._generateFromByte(g));
        array = array.concat(WS2811._generateFromByte(b));
        return array;
    }
    static _generateHsvColor(h, s, v) {
        const C = v * s;
        const Hp = h / 60;
        const X = C * (1 - Math.abs((Hp % 2) - 1));
        let R;
        let G;
        let B;
        if (0 <= Hp && Hp < 1) {
            [R, G, B] = [C, X, 0];
        }
        if (1 <= Hp && Hp < 2) {
            [R, G, B] = [X, C, 0];
        }
        if (2 <= Hp && Hp < 3) {
            [R, G, B] = [0, C, X];
        }
        if (3 <= Hp && Hp < 4) {
            [R, G, B] = [0, X, C];
        }
        if (4 <= Hp && Hp < 5) {
            [R, G, B] = [X, 0, C];
        }
        if (5 <= Hp && Hp < 6) {
            [R, G, B] = [C, 0, X];
        }
        const m = v - C;
        [R, G, B] = [R + m, G + m, B + m];
        R = Math.floor(R * 255);
        G = Math.floor(G * 255);
        B = Math.floor(B * 255);
        let array = WS2811._generateFromByte(R);
        array = array.concat(WS2811._generateFromByte(G));
        array = array.concat(WS2811._generateFromByte(B));
        return array;
    }
    wired(obniz) {
        this.obniz = obniz;
        obniz.setVccGnd(this.params.vcc, this.params.gnd, "5v");
        this.params.mode = "master";
        this.params.frequency = 2 * 1000 * 1000;
        this.params.mosi = this.params.din;
        this.params.drive = "5v"; // It over spec for frequency. But VIN-HI require 0.7VCC<=.
        this.spi = this.obniz.getSpiWithConfig(this.params);
    }
    rgb(r, g, b) {
        this.spi.write(WS2811._generateColor(r, g, b));
    }
    hsv(h, s, v) {
        this.spi.write(WS2811._generateHsvColor(h, s, v));
    }
    rgbs(array) {
        let bytes = [];
        for (let i = 0; i < array.length; i++) {
            const oneArray = array[i];
            bytes = bytes.concat(WS2811._generateColor(oneArray[0], oneArray[1], oneArray[2]));
        }
        this.spi.write(bytes);
    }
    hsvs(array) {
        let bytes = [];
        for (let i = 0; i < array.length; i++) {
            const oneArray = array[i];
            bytes = bytes.concat(WS2811._generateHsvColor(oneArray[0], oneArray[1], oneArray[2]));
        }
        this.spi.write(bytes);
    }
}
exports.default = WS2811;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9MaWdodC9XUzI4MTEvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNLE1BQU07SUFzRlY7UUFDRSxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQXZGTSxNQUFNLENBQUMsSUFBSTtRQUNoQixPQUFPO1lBQ0wsSUFBSSxFQUFFLFFBQVE7U0FDZixDQUFDO0lBQ0osQ0FBQztJQUVNLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFRO1FBQ3RDLG9CQUFvQjtRQUNwQixvQkFBb0I7UUFDcEIsb0JBQW9CO1FBQ3BCLG9CQUFvQjtRQUVwQixHQUFHLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BCLE1BQU0sSUFBSSxHQUFRLEdBQUcsQ0FBQztRQUN0QixNQUFNLEdBQUcsR0FBUSxHQUFHLENBQUM7UUFDckIsTUFBTSxHQUFHLEdBQVEsRUFBRSxDQUFDO1FBQ3BCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM3QixJQUFJLElBQUksR0FBUSxDQUFDLENBQUM7WUFDbEIsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLEVBQUU7Z0JBQ3JCLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDO2FBQ2pCO2lCQUFNO2dCQUNMLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDO2FBQ2xCO1lBQ0QsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDM0IsSUFBSSxJQUFJLEdBQUcsQ0FBQzthQUNiO2lCQUFNO2dCQUNMLElBQUksSUFBSSxJQUFJLENBQUM7YUFDZDtZQUNELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDaEI7UUFDRCxPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFTSxNQUFNLENBQUMsY0FBYyxDQUFDLENBQU0sRUFBRSxDQUFNLEVBQUUsQ0FBTTtRQUNqRCxJQUFJLEtBQUssR0FBUSxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0MsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRU0sTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQU0sRUFBRSxDQUFNLEVBQUUsQ0FBTTtRQUNwRCxNQUFNLENBQUMsR0FBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sRUFBRSxHQUFRLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDdkIsTUFBTSxDQUFDLEdBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVoRCxJQUFJLENBQU0sQ0FBQztRQUFDLElBQUksQ0FBTSxDQUFDO1FBQUMsSUFBSSxDQUFNLENBQUM7UUFDbkMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDckIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN2QjtRQUNELElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDdkI7UUFDRCxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRTtZQUNyQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDckIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN2QjtRQUNELElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDdkI7UUFDRCxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRTtZQUNyQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBRUQsTUFBTSxDQUFDLEdBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRWxDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUN4QixDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFD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QUFDLENBQUMsQ0FDaEUsQ0FBQztTQUNIO1FBQ0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEIsQ0FBQztDQUNGO0FBRUQsa0JBQWUsTUFBTSxDQUFDIiwiZmlsZSI6InNyYy9wYXJ0cy9MaWdodC9XUzI4MTEvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBXUzI4MTEge1xuXG4gIHB1YmxpYyBzdGF0aWMgaW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogXCJXUzI4MTFcIixcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBfZ2VuZXJhdGVGcm9tQnl0ZSh2YWw6IGFueSkge1xuICAgIC8vIFQwSCAwLjV1cystMC4xNXVzXG4gICAgLy8gVDFIIDEuMnVzKy0wLjE1dXNcbiAgICAvLyBUMEwgMi4wdXMrLTAuMTV1c1xuICAgIC8vIFQxTCAxLjN1cystMC4xNXVzXG5cbiAgICB2YWwgPSBwYXJzZUludCh2YWwpO1xuICAgIGNvbnN0IHplcm86IGFueSA9IDB4ODtcbiAgICBjb25zdCBvbmU6IGFueSA9IDB4ZTtcbiAgICBjb25zdCByZXQ6IGFueSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSArPSAyKSB7XG4gICAgICBsZXQgYnl0ZTogYW55ID0gMDtcbiAgICAgIGlmICh2YWwgJiAoMHg4MCA+PiBpKSkge1xuICAgICAgICBieXRlID0gb25lIDw8IDQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBieXRlID0gemVybyA8PCA0O1xuICAgICAgfVxuICAgICAgaWYgKHZhbCAmICgweDgwID4+IChpICsgMSkpKSB7XG4gICAgICAgIGJ5dGUgfD0gb25lO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYnl0ZSB8PSB6ZXJvO1xuICAgICAgfVxuICAgICAgcmV0LnB1c2goYnl0ZSk7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIF9nZW5lcmF0ZUNvbG9yKHI6IGFueSwgZzogYW55LCBiOiBhbnkpIHtcbiAgICBsZXQgYXJyYXk6IGFueSA9IFdTMjgxMS5fZ2VuZXJhdGVGcm9tQnl0ZShyKTtcbiAgICBhcnJheSA9IGFycmF5LmNvbmNhdChXUzI4MTEuX2dlbmVyYXRlRnJvbUJ5dGUoZykpO1xuICAgIGFycmF5ID0gYXJyYXkuY29uY2F0KFdTMjgxMS5fZ2VuZXJhdGVGcm9tQnl0ZShiKSk7XG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBfZ2VuZXJhdGVIc3ZDb2xvcihoOiBhbnksIHM6IGFueSwgdjogYW55KSB7XG4gICAgY29uc3QgQzogYW55ID0gdiAqIHM7XG4gICAgY29uc3QgSHA6IGFueSA9IGggLyA2MDtcbiAgICBjb25zdCBYOiBhbnkgPSBDICogKDEgLSBNYXRoLmFicygoSHAgJSAyKSAtIDEpKTtcblxuICAgIGxldCBSOiBhbnk7IGxldCBHOiBhbnk7IGxldCBCOiBhbnk7XG4gICAgaWYgKDAgPD0gSHAgJiYgSHAgPCAxKSB7XG4gICAgICBbUiwgRywgQl0gPSBbQywgWCwgMF07XG4gICAgfVxuICAgIGlmICgxIDw9IEhwICYmIEhwIDwgMikge1xuICAgICAgW1IsIEcsIEJdID0gW1gsIEMsIDBdO1xuICAgIH1cbiAgICBpZiAoMiA8PSBIcCAmJiBIcCA8IDMpIHtcbiAgICAgIFtSLCBHLCBCXSA9IFswLCBDLCBYXTtcbiAgICB9XG4gICAgaWYgKDMgPD0gSHAgJiYgSHAgPCA0KSB7XG4gICAgICBbUiwgRywgQl0gPSBbMCwgWCwgQ107XG4gICAgfVxuICAgIGlmICg0IDw9IEhwICYmIEhwIDwgNSkge1xuICAgICAgW1IsIEcsIEJdID0gW1gsIDAsIENdO1xuICAgIH1cbiAgICBpZiAoNSA8PSBIcCAmJiBIcCA8IDYpIHtcbiAgICAgIFtSLCBHLCBCXSA9IFtDLCAwLCBYXTtcbiAgICB9XG5cbiAgICBjb25zdCBtOiBhbnkgPSB2IC0gQztcbiAgICBbUiwgRywgQl0gPSBbUiArIG0sIEcgKyBtLCBCICsgbV07XG5cbiAgICBSID0gTWF0aC5mbG9vcihSICogMjU1KTtcbiAgICBHID0gTWF0aC5mbG9vcihHICogMjU1KTtcbiAgICBCID0gTWF0aC5mbG9vcihCICogMjU1KTtcblxuICAgIGxldCBhcnJheTogYW55ID0gV1MyODExLl9nZW5lcmF0ZUZyb21CeXRlKFIpO1xuICAgIGFycmF5ID0gYXJyYXkuY29uY2F0KFdTMjgxMS5fZ2VuZXJhdGVGcm9tQnl0ZShHKSk7XG4gICAgYXJyYXkgPSBhcnJheS5jb25jYXQoV1MyODExLl9nZW5lcmF0ZUZyb21CeXRlKEIpKTtcbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cblxuICBwdWJsaWMga2V5czogYW55O1xuICBwdWJsaWMgcmVxdWlyZWRLZXlzOiBhbnk7XG4gIHB1YmxpYyBvYm5pejogYW55O1xuICBwdWJsaWMgcGFyYW1zOiBhbnk7XG4gIHB1YmxpYyBzcGk6IGFueTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmtleXMgPSBbXCJkaW5cIiwgXCJ2Y2NcIiwgXCJnbmRcIl07XG4gICAgdGhpcy5yZXF1aXJlZEtleXMgPSBbXCJkaW5cIl07XG4gIH1cblxuICBwdWJsaWMgd2lyZWQob2JuaXo6IGFueSkge1xuICAgIHRoaXMub2JuaXogPSBvYm5pejtcblxuICAgIG9ibml6LnNldFZjY0duZCh0aGlzLnBhcmFtcy52Y2MsIHRoaXMucGFyYW1zLmduZCwgXCI1dlwiKTtcblxuICAgIHRoaXMucGFyYW1zLm1vZGUgPSBcIm1hc3RlclwiO1xuICAgIHRoaXMucGFyYW1zLmZyZXF1ZW5jeSA9IDIgKiAxMDAwICogMTAwMDtcbiAgICB0aGlzLnBhcmFtcy5tb3NpID0gdGhpcy5wYXJhbXMuZGluO1xuICAgIHRoaXMucGFyYW1zLmRyaXZlID0gXCI1dlwiOyAvLyBJdCBvdmVyIHNwZWMgZm9yIGZyZXF1ZW5jeS4gQnV0IFZJTi1ISSByZXF1aXJlIDAuN1ZDQzw9LlxuICAgIHRoaXMuc3BpID0gdGhpcy5vYm5pei5nZXRTcGlXaXRoQ29uZmlnKHRoaXMucGFyYW1zKTtcbiAgfVxuXG4gIHB1YmxpYyByZ2IocjogYW55LCBnOiBhbnksIGI6IGFueSkge1xuICAgIHRoaXMuc3BpLndyaXRlKFdTMjgxMS5fZ2VuZXJhdGVDb2xvcihyLCBnLCBiKSk7XG4gIH1cblxuICBwdWJsaWMgaHN2KGg6IGFueSwgczogYW55LCB2OiBhbnkpIHtcbiAgICB0aGlzLnNwaS53cml0ZShXUzI4MTEuX2dlbmVyYXRlSHN2Q29sb3IoaCwgcywgdikpO1xuICB9XG5cbiAgcHVibGljIHJnYnMoYXJyYXk6IGFueSkge1xuICAgIGxldCBieXRlczogYW55ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgb25lQXJyYXk6IGFueSA9IGFycmF5W2ldO1xuICAgICAgYnl0ZXMgPSBieXRlcy5jb25jYXQoXG4gICAgICAgIFdTMjgxMS5fZ2VuZXJhdGVDb2xvcihvbmVBcnJheVswXSwgb25lQXJyYXlbMV0sIG9uZUFycmF5WzJdKSxcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuc3BpLndyaXRlKGJ5dGVzKTtcbiAgfVxuXG4gIHB1YmxpYyBoc3ZzKGFycmF5OiBhbnkpIHtcbiAgICBsZXQgYnl0ZXM6IGFueSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IG9uZUFycmF5OiBhbnkgPSBhcnJheVtpXTtcbiAgICAgIGJ5dGVzID0gYnl0ZXMuY29uY2F0KFxuICAgICAgICBXUzI4MTEuX2dlbmVyYXRlSHN2Q29sb3Iob25lQXJyYXlbMF0sIG9uZUFycmF5WzFdLCBvbmVBcnJheVsyXSksXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLnNwaS53cml0ZShieXRlcyk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgV1MyODExO1xuIl19
