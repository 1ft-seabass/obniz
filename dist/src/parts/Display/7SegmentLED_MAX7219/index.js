"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class _7SegmentLED_MAX7219 {
    constructor() {
        this.keys = ["vcc", "gnd", "din", "cs", "clk"];
        this.requiredKeys = ["din", "cs", "clk"];
    }
    static info() {
        return {
            name: "7SegmentLED_MAX7219",
        };
    }
    wired(obniz) {
        this.cs = obniz.getIO(this.params.cs);
        // logich high must 3.5v <=
        if (obniz.isValidIO(this.params.vcc)) {
            obniz.getIO(this.params.vcc).output(true);
        }
        if (obniz.isValidIO(this.params.gnd)) {
            obniz.getIO(this.params.gnd).output(false);
        }
        // max 10Mhz but motor driver can't
        this.params.frequency = this.params.frequency || 10 * 1000 * 1000;
        this.params.mode = "master";
        this.params.mosi = this.params.din;
        this.params.drive = "3v";
        this.spi = this.obniz.getSpiWithConfig(this.params);
        // reset a onece
        this.cs.output(true);
        this.cs.output(false);
        this.cs.output(true);
    }
    init(numOfDisplay, digits) {
        this.numOfDisp = numOfDisplay;
        this.digits = digits;
        this.writeAllDisp([0x09, 0xff]); // Code B decode for digits 7-0
        this.writeAllDisp([0x0a, 0x05]); // brightness 11/32 0 to f
        this.writeAllDisp([0x0b, digits - 1]);
        this.writeAllDisp([0x0c, 0x01]); // Shutdown to normal operation
        this.writeAllDisp([0x0f, 0x00]);
        this.obniz.wait(10);
    }
    clear(disp) {
        for (let i = 0; i < this.digits; i++) {
            this.writeOneDisp(disp, [i + 1, 0x0f]);
        }
    }
    clearAll() {
        for (let i = 0; i < this.numOfDisp; i++) {
            for (let j = 0; j < this.digits; j++) {
                this.writeAllDisp([j + 1, 0x0f]);
            }
        }
    }
    test() {
        this.writeAllDisp([0x0f, 0x00]); // test command
    }
    brightness(disp, val) {
        this.writeOneDisp(disp, [0x0a, val]); // 0 to 15;
    }
    brightnessAll(val) {
        this.writeAllDisp([0x0a, val]); // 0 to 15;
    }
    writeAllDisp(data) {
        for (let i = 0; i < this.numOfDisp; i++) {
            this.writeOneDisp(i, data);
        }
    }
    writeOneDisp(disp, data) {
        this.cs.output(false);
        for (let i = 0; i < disp; i++) {
            this.spi.write([0x00, 0x00]);
        }
        this.spi.write(data);
        for (let i = 0; i < this.numOfDisp - (disp + 1); i++) {
            this.spi.write([0x00, 0x00]);
        }
        this.cs.output(true);
    }
    setNumber(disp, digit, number, dp) {
        if (digit >= 0 && digit <= this.digits - 1) {
            this.writeOneDisp(disp, [digit + 1, this.encodeBCD(number, dp)]);
        }
    }
    encodeBCD(decimal, dp) {
        let dpreg;
        if (dp === true) {
            dpreg = 0x80;
        }
        else {
            dpreg = 0x00;
        }
        if (decimal >= 0 && decimal <= 9) {
            return decimal | dpreg;
        }
        else if (decimal === "-" || decimal === 10) {
            return 0x0a | dpreg;
        }
        else if (decimal === "e" || decimal === 11) {
            return 0x0b | dpreg;
        }
        else if (decimal === "h" || decimal === 12) {
            return 0x0c | dpreg;
        }
        else if (decimal === "l" || decimal === 13) {
            return 0x0d | dpreg;
        }
        else if (decimal === "p" || decimal === 14) {
            return 0x0e | dpreg;
        }
        else if (decimal === "on") {
            // light all segments
            return 0x88;
        }
        else if (decimal === "off") {
            return 0x0f | dpreg;
        }
        else {
            return 0x0f | dpreg;
        }
    }
}
exports.default = _7SegmentLED_MAX7219;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9EaXNwbGF5LzdTZWdtZW50TEVEX01BWDcyMTkvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNLG9CQUFvQjtJQWlCeEI7UUFDRSxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFsQk0sTUFBTSxDQUFDLElBQUk7UUFDaEIsT0FBTztZQUNMLElBQUksRUFBRSxxQkFBcUI7U0FDNUIsQ0FBQztJQUNKLENBQUM7SUFnQk0sS0FBSyxDQUFDLEtBQVU7UUFDckIsSUFBSSxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdEMsMkJBQTJCO1FBQzNCLElBQUksS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3BDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDM0M7UUFDRCxJQUFJLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNwQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzVDO1FBRUQsbUNBQW1DO1FBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxJQUFJLEVBQUUsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFD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QUMsRUFBRSxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQzVCO0lBQ0gsQ0FBQztJQUVNLFlBQVksQ0FBQyxJQUFTLEVBQUUsSUFBUztRQUN0QyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzdCLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDOUI7UUFDRCxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNwRCxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQzlCO1FBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUVNLFNBQVMsQ0FBQyxJQUFTLEVBQUUsS0FBVSxFQUFFLE1BQVcsRUFBRSxFQUFPO1FBQzFELElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDMUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNsRTtJQUNILENBQUM7SUFFTSxTQUFTLENBQUMsT0FBWSxFQUFFLEVBQU87UUFDcEMsSUFBSSxLQUFVLENBQUM7UUFDZixJQUFJLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDZixLQUFLLEdBQUcsSUFBSSxDQUFDO1NBQ2Q7YUFBTTtZQUNMLEtBQUssR0FBRyxJQUFJLENBQUM7U0FDZDtRQUNELElBQUksT0FBTyxJQUFJLENBQUMsSUFBSSxPQUFPLElBQUksQ0FBQyxFQUFFO1lBQ2hDLE9BQU8sT0FBTyxHQUFHLEtBQUssQ0FBQztTQUN4QjthQUFNLElBQUksT0FBTyxLQUFLLEdBQUcsSUFBSSxPQUFPLEtBQUssRUFBRSxFQUFFO1lBQzVDLE9BQU8sSUFBSSxHQUFHLEtBQUssQ0FBQztTQUNyQjthQUFNLElBQUksT0FBTyxLQUFLLEdBQUcsSUFBSSxPQUFPLEtBQUssRUFBRSxFQUFFO1lBQzVDLE9BQU8sSUFBSSxHQUFHLEtBQUssQ0FBQztTQUNyQjthQUFNLElBQUksT0FBTyxLQUFLLEdBQUcsSUFBSSxPQUFPLEtBQUssRUFBRSxFQUFFO1lBQzVDLE9BQU8sSUFBSSxHQUFHLEtBQUssQ0FBQztTQUNyQjthQUFNLElBQUksT0FBTyxLQUFLLEdBQUcsSUFBSSxPQUFPLEtBQUssRUFBRSxFQUFFO1lBQzVDLE9BQU8sSUFBSSxHQUFHLEtBQUssQ0FBQztTQUNyQjthQUFNLElBQUksT0FBTyxLQUFLLEdBQUcsSUFBSSxPQUFPLEtBQUssRUFBRSxFQUFFO1lBQzVDLE9BQU8sSUFBSSxHQUFHLEtBQUssQ0FBQztTQUNyQjthQUFNLElBQUksT0FBTyxLQUFLLElBQUksRUFBRTtZQUMzQixxQkFBcUI7WUFDckIsT0FBTyxJQUFJLENBQUM7U0FDYjthQUFNLElBQUksT0FBTyxLQUFLLEtBQUssRUFBRTtZQUM1QixPQUFPLElBQUksR0FBRyxLQUFLLENBQUM7U0FDckI7YUFBTTtZQUNMLE9BQU8sSUFBSSxHQUFHLEtBQUssQ0FBQztTQUNyQjtJQUNILENBQUM7Q0FDRjtBQUVELGtCQUFlLG9CQUFvQixDQUFDIiwiZmlsZSI6InNyYy9wYXJ0cy9EaXNwbGF5LzdTZWdtZW50TEVEX01BWDcyMTkvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBfN1NlZ21lbnRMRURfTUFYNzIxOSB7XG5cbiAgcHVibGljIHN0YXRpYyBpbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBcIjdTZWdtZW50TEVEX01BWDcyMTlcIixcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGtleXM6IGFueTtcbiAgcHVibGljIHJlcXVpcmVkS2V5czogYW55O1xuICBwdWJsaWMgY3M6IGFueTtcbiAgcHVibGljIHBhcmFtczogYW55O1xuICBwdWJsaWMgc3BpOiBhbnk7XG4gIHB1YmxpYyBvYm5pejogYW55O1xuICBwdWJsaWMgbnVtT2ZEaXNwOiBhbnk7XG4gIHB1YmxpYyBkaWdpdHM6IGFueTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmtleXMgPSBbXCJ2Y2NcIiwgXCJnbmRcIiwgXCJkaW5cIiwgXCJjc1wiLCBcImNsa1wiXTtcbiAgICB0aGlzLnJlcXVpcmVkS2V5cyA9IFtcImRpblwiLCBcImNzXCIsIFwiY2xrXCJdO1xuICB9XG5cbiAgcHVibGljIHdpcmVkKG9ibml6OiBhbnkpIHtcbiAgICB0aGlzLmNzID0gb2JuaXouZ2V0SU8odGhpcy5wYXJhbXMuY3MpO1xuICAgIC8vIGxvZ2ljaCBoaWdoIG11c3QgMy41diA8PVxuICAgIGlmIChvYm5pei5pc1ZhbGlkSU8odGhpcy5wYXJhbXMudmNjKSkge1xuICAgICAgb2JuaXouZ2V0SU8odGhpcy5wYXJhbXMudmNjKS5vdXRwdXQodHJ1ZSk7XG4gICAgfVxuICAgIGlmIChvYm5pei5pc1ZhbGlkSU8odGhpcy5wYXJhbXMuZ25kKSkge1xuICAgICAgb2JuaXouZ2V0SU8odGhpcy5wYXJhbXMuZ25kKS5vdXRwdXQoZmFsc2UpO1xuICAgIH1cblxuICAgIC8vIG1heCAxME1oeiBidXQgbW90b3IgZHJpdmVyIGNhbid0XG4gICAgdGhpcy5wYXJhbXMuZnJlcXVlbmN5ID0gdGhpcy5wYXJhbXMuZnJlcXVlbmN5IHx8IDEwICogMTAwMCAqIDEwMDA7XG4gICAgdGhpcy5wYXJhbXMubW9kZSA9IFwibWFzdGVyXCI7XG4gICAgdGhpcy5wYXJhbXMubW9zaSA9IHRoaXMucGFyYW1zLmRpbjtcbiAgICB0aGlzLnBhcmFtcy5kcml2ZSA9IFwiM3ZcIjtcbiAgICB0aGlzLnNwaSA9IHRoaXMub2JuaXouZ2V0U3BpV2l0aENvbmZpZyh0aGlzLnBhcmFtcyk7XG5cbiAgICAvLyByZXNldCBhIG9uZWNlXG4gICAgdGhpcy5jcy5vdXRwdXQodHJ1ZSk7XG4gICAgdGhpcy5jcy5vdXRwdXQoZmFsc2UpO1xuICAgIHRoaXMuY3Mub3V0cHV0KHRydWUpO1xuICB9XG5cbiAgcHVibGljIGluaXQobnVtT2ZEaXNwbGF5OiBhbnksIGRpZ2l0czogYW55KSB7XG4gICAgdGhpcy5udW1PZkRpc3AgPSBudW1PZkRpc3BsYXk7XG4gICAgdGhpcy5kaWdpdHMgPSBkaWdpdHM7XG4gICAgdGhpcy53cml0ZUFsbERpc3AoWzB4MDksIDB4ZmZdKTsgLy8gQ29kZSBCIGRlY29kZSBmb3IgZGlnaXRzIDctMFxuICAgIHRoaXMud3JpdGVBbGxEaXNwKFsweDBhLCAweDA1XSk7IC8vIGJyaWdodG5lc3MgMTEvMzIgMCB0byBmXG4gICAgdGhpcy53cml0ZUFsbERpc3AoWzB4MGIsIGRpZ2l0cyAtIDFdKTtcbiAgICB0aGlzLndyaXRlQWxsRGlzcChbMHgwYywgMHgwMV0pOyAvLyBTaHV0ZG93biB0byBub3JtYWwgb3BlcmF0aW9uXG4gICAgdGhpcy53cml0ZUFsbERpc3AoWzB4MGYsIDB4MDBdKTtcbiAgICB0aGlzLm9ibml6LndhaXQoMTApO1xuICB9XG5cbiAgcHVibGljIGNsZWFyKGRpc3A6IGFueSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kaWdpdHM7IGkrKykge1xuICAgICAgdGhpcy53cml0ZU9uZURpc3AoZGlzcCwgW2kgKyAxLCAweDBmXSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNsZWFyQWxsKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5udW1PZkRpc3A7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmRpZ2l0czsgaisrKSB7XG4gICAgICAgIHRoaXMud3JpdGVBbGxEaXNwKFtqICsgMSwgMHgwZl0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB0ZXN0KCkge1xuICAgIHRoaXMud3JpdGVBbGxEaXNwKFsweDBmLCAweDAwXSk7IC8vIHRlc3QgY29tbWFuZFxuICB9XG5cbiAgcHVibGljIGJyaWdodG5lc3MoZGlzcDogYW55LCB2YWw6IGFueSkge1xuICAgIHRoaXMud3JpdGVPbmVEaXNwKGRpc3AsIFsweDBhLCB2YWxdKTsgLy8gMCB0byAxNTtcbiAgfVxuXG4gIHB1YmxpYyBicmlnaHRuZXNzQWxsKHZhbDogYW55KSB7XG4gICAgdGhpcy53cml0ZUFsbERpc3AoWzB4MGEsIHZhbF0pOyAvLyAwIHRvIDE1O1xuICB9XG5cbiAgcHVibGljIHdyaXRlQWxsRGlzcChkYXRhOiBhbnkpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtT2ZEaXNwOyBpKyspIHtcbiAgICAgIHRoaXMud3JpdGVPbmVEaXNwKGksIGRhdGEpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB3cml0ZU9uZURpc3AoZGlzcDogYW55LCBkYXRhOiBhbnkpIHtcbiAgICB0aGlzLmNzLm91dHB1dChmYWxzZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXNwOyBpKyspIHtcbiAgICAgIHRoaXMuc3BpLndyaXRlKFsweDAwLCAweDAwXSk7XG4gICAgfVxuICAgIHRoaXMuc3BpLndyaXRlKGRhdGEpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5udW1PZkRpc3AgLSAoZGlzcCArIDEpOyBpKyspIHtcbiAgICAgIHRoaXMuc3BpLndyaXRlKFsweDAwLCAweDAwXSk7XG4gICAgfVxuICAgIHRoaXMuY3Mub3V0cHV0KHRydWUpO1xuICB9XG5cbiAgcHVibGljIHNldE51bWJlcihkaXNwOiBhbnksIGRpZ2l0OiBhbnksIG51bWJlcjogYW55LCBkcDogYW55KSB7XG4gICAgaWYgKGRpZ2l0ID49IDAgJiYgZGlnaXQgPD0gdGhpcy5kaWdpdHMgLSAxKSB7XG4gICAgICB0aGlzLndyaXRlT25lRGlzcChkaXNwLCBbZGlnaXQgKyAxLCB0aGlzLmVuY29kZUJDRChudW1iZXIsIGRwKV0pO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBlbmNvZGVCQ0QoZGVjaW1hbDogYW55LCBkcDogYW55KSB7XG4gICAgbGV0IGRwcmVnOiBhbnk7XG4gICAgaWYgKGRwID09PSB0cnVlKSB7XG4gICAgICBkcHJlZyA9IDB4ODA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRwcmVnID0gMHgwMDtcbiAgICB9XG4gICAgaWYgKGRlY2ltYWwgPj0gMCAmJiBkZWNpbWFsIDw9IDkpIHtcbiAgICAgIHJldHVybiBkZWNpbWFsIHwgZHByZWc7XG4gICAgfSBlbHNlIGlmIChkZWNpbWFsID09PSBcIi1cIiB8fCBkZWNpbWFsID09PSAxMCkge1xuICAgICAgcmV0dXJuIDB4MGEgfCBkcHJlZztcbiAgICB9IGVsc2UgaWYgKGRlY2ltYWwgPT09IFwiZVwiIHx8IGRlY2ltYWwgPT09IDExKSB7XG4gICAgICByZXR1cm4gMHgwYiB8IGRwcmVnO1xuICAgIH0gZWxzZSBpZiAoZGVjaW1hbCA9PT0gXCJoXCIgfHwgZGVjaW1hbCA9PT0gMTIpIHtcbiAgICAgIHJldHVybiAweDBjIHwgZHByZWc7XG4gICAgfSBlbHNlIGlmIChkZWNpbWFsID09PSBcImxcIiB8fCBkZWNpbWFsID09PSAxMykge1xuICAgICAgcmV0dXJuIDB4MGQgfCBkcHJlZztcbiAgICB9IGVsc2UgaWYgKGRlY2ltYWwgPT09IFwicFwiIHx8IGRlY2ltYWwgPT09IDE0KSB7XG4gICAgICByZXR1cm4gMHgwZSB8IGRwcmVnO1xuICAgIH0gZWxzZSBpZiAoZGVjaW1hbCA9PT0gXCJvblwiKSB7XG4gICAgICAvLyBsaWdodCBhbGwgc2VnbWVudHNcbiAgICAgIHJldHVybiAweDg4O1xuICAgIH0gZWxzZSBpZiAoZGVjaW1hbCA9PT0gXCJvZmZcIikge1xuICAgICAgcmV0dXJuIDB4MGYgfCBkcHJlZztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDB4MGYgfCBkcHJlZztcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgXzdTZWdtZW50TEVEX01BWDcyMTk7XG4iXX0=
