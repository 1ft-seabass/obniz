"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class SNx4HC595_IO {
    constructor(chip, id) {
        this.chip = chip;
        this.id = id;
        this.value = 0;
    }
    output(value) {
        this.chip.output(this.id, value);
    }
}
// tslint:disable-next-line:max-classes-per-file
class SNx4HC595 {
    constructor() {
        /* http://www.ti.com/lit/ds/symlink/sn74hc595.pdf */
        this.keys = [
            "gnd",
            "vcc",
            "ser",
            "srclk",
            "rclk",
            "oe",
            "srclr",
            "io_num",
            "enabled",
        ];
        this.requiredKeys = ["ser", "srclk", "rclk"];
        this.autoFlash = true;
    }
    static info() {
        return {
            name: "SNx4HC595",
        };
    }
    wired(obniz) {
        this.obniz = obniz;
        this.io_ser = this.obniz.getIO(this.params.ser);
        this.io_srclk = this.obniz.getIO(this.params.srclk);
        this.io_rclk = this.obniz.getIO(this.params.rclk);
        this.io_ser.output(false);
        this.io_srclk.output(false);
        this.io_rclk.output(false);
        this.obniz.setVccGnd(this.params.vcc, this.params.gnd, "5v");
        if (this.obniz.isValidIO(this.params.srclr)) {
            this.io_srclr = this.obniz.getIO(this.params.srclr);
            this.io_srclr.output(true);
        }
        if (this.obniz.isValidIO(this.params.oe)) {
            this.io_oe = this.obniz.getIO(this.params.oe);
            this.io_oe.output(true);
        }
        if (this.obniz.isValidIO(this.params.vcc) ||
            this.obniz.isValidIO(this.params.gnd)) {
            this.obniz.wait(100);
        }
        if (typeof this.params.io_num !== "number") {
            this.params.io_num = 8;
        }
        this.ioNum(this.params.io_num);
        if (typeof this.params.enabled !== "boolean") {
            this.params.enabled = true;
        }
        if (this.io_oe && this.params.enabled) {
            this.io_oe.output(false);
        }
    }
    ioNum(num) {
        if (typeof num === "number" && this._io_num !== num) {
            this._io_num = num;
            this.io = [];
            for (let i = 0; i < num; i++) {
                this.io.push(new SNx4HC595_IO(this, i));
            }
            this.flush();
        }
        else {
            throw new Error("io num should be a number");
        }
    }
    isValidIO(io) {
        return typeof io === "number" && io >= 0 && io < this._io_num;
    }
    getIO(io) {
        if (!this.isValidIO(io)) {
            throw new Error("io " + io + " is not valid io");
        }
        return this.io[io];
    }
    output(id, value) {
        value = value === true;
        this.io[id].value = value;
        if (this.autoFlash) {
            this.flush();
        }
    }
    onece(operation) {
        if (typeof operation !== "function") {
            throw new Error("please provide function");
        }
        const lastValue = this.autoFlash;
        this.autoFlash = false;
        operation();
        this.flush();
        this.autoFlash = lastValue;
    }
    setEnable(enable) {
        if (!this.io_oe && enable === false) {
            throw new Error('pin "oe" is not specified');
        }
        this.io_oe.output(!enable);
    }
    flush() {
        /* this code will works with 5v. But you should pay more attention when 3v. Timing is more tight. see chip reference */
        this.io_rclk.output(false);
        for (let i = this.io.length - 1; i >= 0; i--) {
            this.io_ser.output(this.io[i].value);
            this.io_srclk.output(true);
            this.io_srclk.output(false);
        }
        this.io_rclk.output(true);
    }
}
exports.default = SNx4HC595;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9Mb2dpYy9TTng0SEM1OTUvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxNQUFNLFlBQVk7SUFLaEIsWUFBWSxJQUFTLEVBQUUsRUFBTztRQUM1QixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztRQUNiLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2pCLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBVTtRQUN0QixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ25DLENBQUM7Q0FDRjtBQUVELGdEQUFnRDtBQUNoRCxNQUFNLFNBQVM7SUF3QmI7UUFDRSxvREFBb0Q7UUFDcEQsSUFBSSxDQUFDLElBQUksR0FBRztZQUNWLEtBQUs7WUFDTCxLQUFLO1lBQ0wsS0FBSztZQUNMLE9BQU87WUFDUCxNQUFNO1lBQ04sSUFBSTtZQUNKLE9BQU87WUFDUCxRQUFRO1lBQ1IsU0FBUztTQUNWLENBQUM7UUFDRixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUU3QyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztJQUN4QixDQUFDO0lBdENNLE1BQU0sQ0FBQyxJQUFJO1FBQ2hCLE9BQU87WUFDTCxJQUFJLEVBQUUsV0FBVztTQUNsQixDQUFDO0lBQ0osQ0FBQztJQW9DTSxLQUFLLENBQUMsS0FBVTtRQUNyQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUVuQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVsRCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUUzQixJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUU3RCxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDM0MsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3BELElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzVCO1FBRUQsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ3hDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM5QyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN6QjtRQUVELElBQ0UsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUM7WUFDckMsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFDckM7WUFDQSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUN0QjtRQUVELElBQUksT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxRQUFRLEVBQUU7WUFDMUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQ3hCO1FBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRS9CLElBQUksT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sS0FBSyxTQUFTLEVBQUU7WUFDNUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1NBQzVCO1FBQ0QsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFO1lBQ3JDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzFCO0lBQ0gsQ0FBQztJQUVNLEtBQUssQ0FBQyxHQUFRO1FBRW5CLElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxJQUFJLElBQUksQ0FBQyxPQUFPLEtBQUssR0FBRyxFQUFFO1lBQ25ELElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDO1lBQ25CLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1lBQ2IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDNUIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDekM7WUFDRCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDZDthQUFNO1lBQ0wsTUFBTSxJQUFJLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1NBQzlDO0lBQ0gsQ0FBQztJQUVNLFNBQVMsQ0FBQyxFQUFPO1FBQ3RCLE9BQU8sT0FBTyxFQUFFLEtBQUssUUFBUSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDaEUsQ0FBQztJQUVNLEtBQUssQ0FBQyxFQUFPO1FBQ2xCLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ3ZCLE1BQU0sSUFBSSxLQUFLLENBQUMsS0FBSyxHQUFHLEVBQUUsR0FBRyxrQkFBa0IsQ0FBQyxDQUFDO1NBQ2xEO1FBQ0QsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3JCLENBQUM7SUFFTSxNQUFNLENBQUMsRUFBTyxFQUFFLEtBQVU7UUFDL0IsS0FBSyxHQUFHLEtBQUssS0FBSyxJQUFJLENBQUM7UUFDdkIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQzFCLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDZDtJQUNILENBQUM7SUFFTSxLQUFLLENBQUMsU0FBYztRQUN6QixJQUFJLE9BQU8sU0FBUyxLQUFLLFVBQVUsRUFBRTtZQUNuQyxNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7U0FDNUM7UUFDRCxNQUFNLFNBQVMsR0FBUSxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLFNBQVMsRUFBRSxDQUFDO1FBQ1osSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7SUFDN0IsQ0FBQztJQUVNLFNBQVMsQ0FBQyxNQUFXO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLE1BQU0sS0FBSyxLQUFLLEVBQUU7WUFDbkMsTUFBTSxJQUFJLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1NBQzlDO1FBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRU0sS0FBSztRQUNWLHVIQUF1SDtRQUN2SCxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQixLQUFLLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzVDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDckMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDN0I7UUFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1QixDQUFDO0NBQ0Y7QUFFRCxrQkFBZSxTQUFTLENBQUMiLCJmaWxlIjoic3JjL3BhcnRzL0xvZ2ljL1NOeDRIQzU5NS9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuY2xhc3MgU054NEhDNTk1X0lPIHtcbiAgcHVibGljIGNoaXA6IGFueTtcbiAgcHVibGljIGlkOiBhbnk7XG4gIHB1YmxpYyB2YWx1ZTogYW55O1xuXG4gIGNvbnN0cnVjdG9yKGNoaXA6IGFueSwgaWQ6IGFueSkge1xuICAgIHRoaXMuY2hpcCA9IGNoaXA7XG4gICAgdGhpcy5pZCA9IGlkO1xuICAgIHRoaXMudmFsdWUgPSAwO1xuICB9XG5cbiAgcHVibGljIG91dHB1dCh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5jaGlwLm91dHB1dCh0aGlzLmlkLCB2YWx1ZSk7XG4gIH1cbn1cblxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1jbGFzc2VzLXBlci1maWxlXG5jbGFzcyBTTng0SEM1OTUge1xuXG4gIHB1YmxpYyBzdGF0aWMgaW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogXCJTTng0SEM1OTVcIixcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGtleXM6IGFueTtcbiAgcHVibGljIHJlcXVpcmVkS2V5czogYW55O1xuICBwdWJsaWMgYXV0b0ZsYXNoOiBhbnk7XG4gIHB1YmxpYyBvYm5pejogYW55O1xuICBwdWJsaWMgaW9fc2VyOiBhbnk7XG4gIHB1YmxpYyBwYXJhbXM6IGFueTtcbiAgcHVibGljIGlvX3NyY2xrOiBhbnk7XG4gIHB1YmxpYyBpb19yY2xrOiBhbnk7XG4gIHB1YmxpYyBpb19zcmNscjogYW55O1xuICBwdWJsaWMgaW9fb2U6IGFueTtcbiAgcHVibGljIGNoaXA6IGFueTtcbiAgcHVibGljIGlkOiBhbnk7XG4gIHB1YmxpYyB2YWx1ZTogYW55O1xuICBwdWJsaWMgX2lvX251bTogYW55O1xuICBwdWJsaWMgaW86IGFueTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvKiBodHRwOi8vd3d3LnRpLmNvbS9saXQvZHMvc3ltbGluay9zbjc0aGM1OTUucGRmICovXG4gICAgdGhpcy5rZXlzID0gW1xuICAgICAgXCJnbmRcIixcbiAgICAgIFwidmNjXCIsXG4gICAgICBcInNlclwiLFxuICAgICAgXCJzcmNsa1wiLFxuICAgICAgXCJyY2xrXCIsXG4gICAgICBcIm9lXCIsXG4gICAgICBcInNyY2xyXCIsXG4gICAgICBcImlvX251bVwiLFxuICAgICAgXCJlbmFibGVkXCIsXG4gICAgXTtcbiAgICB0aGlzLnJlcXVpcmVkS2V5cyA9IFtcInNlclwiLCBcInNyY2xrXCIsIFwicmNsa1wiXTtcblxuICAgIHRoaXMuYXV0b0ZsYXNoID0gdHJ1ZTtcbiAgfVxuXG4gIHB1YmxpYyB3aXJlZChvYm5pejogYW55KSB7XG4gICAgdGhpcy5vYm5peiA9IG9ibml6O1xuXG4gICAgdGhpcy5pb19zZXIgPSB0aGlzLm9ibml6LmdldElPKHRoaXMucGFyYW1zLnNlcik7XG4gICAgdGhpcy5pb19zcmNsayA9IHRoaXMub2JuaXouZ2V0SU8odGhpcy5wYXJhbXMuc3JjbGspO1xuICAgIHRoaXMuaW9fcmNsayA9IHRoaXMub2JuaXouZ2V0SU8odGhpcy5wYXJhbXMucmNsayk7XG5cbiAgICB0aGlzLmlvX3Nlci5vdXRwdXQoZmFsc2UpO1xuICAgIHRoaXMuaW9fc3JjbGsub3V0cHV0KGZhbHNlKTtcbiAgICB0aGlzLmlvX3JjbGsub3V0cHV0KGZhbHNlKTtcblxuICAgIHRoaXMub2JuaXouc2V0VmNjR25kKHRoaXMucGFyYW1zLnZjYywgdGhpcy5wYXJhbXMuZ25kLCBcIjV2XCIpO1xuXG4gICAgaWYgKHRoaXMub2JuaXouaXNWYWxpZElPKHRoaXMucGFyYW1zLnNyY2xyKSkge1xuICAgICAgdGhpcy5pb19zcmNsciA9IHRoaXMub2JuaXouZ2V0SU8odGhpcy5wYXJhbXMuc3JjbHIpO1xuICAgICAgdGhpcy5pb19zcmNsci5vdXRwdXQodHJ1ZSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub2JuaXouaXNWYWxpZElPKHRoaXMucGFyYW1zLm9lKSkge1xuICAgICAgdGhpcy5pb19vZSA9IHRoaXMub2JuaXouZ2V0SU8odGhpcy5wYXJhbXMub2UpO1xuICAgICAgdGhpcy5pb19vZS5vdXRwdXQodHJ1ZSk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgdGhpcy5vYm5pei5pc1ZhbGlkSU8odGhpcy5wYXJhbXMudmNjKSB8fFxuICAgICAgdGhpcy5vYm5pei5pc1ZhbGlkSU8odGhpcy5wYXJhbXMuZ25kKVxuICAgICkge1xuICAgICAgdGhpcy5vYm5pei53YWl0KDEwMCk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB0aGlzLnBhcmFtcy5pb19udW0gIT09IFwibnVtYmVyXCIpIHtcbiAgICAgIHRoaXMucGFyYW1zLmlvX251bSA9IDg7XG4gICAgfVxuICAgIHRoaXMuaW9OdW0odGhpcy5wYXJhbXMuaW9fbnVtKTtcblxuICAgIGlmICh0eXBlb2YgdGhpcy5wYXJhbXMuZW5hYmxlZCAhPT0gXCJib29sZWFuXCIpIHtcbiAgICAgIHRoaXMucGFyYW1zLmVuYWJsZWQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAodGhpcy5pb19vZSAmJiB0aGlzLnBhcmFtcy5lbmFibGVkKSB7XG4gICAgICB0aGlzLmlvX29lLm91dHB1dChmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGlvTnVtKG51bTogYW55KSB7XG5cbiAgICBpZiAodHlwZW9mIG51bSA9PT0gXCJudW1iZXJcIiAmJiB0aGlzLl9pb19udW0gIT09IG51bSkge1xuICAgICAgdGhpcy5faW9fbnVtID0gbnVtO1xuICAgICAgdGhpcy5pbyA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW07IGkrKykge1xuICAgICAgICB0aGlzLmlvLnB1c2gobmV3IFNOeDRIQzU5NV9JTyh0aGlzLCBpKSk7XG4gICAgICB9XG4gICAgICB0aGlzLmZsdXNoKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcImlvIG51bSBzaG91bGQgYmUgYSBudW1iZXJcIik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGlzVmFsaWRJTyhpbzogYW55KSB7XG4gICAgcmV0dXJuIHR5cGVvZiBpbyA9PT0gXCJudW1iZXJcIiAmJiBpbyA+PSAwICYmIGlvIDwgdGhpcy5faW9fbnVtO1xuICB9XG5cbiAgcHVibGljIGdldElPKGlvOiBhbnkpIHtcbiAgICBpZiAoIXRoaXMuaXNWYWxpZElPKGlvKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaW8gXCIgKyBpbyArIFwiIGlzIG5vdCB2YWxpZCBpb1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaW9baW9dO1xuICB9XG5cbiAgcHVibGljIG91dHB1dChpZDogYW55LCB2YWx1ZTogYW55KSB7XG4gICAgdmFsdWUgPSB2YWx1ZSA9PT0gdHJ1ZTtcbiAgICB0aGlzLmlvW2lkXS52YWx1ZSA9IHZhbHVlO1xuICAgIGlmICh0aGlzLmF1dG9GbGFzaCkge1xuICAgICAgdGhpcy5mbHVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvbmVjZShvcGVyYXRpb246IGFueSkge1xuICAgIGlmICh0eXBlb2Ygb3BlcmF0aW9uICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcInBsZWFzZSBwcm92aWRlIGZ1bmN0aW9uXCIpO1xuICAgIH1cbiAgICBjb25zdCBsYXN0VmFsdWU6IGFueSA9IHRoaXMuYXV0b0ZsYXNoO1xuICAgIHRoaXMuYXV0b0ZsYXNoID0gZmFsc2U7XG4gICAgb3BlcmF0aW9uKCk7XG4gICAgdGhpcy5mbHVzaCgpO1xuICAgIHRoaXMuYXV0b0ZsYXNoID0gbGFzdFZhbHVlO1xuICB9XG5cbiAgcHVibGljIHNldEVuYWJsZShlbmFibGU6IGFueSkge1xuICAgIGlmICghdGhpcy5pb19vZSAmJiBlbmFibGUgPT09IGZhbHNlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3BpbiBcIm9lXCIgaXMgbm90IHNwZWNpZmllZCcpO1xuICAgIH1cbiAgICB0aGlzLmlvX29lLm91dHB1dCghZW5hYmxlKTtcbiAgfVxuXG4gIHB1YmxpYyBmbHVzaCgpIHtcbiAgICAvKiB0aGlzIGNvZGUgd2lsbCB3b3JrcyB3aXRoIDV2LiBCdXQgeW91IHNob3VsZCBwYXkgbW9yZSBhdHRlbnRpb24gd2hlbiAzdi4gVGltaW5nIGlzIG1vcmUgdGlnaHQuIHNlZSBjaGlwIHJlZmVyZW5jZSAqL1xuICAgIHRoaXMuaW9fcmNsay5vdXRwdXQoZmFsc2UpO1xuICAgIGZvciAobGV0IGkgPSB0aGlzLmlvLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICB0aGlzLmlvX3Nlci5vdXRwdXQodGhpcy5pb1tpXS52YWx1ZSk7XG4gICAgICB0aGlzLmlvX3NyY2xrLm91dHB1dCh0cnVlKTtcbiAgICAgIHRoaXMuaW9fc3JjbGsub3V0cHV0KGZhbHNlKTtcbiAgICB9XG4gICAgdGhpcy5pb19yY2xrLm91dHB1dCh0cnVlKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTTng0SEM1OTU7XG4iXX0=
