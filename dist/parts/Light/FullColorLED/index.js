"use strict";
class FullColorLED {
    constructor() {
        this.COMMON_TYPE_ANODE = 1;
        this.COMMON_TYPE_CATHODE = 0;
        this.anode_keys = ['anode', 'anode_common', 'anodeCommon', 'vcc'];
        this.cathode_keys = ['cathode', 'cathode_common', 'cathodeCommon', 'gnd'];
        this.animationName = 'FullColorLED-' + Math.round(Math.random() * 1000);
        this.keys = ['r', 'g', 'b', 'common', 'commonType'];
        this.requiredKeys = ['r', 'g', 'b', 'common', 'commonType'];
    }
    static info() {
        return {
            name: 'FullColorLED',
        };
    }
    wired(obniz) {
        let r = this.params.r;
        let g = this.params.g;
        let b = this.params.b;
        let common = this.params.common;
        let commontype = this.params.commonType;
        this.obniz = obniz;
        if (this.anode_keys.includes(commontype)) {
            this.commontype = this.COMMON_TYPE_ANODE;
        }
        else if (this.cathode_keys.includes(commontype)) {
            this.commontype = this.COMMON_TYPE_CATHODE;
        }
        else {
            this.obniz.error('FullColorLED param need common type [  anode_common or cathode_common ] ');
        }
        this.common = this.obniz.getIO(common);
        this.common.output(this.commontype);
        this.obniz.getIO(r).output(this.commontype);
        this.obniz.getIO(g).output(this.commontype);
        this.obniz.getIO(b).output(this.commontype);
        this.pwmR = this.obniz.getFreePwm();
        this.pwmR.start({ io: r });
        this.pwmR.freq(1000);
        this.pwmG = this.obniz.getFreePwm();
        this.pwmG.start({ io: g });
        this.pwmG.freq(1000);
        this.pwmB = this.obniz.getFreePwm();
        this.pwmB.start({ io: b });
        this.pwmB.freq(1000);
        this.rgb(0, 0, 0);
    }
    rgb(r, g, b) {
        r = Math.min(Math.max(parseInt(r), 0), 255);
        g = Math.min(Math.max(parseInt(g), 0), 255);
        b = Math.min(Math.max(parseInt(b), 0), 255);
        if (this.commontype === this.COMMON_TYPE_ANODE) {
            r = 255 - r;
            g = 255 - g;
            b = 255 - b;
        }
        this.pwmR.duty((r / 255) * 100);
        this.pwmG.duty((g / 255) * 100);
        this.pwmB.duty((b / 255) * 100);
    }
    hsv(h, s, v) {
        let C = v * s;
        let Hp = h / 60;
        let X = C * (1 - Math.abs((Hp % 2) - 1));
        let R, G, B;
        if (0 <= Hp && Hp < 1) {
            [R, G, B] = [C, X, 0];
        }
        if (1 <= Hp && Hp < 2) {
            [R, G, B] = [X, C, 0];
        }
        if (2 <= Hp && Hp < 3) {
            [R, G, B] = [0, C, X];
        }
        if (3 <= Hp && Hp < 4) {
            [R, G, B] = [0, X, C];
        }
        if (4 <= Hp && Hp < 5) {
            [R, G, B] = [X, 0, C];
        }
        if (5 <= Hp && Hp < 6) {
            [R, G, B] = [C, 0, X];
        }
        let m = v - C;
        [R, G, B] = [R + m, G + m, B + m];
        R = Math.floor(R * 255);
        G = Math.floor(G * 255);
        B = Math.floor(B * 255);
        this.rgb(R, G, B);
    }
    gradation(cycletime_ms) {
        let frames = [];
        let max = 36 / 2;
        let duration = Math.round(cycletime_ms / max);
        for (let i = 0; i < max; i++) {
            let oneFrame = {
                duration: duration,
                state: function (index) {
                    // index = 0
                    this.hsv(index * 10 * 2, 1, 1);
                }.bind(this),
            };
            frames.push(oneFrame);
        }
        this.obniz.io.animation(this.animationName, 'loop', frames);
    }
    stopgradation() {
        this.obniz.io.animation(this.animationName, 'pause');
    }
}
if (typeof module === 'object') {
    module.exports = FullColorLED;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9MaWdodC9GdWxsQ29sb3JMRUQvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE1BQU0sWUFBWTtJQUNoQjtRQUNFLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxDQUFDLENBQUM7UUFDM0IsSUFBSSxDQUFDLG1CQUFtQixHQUFHLENBQUMsQ0FBQztRQUU3QixJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsT0FBTyxFQUFFLGNBQWMsRUFBRSxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEUsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDMUUsSUFBSSxDQUFDLGFBQWEsR0FBRyxlQUFlLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFFeEUsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUNwRCxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFFRCxNQUFNLENBQUMsSUFBSTtRQUNULE9BQU87WUFDTCxJQUFJLEVBQUUsY0FBYztTQUNyQixDQUFDO0lBQ0osQ0FBQztJQUVELEtBQUssQ0FBQyxLQUFLO1FBQ1QsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDaEMsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7UUFFeEMsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRTtZQUN4QyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztTQUMxQzthQUFNLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUU7WUFDakQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUM7U0FDNUM7YUFBTTtZQUNMLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUNkLDBFQUEwRSxDQUMzRSxDQUFDO1NBQ0g7UUFFRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVwQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzVDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDVCxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM1QyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM1QyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUU1QyxJQUFJLElBQUksQ0FBQyxVQUFVLEtBQUssSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQzlDLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBQ1osQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFDWixDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztTQUNiO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVELEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDVCxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsSUFBSSxFQUFFLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXpDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDWixJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRTtZQUNyQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDckIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN2QjtRQUNELElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDdkI7UUFDRCxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRTtZQUNyQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDckIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN2QjtRQUNELElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDdkI7UUFFRCxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUVsQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDeEIsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ3hCLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUV4QixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELFNBQVMsQ0FBQyxZQUFZO1FBQ3BCLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFJLEdBQUcsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQzlDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDNUIsSUFBSSxRQUFRLEdBQUc7Z0JBQ2IsUUFBUSxFQUFFLFFBQVE7Z0JBQ2xCLEtBQUssRUFBRSxVQUFTLEtBQUs7b0JBQ25CLFlBQVk7b0JBQ1osSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO2FBQ2IsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDdkI7UUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUVELGFBQWE7UUFDWCxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUN2RCxDQUFDO0NBQ0Y7QUFFRCxJQUFJLE9BQU8sTUFBTSxLQUFLLFFBQVEsRUFBRTtJQUM5QixNQUFNLENBQUMsT0FBTyxHQUFHLFlBQVksQ0FBQztDQUMvQiIsImZpbGUiOiJwYXJ0cy9MaWdodC9GdWxsQ29sb3JMRUQvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBGdWxsQ29sb3JMRUQge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLkNPTU1PTl9UWVBFX0FOT0RFID0gMTtcbiAgICB0aGlzLkNPTU1PTl9UWVBFX0NBVEhPREUgPSAwO1xuXG4gICAgdGhpcy5hbm9kZV9rZXlzID0gWydhbm9kZScsICdhbm9kZV9jb21tb24nLCAnYW5vZGVDb21tb24nLCAndmNjJ107XG4gICAgdGhpcy5jYXRob2RlX2tleXMgPSBbJ2NhdGhvZGUnLCAnY2F0aG9kZV9jb21tb24nLCAnY2F0aG9kZUNvbW1vbicsICdnbmQnXTtcbiAgICB0aGlzLmFuaW1hdGlvbk5hbWUgPSAnRnVsbENvbG9yTEVELScgKyBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAwKTtcblxuICAgIHRoaXMua2V5cyA9IFsncicsICdnJywgJ2InLCAnY29tbW9uJywgJ2NvbW1vblR5cGUnXTtcbiAgICB0aGlzLnJlcXVpcmVkS2V5cyA9IFsncicsICdnJywgJ2InLCAnY29tbW9uJywgJ2NvbW1vblR5cGUnXTtcbiAgfVxuXG4gIHN0YXRpYyBpbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiAnRnVsbENvbG9yTEVEJyxcbiAgICB9O1xuICB9XG5cbiAgd2lyZWQob2JuaXopIHtcbiAgICBsZXQgciA9IHRoaXMucGFyYW1zLnI7XG4gICAgbGV0IGcgPSB0aGlzLnBhcmFtcy5nO1xuICAgIGxldCBiID0gdGhpcy5wYXJhbXMuYjtcbiAgICBsZXQgY29tbW9uID0gdGhpcy5wYXJhbXMuY29tbW9uO1xuICAgIGxldCBjb21tb250eXBlID0gdGhpcy5wYXJhbXMuY29tbW9uVHlwZTtcblxuICAgIHRoaXMub2JuaXogPSBvYm5pejtcbiAgICBpZiAodGhpcy5hbm9kZV9rZXlzLmluY2x1ZGVzKGNvbW1vbnR5cGUpKSB7XG4gICAgICB0aGlzLmNvbW1vbnR5cGUgPSB0aGlzLkNPTU1PTl9UWVBFX0FOT0RFO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jYXRob2RlX2tleXMuaW5jbHVkZXMoY29tbW9udHlwZSkpIHtcbiAgICAgIHRoaXMuY29tbW9udHlwZSA9IHRoaXMuQ09NTU9OX1RZUEVfQ0FUSE9ERTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vYm5pei5lcnJvcihcbiAgICAgICAgJ0Z1bGxDb2xvckxFRCBwYXJhbSBuZWVkIGNvbW1vbiB0eXBlIFsgIGFub2RlX2NvbW1vbiBvciBjYXRob2RlX2NvbW1vbiBdICdcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy5jb21tb24gPSB0aGlzLm9ibml6LmdldElPKGNvbW1vbik7XG4gICAgdGhpcy5jb21tb24ub3V0cHV0KHRoaXMuY29tbW9udHlwZSk7XG5cbiAgICB0aGlzLm9ibml6LmdldElPKHIpLm91dHB1dCh0aGlzLmNvbW1vbnR5cGUpO1xuICAgIHRoaXMub2JuaXouZ2V0SU8oZykub3V0cHV0KHRoaXMuY29tbW9udHlwZSk7XG4gICAgdGhpcy5vYm5pei5nZXRJTyhiKS5vdXRwdXQodGhpcy5jb21tb250eXBlKTtcbiAgICB0aGlzLnB3bVIgPSB0aGlzLm9ibml6LmdldEZyZWVQd20oKTtcbiAgICB0aGlzLnB3bVIuc3RhcnQoeyBpbzogciB9KTtcbiAgICB0aGlzLnB3bVIuZnJlcSgxMDAwKTtcbiAgICB0aGlzLnB3bUcgPSB0aGlzLm9ibml6LmdldEZyZWVQd20oKTtcbiAgICB0aGlzLnB3bUcuc3RhcnQoeyBpbzogZyB9KTtcbiAgICB0aGlzLnB3bUcuZnJlcSgxMDAwKTtcbiAgICB0aGlzLnB3bUIgPSB0aGlzLm9ibml6LmdldEZyZWVQd20oKTtcbiAgICB0aGlzLnB3bUIuc3RhcnQoeyBpbzogYiB9KTtcbiAgICB0aGlzLnB3bUIuZnJlcSgxMDAwKTtcbiAgICB0aGlzLnJnYigwLCAwLCAwKTtcbiAgfVxuXG4gIHJnYihyLCBnLCBiKSB7XG4gICAgciA9IE1hdGgubWluKE1hdGgubWF4KHBhcnNlSW50KHIpLCAwKSwgMjU1KTtcbiAgICBnID0gTWF0aC5taW4oTWF0aC5tYXgocGFyc2VJbnQoZyksIDApLCAyNTUpO1xuICAgIGIgPSBNYXRoLm1pbihNYXRoLm1heChwYXJzZUludChiKSwgMCksIDI1NSk7XG5cbiAgICBpZiAodGhpcy5jb21tb250eXBlID09PSB0aGlzLkNPTU1PTl9UWVBFX0FOT0RFKSB7XG4gICAgICByID0gMjU1IC0gcjtcbiAgICAgIGcgPSAyNTUgLSBnO1xuICAgICAgYiA9IDI1NSAtIGI7XG4gICAgfVxuICAgIHRoaXMucHdtUi5kdXR5KChyIC8gMjU1KSAqIDEwMCk7XG4gICAgdGhpcy5wd21HLmR1dHkoKGcgLyAyNTUpICogMTAwKTtcbiAgICB0aGlzLnB3bUIuZHV0eSgoYiAvIDI1NSkgKiAxMDApO1xuICB9XG5cbiAgaHN2KGgsIHMsIHYpIHtcbiAgICBsZXQgQyA9IHYgKiBzO1xuICAgIGxldCBIcCA9IGggLyA2MDtcbiAgICBsZXQgWCA9IEMgKiAoMSAtIE1hdGguYWJzKChIcCAlIDIpIC0gMSkpO1xuXG4gICAgbGV0IFIsIEcsIEI7XG4gICAgaWYgKDAgPD0gSHAgJiYgSHAgPCAxKSB7XG4gICAgICBbUiwgRywgQl0gPSBbQywgWCwgMF07XG4gICAgfVxuICAgIGlmICgxIDw9IEhwICYmIEhwIDwgMikge1xuICAgICAgW1IsIEcsIEJdID0gW1gsIEMsIDBdO1xuICAgIH1cbiAgICBpZiAoMiA8PSBIcCAmJiBIcCA8IDMpIHtcbiAgICAgIFtSLCBHLCBCXSA9IFswLCBDLCBYXTtcbiAgICB9XG4gICAgaWYgKDMgPD0gSHAgJiYgSHAgPCA0KSB7XG4gICAgICBbUiwgRywgQl0gPSBbMCwgWCwgQ107XG4gICAgfVxuICAgIGlmICg0IDw9IEhwICYmIEhwIDwgNSkge1xuICAgICAgW1IsIEcsIEJdID0gW1gsIDAsIENdO1xuICAgIH1cbiAgICBpZiAoNSA8PSBIcCAmJiBIcCA8IDYpIHtcbiAgICAgIFtSLCBHLCBCXSA9IFtDLCAwLCBYXTtcbiAgICB9XG5cbiAgICBsZXQgbSA9IHYgLSBDO1xuICAgIFtSLCBHLCBCXSA9IFtSICsgbSwgRyArIG0sIEIgKyBtXTtcblxuICAgIFIgPSBNYXRoLmZsb29yKFIgKiAyNTUpO1xuICAgIEcgPSBNYXRoLmZsb29yKEcgKiAyNTUpO1xuICAgIEIgPSBNYXRoLmZsb29yKEIgKiAyNTUpO1xuXG4gICAgdGhpcy5yZ2IoUiwgRywgQik7XG4gIH1cblxuICBncmFkYXRpb24oY3ljbGV0aW1lX21zKSB7XG4gICAgbGV0IGZyYW1lcyA9IFtdO1xuICAgIGxldCBtYXggPSAzNiAvIDI7XG4gICAgbGV0IGR1cmF0aW9uID0gTWF0aC5yb3VuZChjeWNsZXRpbWVfbXMgLyBtYXgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4OyBpKyspIHtcbiAgICAgIGxldCBvbmVGcmFtZSA9IHtcbiAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uLFxuICAgICAgICBzdGF0ZTogZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAvLyBpbmRleCA9IDBcbiAgICAgICAgICB0aGlzLmhzdihpbmRleCAqIDEwICogMiwgMSwgMSk7XG4gICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgIH07XG4gICAgICBmcmFtZXMucHVzaChvbmVGcmFtZSk7XG4gICAgfVxuICAgIHRoaXMub2JuaXouaW8uYW5pbWF0aW9uKHRoaXMuYW5pbWF0aW9uTmFtZSwgJ2xvb3AnLCBmcmFtZXMpO1xuICB9XG5cbiAgc3RvcGdyYWRhdGlvbigpIHtcbiAgICB0aGlzLm9ibml6LmlvLmFuaW1hdGlvbih0aGlzLmFuaW1hdGlvbk5hbWUsICdwYXVzZScpO1xuICB9XG59XG5cbmlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jykge1xuICBtb2R1bGUuZXhwb3J0cyA9IEZ1bGxDb2xvckxFRDtcbn1cbiJdfQ==
