"use strict";
class _7SegmentLED_MAX7219 {
    constructor() {
        this.keys = ['vcc', 'gnd', 'din', 'cs', 'clk'];
        this.requiredKeys = ['din', 'cs', 'clk'];
    }
    static info() {
        return {
            name: '7SegmentLED_MAX7219',
        };
    }
    wired(obniz) {
        this.cs = obniz.getIO(this.params.cs);
        // logich high must 3.5v <=
        if (obniz.isValidIO(this.params.vcc)) {
            obniz.getIO(this.params.vcc).output(true);
        }
        if (obniz.isValidIO(this.params.gnd)) {
            obniz.getIO(this.params.gnd).output(false);
        }
        // max 10Mhz but motor driver can't
        this.params.frequency = this.params.frequency || 10 * 1000 * 1000;
        this.params.mode = 'master';
        this.params.mosi = this.params.din;
        this.params.drive = '3v';
        this.spi = this.obniz.getSpiWithConfig(this.params);
        // reset a onece
        this.cs.output(true);
        this.cs.output(false);
        this.cs.output(true);
    }
    init(numOfDisplay, digits) {
        this.numOfDisp = numOfDisplay;
        this.digits = digits;
        this.writeAllDisp([0x09, 0xff]); // Code B decode for digits 7-0
        this.writeAllDisp([0x0a, 0x05]); // brightness 11/32 0 to f
        this.writeAllDisp([0x0b, digits - 1]);
        this.writeAllDisp([0x0c, 0x01]); // Shutdown to normal operation
        this.writeAllDisp([0x0f, 0x00]);
        this.obniz.wait(10);
    }
    clear(disp) {
        for (let i = 0; i < this.digits; i++) {
            this.writeOneDisp(disp, [i + 1, 0x0f]);
        }
    }
    clearAll() {
        for (let i = 0; i < this.numOfDisp; i++) {
            for (let j = 0; j < this.digits; j++) {
                this.writeAllDisp([j + 1, 0x0f]);
            }
        }
    }
    test() {
        this.writeAllDisp([0x0f, 0x00]); // test command
    }
    brightness(disp, val) {
        this.writeOneDisp(disp, [0x0a, val]); // 0 to 15;
    }
    brightnessAll(val) {
        this.writeAllDisp([0x0a, val]); // 0 to 15;
    }
    writeAllDisp(data) {
        for (let i = 0; i < this.numOfDisp; i++) {
            this.writeOneDisp(i, data);
        }
    }
    writeOneDisp(disp, data) {
        this.cs.output(false);
        for (let i = 0; i < disp; i++) {
            this.spi.write([0x00, 0x00]);
        }
        this.spi.write(data);
        for (let i = 0; i < this.numOfDisp - (disp + 1); i++) {
            this.spi.write([0x00, 0x00]);
        }
        this.cs.output(true);
    }
    setNumber(disp, digit, number, dp) {
        if (digit >= 0 && digit <= this.digits - 1) {
            this.writeOneDisp(disp, [digit + 1, this.encodeBCD(number, dp)]);
        }
    }
    encodeBCD(decimal, dp) {
        let dpreg;
        if (dp == true) {
            dpreg = 0x80;
        }
        else {
            dpreg = 0x00;
        }
        if (decimal >= 0 && decimal <= 9) {
            return decimal | dpreg;
        }
        else if (decimal == '-' || decimal == 10) {
            return 0x0a | dpreg;
        }
        else if (decimal == 'e' || decimal == 11) {
            return 0x0b | dpreg;
        }
        else if (decimal == 'h' || decimal == 12) {
            return 0x0c | dpreg;
        }
        else if (decimal == 'l' || decimal == 13) {
            return 0x0d | dpreg;
        }
        else if (decimal == 'p' || decimal == 14) {
            return 0x0e | dpreg;
        }
        else if (decimal == 'on') {
            // light all segments
            return 0x88;
        }
        else if (decimal == 'off') {
            return 0x0f | dpreg;
        }
        else {
            return 0x0f | dpreg;
        }
    }
}
if (typeof module === 'object') {
    module.exports = _7SegmentLED_MAX7219;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9EaXNwbGF5LzdTZWdtZW50TEVEX01BWDcyMTkvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE1BQU0sb0JBQW9CO0lBQ3hCO1FBQ0UsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUk7UUFDVCxPQUFPO1lBQ0wsSUFBSSxFQUFFLHFCQUFxQjtTQUM1QixDQUFDO0lBQ0osQ0FBQztJQUVELEtBQUssQ0FBQyxLQUFLO1FBQ1QsSUFBSSxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdEMsMkJBQTJCO1FBQzNCLElBQUksS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3BDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDM0M7UUFDRCxJQUFJLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNwQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzVDO1FBRUQsbUNBQW1DO1FBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxJQUFJLEVBQUUsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztRQUM1QixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQztRQUNuQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDekIsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVwRCxnQkFBZ0I7UUFDaEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUVELElBQUksQ0FBQyxZQUFZLEVBQUUsTUFBTTtRQUN2QixJQUFJLENBQUMsU0FBUyxHQUFHLFlBQVksQ0FBQztRQUM5QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQywrQkFBK0I7UUFDaEUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsMEJBQTBCO1FBQzNELElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLEVBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsK0JBQStCO1FBQ2hFLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN0QixDQUFDO0lBRUQsS0FBSyxDQUFDLElBQUk7UUFDUixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNwQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUN4QztJQUNILENBQUM7SUFFRCxRQUFRO1FBQ04sS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDdkMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ3BDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDbEM7U0FDRjtJQUNILENBQUM7SUFFRCxJQUFJO1FBQ0YsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZTtJQUNsRCxDQUFDO0lBRUQsVUFBVSxDQUFDLElBQUksRUFBRSxHQUFHO1FBQ2xCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXO0lBQ25ELENBQUM7SUFFRCxhQUFhLENBQUMsR0FBRztRQUNmLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVc7SUFDN0MsQ0FBQztJQUVELFlBQVksQ0FBQyxJQUFJO1FBQ2YsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDdkMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDNUI7SUFDSCxDQUFDO0lBRUQsWUFBWSxDQUFDLElBQUksRUFBRSxJQUFJO1FBQ3JCLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3RCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDN0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUM5QjtRQUNELElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3BELElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDOUI7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN2QixDQUFDO0lBRUQsU0FBUyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFDL0IsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUMxQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ2xFO0lBQ0gsQ0FBQztJQUVELFNBQVMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtRQUNuQixJQUFJLEtBQUssQ0FBQztRQUNWLElBQUksRUFBRSxJQUFJLElBQUksRUFBRTtZQUNkLEtBQUssR0FBRyxJQUFJLENBQUM7U0FDZDthQUFNO1lBQ0wsS0FBSyxHQUFHLElBQUksQ0FBQztTQUNkO1FBQ0QsSUFBSSxPQUFPLElBQUksQ0FBQyxJQUFJLE9BQU8sSUFBSSxDQUFDLEVBQUU7WUFDaEMsT0FBTyxPQUFPLEdBQUcsS0FBSyxDQUFDO1NBQ3hCO2FBQU0sSUFBSSxPQUFPLElBQUksR0FBRyxJQUFJLE9BQU8sSUFBSSxFQUFFLEVBQUU7WUFDMUMsT0FBTyxJQUFJLEdBQUcsS0FBSyxDQUFDO1NBQ3JCO2FBQU0sSUFBSSxPQUFPLElBQUksR0FBRyxJQUFJLE9BQU8sSUFBSSxFQUFFLEVBQUU7WUFDMUMsT0FBTyxJQUFJLEdBQUcsS0FBSyxDQUFDO1NBQ3JCO2FBQU0sSUFBSSxPQUFPLElBQUksR0FBRyxJQUFJLE9BQU8sSUFBSSxFQUFFLEVBQUU7WUFDMUMsT0FBTyxJQUFJLEdBQUcsS0FBSyxDQUFDO1NBQ3JCO2FBQU0sSUFBSSxPQUFPLElBQUksR0FBRyxJQUFJLE9BQU8sSUFBSSxFQUFFLEVBQUU7WUFDMUMsT0FBTyxJQUFJLEdBQUcsS0FBSyxDQUFDO1NBQ3JCO2FBQU0sSUFBSSxPQUFPLElBQUksR0FBRyxJQUFJLE9BQU8sSUFBSSxFQUFFLEVBQUU7WUFDMUMsT0FBTyxJQUFJLEdBQUcsS0FBSyxDQUFDO1NBQ3JCO2FBQU0sSUFBSSxPQUFPLElBQUksSUFBSSxFQUFFO1lBQzFCLHFCQUFxQjtZQUNyQixPQUFPLElBQUksQ0FBQztTQUNiO2FBQU0sSUFBSSxPQUFPLElBQUksS0FBSyxFQUFFO1lBQzNCLE9BQU8sSUFBSSxHQUFHLEtBQUssQ0FBQztTQUNyQjthQUFNO1lBQ0wsT0FBTyxJQUFJLEdBQUcsS0FBSyxDQUFDO1NBQ3JCO0lBQ0gsQ0FBQztDQUNGO0FBRUQsSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUU7SUFDOUIsTUFBTSxDQUFDLE9BQU8sR0FBRyxvQkFBb0IsQ0FBQztDQUN2QyIsImZpbGUiOiJwYXJ0cy9EaXNwbGF5LzdTZWdtZW50TEVEX01BWDcyMTkvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBfN1NlZ21lbnRMRURfTUFYNzIxOSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMua2V5cyA9IFsndmNjJywgJ2duZCcsICdkaW4nLCAnY3MnLCAnY2xrJ107XG4gICAgdGhpcy5yZXF1aXJlZEtleXMgPSBbJ2RpbicsICdjcycsICdjbGsnXTtcbiAgfVxuXG4gIHN0YXRpYyBpbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiAnN1NlZ21lbnRMRURfTUFYNzIxOScsXG4gICAgfTtcbiAgfVxuXG4gIHdpcmVkKG9ibml6KSB7XG4gICAgdGhpcy5jcyA9IG9ibml6LmdldElPKHRoaXMucGFyYW1zLmNzKTtcbiAgICAvLyBsb2dpY2ggaGlnaCBtdXN0IDMuNXYgPD1cbiAgICBpZiAob2JuaXouaXNWYWxpZElPKHRoaXMucGFyYW1zLnZjYykpIHtcbiAgICAgIG9ibml6LmdldElPKHRoaXMucGFyYW1zLnZjYykub3V0cHV0KHRydWUpO1xuICAgIH1cbiAgICBpZiAob2JuaXouaXNWYWxpZElPKHRoaXMucGFyYW1zLmduZCkpIHtcbiAgICAgIG9ibml6LmdldElPKHRoaXMucGFyYW1zLmduZCkub3V0cHV0KGZhbHNlKTtcbiAgICB9XG5cbiAgICAvLyBtYXggMTBNaHogYnV0IG1vdG9yIGRyaXZlciBjYW4ndFxuICAgIHRoaXMucGFyYW1zLmZyZXF1ZW5jeSA9IHRoaXMucGFyYW1zLmZyZXF1ZW5jeSB8fCAxMCAqIDEwMDAgKiAxMDAwO1xuICAgIHRoaXMucGFyYW1zLm1vZGUgPSAnbWFzdGVyJztcbiAgICB0aGlzLnBhcmFtcy5tb3NpID0gdGhpcy5wYXJhbXMuZGluO1xuICAgIHRoaXMucGFyYW1zLmRyaXZlID0gJzN2JztcbiAgICB0aGlzLnNwaSA9IHRoaXMub2JuaXouZ2V0U3BpV2l0aENvbmZpZyh0aGlzLnBhcmFtcyk7XG5cbiAgICAvLyByZXNldCBhIG9uZWNlXG4gICAgdGhpcy5jcy5vdXRwdXQodHJ1ZSk7XG4gICAgdGhpcy5jcy5vdXRwdXQoZmFsc2UpO1xuICAgIHRoaXMuY3Mub3V0cHV0KHRydWUpO1xuICB9XG5cbiAgaW5pdChudW1PZkRpc3BsYXksIGRpZ2l0cykge1xuICAgIHRoaXMubnVtT2ZEaXNwID0gbnVtT2ZEaXNwbGF5O1xuICAgIHRoaXMuZGlnaXRzID0gZGlnaXRzO1xuICAgIHRoaXMud3JpdGVBbGxEaXNwKFsweDA5LCAweGZmXSk7IC8vIENvZGUgQiBkZWNvZGUgZm9yIGRpZ2l0cyA3LTBcbiAgICB0aGlzLndyaXRlQWxsRGlzcChbMHgwYSwgMHgwNV0pOyAvLyBicmlnaHRuZXNzIDExLzMyIDAgdG8gZlxuICAgIHRoaXMud3JpdGVBbGxEaXNwKFsweDBiLCBkaWdpdHMgLSAxXSk7XG4gICAgdGhpcy53cml0ZUFsbERpc3AoWzB4MGMsIDB4MDFdKTsgLy8gU2h1dGRvd24gdG8gbm9ybWFsIG9wZXJhdGlvblxuICAgIHRoaXMud3JpdGVBbGxEaXNwKFsweDBmLCAweDAwXSk7XG4gICAgdGhpcy5vYm5pei53YWl0KDEwKTtcbiAgfVxuXG4gIGNsZWFyKGRpc3ApIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZGlnaXRzOyBpKyspIHtcbiAgICAgIHRoaXMud3JpdGVPbmVEaXNwKGRpc3AsIFtpICsgMSwgMHgwZl0pO1xuICAgIH1cbiAgfVxuXG4gIGNsZWFyQWxsKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5udW1PZkRpc3A7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmRpZ2l0czsgaisrKSB7XG4gICAgICAgIHRoaXMud3JpdGVBbGxEaXNwKFtqICsgMSwgMHgwZl0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRlc3QoKSB7XG4gICAgdGhpcy53cml0ZUFsbERpc3AoWzB4MGYsIDB4MDBdKTsgLy8gdGVzdCBjb21tYW5kXG4gIH1cblxuICBicmlnaHRuZXNzKGRpc3AsIHZhbCkge1xuICAgIHRoaXMud3JpdGVPbmVEaXNwKGRpc3AsIFsweDBhLCB2YWxdKTsgLy8gMCB0byAxNTtcbiAgfVxuXG4gIGJyaWdodG5lc3NBbGwodmFsKSB7XG4gICAgdGhpcy53cml0ZUFsbERpc3AoWzB4MGEsIHZhbF0pOyAvLyAwIHRvIDE1O1xuICB9XG5cbiAgd3JpdGVBbGxEaXNwKGRhdGEpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtT2ZEaXNwOyBpKyspIHtcbiAgICAgIHRoaXMud3JpdGVPbmVEaXNwKGksIGRhdGEpO1xuICAgIH1cbiAgfVxuXG4gIHdyaXRlT25lRGlzcChkaXNwLCBkYXRhKSB7XG4gICAgdGhpcy5jcy5vdXRwdXQoZmFsc2UpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGlzcDsgaSsrKSB7XG4gICAgICB0aGlzLnNwaS53cml0ZShbMHgwMCwgMHgwMF0pO1xuICAgIH1cbiAgICB0aGlzLnNwaS53cml0ZShkYXRhKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtT2ZEaXNwIC0gKGRpc3AgKyAxKTsgaSsrKSB7XG4gICAgICB0aGlzLnNwaS53cml0ZShbMHgwMCwgMHgwMF0pO1xuICAgIH1cbiAgICB0aGlzLmNzLm91dHB1dCh0cnVlKTtcbiAgfVxuXG4gIHNldE51bWJlcihkaXNwLCBkaWdpdCwgbnVtYmVyLCBkcCkge1xuICAgIGlmIChkaWdpdCA+PSAwICYmIGRpZ2l0IDw9IHRoaXMuZGlnaXRzIC0gMSkge1xuICAgICAgdGhpcy53cml0ZU9uZURpc3AoZGlzcCwgW2RpZ2l0ICsgMSwgdGhpcy5lbmNvZGVCQ0QobnVtYmVyLCBkcCldKTtcbiAgICB9XG4gIH1cblxuICBlbmNvZGVCQ0QoZGVjaW1hbCwgZHApIHtcbiAgICBsZXQgZHByZWc7XG4gICAgaWYgKGRwID09IHRydWUpIHtcbiAgICAgIGRwcmVnID0gMHg4MDtcbiAgICB9IGVsc2Uge1xuICAgICAgZHByZWcgPSAweDAwO1xuICAgIH1cbiAgICBpZiAoZGVjaW1hbCA+PSAwICYmIGRlY2ltYWwgPD0gOSkge1xuICAgICAgcmV0dXJuIGRlY2ltYWwgfCBkcHJlZztcbiAgICB9IGVsc2UgaWYgKGRlY2ltYWwgPT0gJy0nIHx8IGRlY2ltYWwgPT0gMTApIHtcbiAgICAgIHJldHVybiAweDBhIHwgZHByZWc7XG4gICAgfSBlbHNlIGlmIChkZWNpbWFsID09ICdlJyB8fCBkZWNpbWFsID09IDExKSB7XG4gICAgICByZXR1cm4gMHgwYiB8IGRwcmVnO1xuICAgIH0gZWxzZSBpZiAoZGVjaW1hbCA9PSAnaCcgfHwgZGVjaW1hbCA9PSAxMikge1xuICAgICAgcmV0dXJuIDB4MGMgfCBkcHJlZztcbiAgICB9IGVsc2UgaWYgKGRlY2ltYWwgPT0gJ2wnIHx8IGRlY2ltYWwgPT0gMTMpIHtcbiAgICAgIHJldHVybiAweDBkIHwgZHByZWc7XG4gICAgfSBlbHNlIGlmIChkZWNpbWFsID09ICdwJyB8fCBkZWNpbWFsID09IDE0KSB7XG4gICAgICByZXR1cm4gMHgwZSB8IGRwcmVnO1xuICAgIH0gZWxzZSBpZiAoZGVjaW1hbCA9PSAnb24nKSB7XG4gICAgICAvLyBsaWdodCBhbGwgc2VnbWVudHNcbiAgICAgIHJldHVybiAweDg4O1xuICAgIH0gZWxzZSBpZiAoZGVjaW1hbCA9PSAnb2ZmJykge1xuICAgICAgcmV0dXJuIDB4MGYgfCBkcHJlZztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDB4MGYgfCBkcHJlZztcbiAgICB9XG4gIH1cbn1cblxuaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gXzdTZWdtZW50TEVEX01BWDcyMTk7XG59XG4iXX0=
