"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
const i2cParts = require('../../i2cParts');
class SH200Q extends i2cParts {
    static info() {
        return {
            name: 'SH200Q',
        };
    }
    constructor() {
        super();
        this.commands = {};
        this.commands.whoami = 0x30;
        this.commands.accConfig = 0x0e;
        this.commands.gyroConfig = 0x0f;
        this.commands.gyroDlpf = 0x11;
        this.commands.fifoConfig = 0x12;
        this.commands.accRange = 0x16;
        this.commands.gyroRange = 0x2b;
        this.commands.outputAcc = 0x00;
        this.commands.outputGyro = 0x06;
        this.commands.outputTemp = 0x0c;
        this.commands.regSet1 = 0xba;
        this.commands.regSet2 = 0xca;
        this.commands.adcReset = 0xc2;
        this.commands.softReset = 0x7f;
        this.commands.reset = 0x75;
    }
    wired(obniz) {
        super.wired(obniz);
    }
    i2cInfo() {
        return {
            address: 0x6c,
            clock: 100000,
            voltage: '3v',
        };
    }
    whoamiWait() {
        return this.readWait(this.commands.whoami, 1)[0];
    }
    initWait() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.resetAdcWait();
            yield this.writeFlagWait(0xd8, 7);
            yield this.obniz.wait(1);
            yield this.clearFlagWait(0xd8, 7);
            yield this.write(0x78, 0x61);
            yield this.obniz.wait(1);
            yield this.write(0x78, 0x00);
            //set acc odr 256hz
            yield this.write(this.commands.accConfig, 0x91);
            //set gyro odr 500hz
            yield this.write(this.commands.gyroConfig, 0x13);
            //set gyro dlpf 50hz
            yield this.write(this.commands.gyroDlpf, 0x03);
            //set no buffer mode
            yield this.write(this.commands.fifoConfig, 0x00);
            this.setConfig(8, 2000);
            yield this.write(this.commands.regSet1, 0xc0);
            //ADC Reset
            yield this.writeFlagWait(this.commands.regSet2, 4);
            yield this.obniz.wait(1);
            yield this.clearFlagWait(this.commands.regSet2, 4);
            yield this.obniz.wait(10);
        });
    }
    setConfig(accelerometer_range, gyroscope_range) {
        //accel range set (0x00:2g, 0x08:4g, 0x10:8g, 0x18:16g)
        switch (accelerometer_range) {
            case 4:
                this.write(this.commands.accRange, 0x00);
                break;
            case 8:
                this.write(this.commands.accRange, 0x01);
                break;
            case 16:
                this.write(this.commands.accRange, 0x10);
                break;
            default:
                throw new Error('accel_range variable 4,8,16 setting');
        }
        //gyro range & LPF set (0x00:250, 0x08:500, 0x10:1000, 0x18:2000[deg/s])
        switch (gyroscope_range) {
            case 125:
                this.write(this.commands.gyroRange, 0x04);
                break;
            case 250:
                this.write(this.commands.gyroRange, 0x03);
                break;
            case 500:
                this.write(this.commands.gyroRange, 0x02);
                break;
            case 1000:
                this.write(this.commands.gyroRange, 0x01);
                break;
            case 2000:
                this.write(this.commands.gyroRange, 0x00);
                break;
            default:
                throw new Error('gyroscope_range variable 125,250,500,1000,2000 setting');
        }
        this._accel_range = accelerometer_range;
        this._gyro_range = gyroscope_range;
    }
    resetAdcWait() {
        return __awaiter(this, void 0, void 0, function* () {
            //set 0xC2 bit2 1-->0
            let tempdata = yield this.readWait(this.commands.adcReset, 1);
            tempdata[0] = tempdata[0] | 0x04; //tempdata[0] = 0x0E; //CC
            this.write(this.commands.adcReset, tempdata);
            yield this.obniz.wait(1);
            tempdata[0] = tempdata[0] & 0xfb; //tempdata[0] = 0x0A; //C8
            this.write(this.commands.adcReset, tempdata);
        });
    }
    getAllDataWait() {
        return __awaiter(this, void 0, void 0, function* () {
            let raw_data = yield this.readWait(this.commands.outputAcc, 14); //request all data
            let ac_scale = this._accel_range / 32768;
            let gy_scale = this._gyro_range / 32768;
            const accelerometer = {
                x: this.char2short(raw_data[0], raw_data[1]) * ac_scale,
                y: this.char2short(raw_data[2], raw_data[3]) * ac_scale,
                z: this.char2short(raw_data[4], raw_data[5]) * ac_scale,
            };
            const gyroscope = {
                x: this.char2short(raw_data[6], raw_data[7]) * gy_scale,
                y: this.char2short(raw_data[8], raw_data[9]) * gy_scale,
                z: this.char2short(raw_data[10], raw_data[11]) * gy_scale,
            };
            const temperature = this.char2short(raw_data[12], raw_data[13]) / 333.87 + 21.0;
            return {
                accelerometer,
                temperature,
                gyroscope,
            };
        });
    }
    getTempWait() {
        return __awaiter(this, void 0, void 0, function* () {
            let raw_data = yield this.readWait(this.commands.outputTemp, 2); //request all data
            return this.char2short(raw_data[1], raw_data[0]) / 333.87 + 21.0;
        });
    }
    getAccelWait() {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.getAllDataWait()).accelerometer;
        });
    }
    getGyroWait() {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.getAllDataWait()).gyroscope;
        });
    }
}
if (typeof module === 'object') {
    module.exports = SH200Q;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9Nb3ZlbWVudFNlbnNvci9TSDIwMFEvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBRTNDLE1BQU0sTUFBTyxTQUFRLFFBQVE7SUFDM0IsTUFBTSxDQUFDLElBQUk7UUFDVCxPQUFPO1lBQ0wsSUFBSSxFQUFFLFFBQVE7U0FDZixDQUFDO0lBQ0osQ0FBQztJQUVEO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFFNUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQy9CLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztRQUNoQyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDOUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUM5QixJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFDL0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQy9CLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztRQUNoQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7UUFDaEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQzdCLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUM3QixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsR0FBRyxJQUFJ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QUFDLE1BQU0sSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDO1FBQ2pELENBQUM7S0FBQTtDQUNGO0FBRUQsSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUU7SUFDOUIsTUFBTSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7Q0FDekIiLCJmaWxlIjoicGFydHMvTW92ZW1lbnRTZW5zb3IvU0gyMDBRL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaTJjUGFydHMgPSByZXF1aXJlKCcuLi8uLi9pMmNQYXJ0cycpO1xuXG5jbGFzcyBTSDIwMFEgZXh0ZW5kcyBpMmNQYXJ0cyB7XG4gIHN0YXRpYyBpbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiAnU0gyMDBRJyxcbiAgICB9O1xuICB9XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmNvbW1hbmRzID0ge307XG4gICAgdGhpcy5jb21tYW5kcy53aG9hbWkgPSAweDMwO1xuXG4gICAgdGhpcy5jb21tYW5kcy5hY2NDb25maWcgPSAweDBlO1xuICAgIHRoaXMuY29tbWFuZHMuZ3lyb0NvbmZpZyA9IDB4MGY7XG4gICAgdGhpcy5jb21tYW5kcy5neXJvRGxwZiA9IDB4MTE7XG4gICAgdGhpcy5jb21tYW5kcy5maWZvQ29uZmlnID0gMHgxMjtcbiAgICB0aGlzLmNvbW1hbmRzLmFjY1JhbmdlID0gMHgxNjtcbiAgICB0aGlzLmNvbW1hbmRzLmd5cm9SYW5nZSA9IDB4MmI7XG4gICAgdGhpcy5jb21tYW5kcy5vdXRwdXRBY2MgPSAweDAwO1xuICAgIHRoaXMuY29tbWFuZHMub3V0cHV0R3lybyA9IDB4MDY7XG4gICAgdGhpcy5jb21tYW5kcy5vdXRwdXRUZW1wID0gMHgwYztcbiAgICB0aGlzLmNvbW1hbmRzLnJlZ1NldDEgPSAweGJhO1xuICAgIHRoaXMuY29tbWFuZHMucmVnU2V0MiA9IDB4Y2E7XG4gICAgdGhpcy5jb21tYW5kcy5hZGNSZXNldCA9IDB4YzI7XG4gICAgdGhpcy5jb21tYW5kcy5zb2Z0UmVzZXQgPSAweDdmO1xuICAgIHRoaXMuY29tbWFuZHMucmVzZXQgPSAweDc1O1xuICB9XG5cbiAgd2lyZWQob2JuaXopIHtcbiAgICBzdXBlci53aXJlZChvYm5peik7XG4gIH1cblxuICBpMmNJbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBhZGRyZXNzOiAweDZjLFxuICAgICAgY2xvY2s6IDEwMDAwMCxcbiAgICAgIHZvbHRhZ2U6ICczdicsXG4gICAgfTtcbiAgfVxuXG4gIHdob2FtaVdhaXQoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVhZFdhaXQodGhpcy5jb21tYW5kcy53aG9hbWksIDEpWzBdO1xuICB9XG5cbiAgYXN5bmMgaW5pdFdhaXQoKSB7XG4gICAgYXdhaXQgdGhpcy5yZXNldEFkY1dhaXQoKTtcblxuICAgIGF3YWl0IHRoaXMud3JpdGVGbGFnV2FpdCgweGQ4LCA3KTtcbiAgICBhd2FpdCB0aGlzLm9ibml6LndhaXQoMSk7XG4gICAgYXdhaXQgdGhpcy5jbGVhckZsYWdXYWl0KDB4ZDgsIDcpO1xuXG4gICAgYXdhaXQgdGhpcy53cml0ZSgweDc4LCAweDYxKTtcbiAgICBhd2FpdCB0aGlzLm9ibml6LndhaXQoMSk7XG4gICAgYXdhaXQgdGhpcy53cml0ZSgweDc4LCAweDAwKTtcblxuICAgIC8vc2V0IGFjYyBvZHIgMjU2aHpcbiAgICBhd2FpdCB0aGlzLndyaXRlKHRoaXMuY29tbWFuZHMuYWNjQ29uZmlnLCAweDkxKTtcblxuICAgIC8vc2V0IGd5cm8gb2RyIDUwMGh6XG4gICAgYXdhaXQgdGhpcy53cml0ZSh0aGlzLmNvbW1hbmRzLmd5cm9Db25maWcsIDB4MTMpO1xuXG4gICAgLy9zZXQgZ3lybyBkbHBmIDUwaHpcbiAgICBhd2FpdCB0aGlzLndyaXRlKHRoaXMuY29tbWFuZHMuZ3lyb0RscGYsIDB4MDMpO1xuXG4gICAgLy9zZXQgbm8gYnVmZmVyIG1vZGVcbiAgICBhd2FpdCB0aGlzLndyaXRlKHRoaXMuY29tbWFuZHMuZmlmb0NvbmZpZywgMHgwMCk7XG5cbiAgICB0aGlzLnNldENvbmZpZyg4LCAyMDAwKTtcblxuICAgIGF3YWl0IHRoaXMud3JpdGUodGhpcy5jb21tYW5kcy5yZWdTZXQxLCAweGMwKTtcblxuICAgIC8vQURDIFJlc2V0XG4gICAgYXdhaXQgdGhpcy53cml0ZUZsYWdXYWl0KHRoaXMuY29tbWFuZHMucmVnU2V0MiwgNCk7XG4gICAgYXdhaXQgdGhpcy5vYm5pei53YWl0KDEpO1xuICAgIGF3YWl0IHRoaXMuY2xlYXJGbGFnV2FpdCh0aGlzLmNvbW1hbmRzLnJlZ1NldDIsIDQpO1xuICAgIGF3YWl0IHRoaXMub2JuaXoud2FpdCgxMCk7XG4gIH1cblxuICBzZXRDb25maWcoYWNjZWxlcm9tZXRlcl9yYW5nZSwgZ3lyb3Njb3BlX3JhbmdlKSB7XG4gICAgLy9hY2NlbCByYW5nZSBzZXQgKDB4MDA6MmcsIDB4MDg6NGcsIDB4MTA6OGcsIDB4MTg6MTZnKVxuICAgIHN3aXRjaCAoYWNjZWxlcm9tZXRlcl9yYW5nZSkge1xuICAgICAgY2FzZSA0OlxuICAgICAgICB0aGlzLndyaXRlKHRoaXMuY29tbWFuZHMuYWNjUmFuZ2UsIDB4MDApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgODpcbiAgICAgICAgdGhpcy53cml0ZSh0aGlzLmNvbW1hbmRzLmFjY1JhbmdlLCAweDAxKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDE2OlxuICAgICAgICB0aGlzLndyaXRlKHRoaXMuY29tbWFuZHMuYWNjUmFuZ2UsIDB4MTApO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignYWNjZWxfcmFuZ2UgdmFyaWFibGUgNCw4LDE2IHNldHRpbmcnKTtcbiAgICB9XG4gICAgLy9neXJvIHJhbmdlICYgTFBGIHNldCAoMHgwMDoyNTAsIDB4MDg6NTAwLCAweDEwOjEwMDAsIDB4MTg6MjAwMFtkZWcvc10pXG4gICAgc3dpdGNoIChneXJvc2NvcGVfcmFuZ2UpIHtcbiAgICAgIGNhc2UgMTI1OlxuICAgICAgICB0aGlzLndyaXRlKHRoaXMuY29tbWFuZHMuZ3lyb1JhbmdlLCAweDA0KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI1MDpcbiAgICAgICAgdGhpcy53cml0ZSh0aGlzLmNvbW1hbmRzLmd5cm9SYW5nZSwgMHgwMyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA1MDA6XG4gICAgICAgIHRoaXMud3JpdGUodGhpcy5jb21tYW5kcy5neXJvUmFuZ2UsIDB4MDIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTAwMDpcbiAgICAgICAgdGhpcy53cml0ZSh0aGlzLmNvbW1hbmRzLmd5cm9SYW5nZSwgMHgwMSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyMDAwOlxuICAgICAgICB0aGlzLndyaXRlKHRoaXMuY29tbWFuZHMuZ3lyb1JhbmdlLCAweDAwKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ2d5cm9zY29wZV9yYW5nZSB2YXJpYWJsZSAxMjUsMjUwLDUwMCwxMDAwLDIwMDAgc2V0dGluZydcbiAgICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5fYWNjZWxfcmFuZ2UgPSBhY2NlbGVyb21ldGVyX3JhbmdlO1xuICAgIHRoaXMuX2d5cm9fcmFuZ2UgPSBneXJvc2NvcGVfcmFuZ2U7XG4gIH1cblxuICBhc3luYyByZXNldEFkY1dhaXQoKSB7XG4gICAgLy9zZXQgMHhDMiBiaXQyIDEtLT4wXG4gICAgbGV0IHRlbXBkYXRhID0gYXdhaXQgdGhpcy5yZWFkV2FpdCh0aGlzLmNvbW1hbmRzLmFkY1Jlc2V0LCAxKTtcbiAgICB0ZW1wZGF0YVswXSA9IHRlbXBkYXRhWzBdIHwgMHgwNDsgLy90ZW1wZGF0YVswXSA9IDB4MEU7IC8vQ0NcbiAgICB0aGlzLndyaXRlKHRoaXMuY29tbWFuZHMuYWRjUmVzZXQsIHRlbXBkYXRhKTtcbiAgICBhd2FpdCB0aGlzLm9ibml6LndhaXQoMSk7XG4gICAgdGVtcGRhdGFbMF0gPSB0ZW1wZGF0YVswXSAmIDB4ZmI7IC8vdGVtcGRhdGFbMF0gPSAweDBBOyAvL0M4XG4gICAgdGhpcy53cml0ZSh0aGlzLmNvbW1hbmRzLmFkY1Jlc2V0LCB0ZW1wZGF0YSk7XG4gIH1cblxuICBhc3luYyBnZXRBbGxEYXRhV2FpdCgpIHtcbiAgICBsZXQgcmF3X2RhdGEgPSBhd2FpdCB0aGlzLnJlYWRXYWl0KHRoaXMuY29tbWFuZHMub3V0cHV0QWNjLCAxNCk7IC8vcmVxdWVzdCBhbGwgZGF0YVxuICAgIGxldCBhY19zY2FsZSA9IHRoaXMuX2FjY2VsX3JhbmdlIC8gMzI3Njg7XG4gICAgbGV0IGd5X3NjYWxlID0gdGhpcy5fZ3lyb19yYW5nZSAvIDMyNzY4O1xuXG4gICAgY29uc3QgYWNjZWxlcm9tZXRlciA9IHtcbiAgICAgIHg6IHRoaXMuY2hhcjJzaG9ydChyYXdfZGF0YVswXSwgcmF3X2RhdGFbMV0pICogYWNfc2NhbGUsXG4gICAgICB5OiB0aGlzLmNoYXIyc2hvcnQocmF3X2RhdGFbMl0sIHJhd19kYXRhWzNdKSAqIGFjX3NjYWxlLFxuICAgICAgejogdGhpcy5jaGFyMnNob3J0KHJhd19kYXRhWzRdLCByYXdfZGF0YVs1XSkgKiBhY19zY2FsZSxcbiAgICB9O1xuICAgIGNvbnN0IGd5cm9zY29wZSA9IHtcbiAgICAgIHg6IHRoaXMuY2hhcjJzaG9ydChyYXdfZGF0YVs2XSwgcmF3X2RhdGFbN10pICogZ3lfc2NhbGUsXG4gICAgICB5OiB0aGlzLmNoYXIyc2hvcnQocmF3X2RhdGFbOF0sIHJhd19kYXRhWzldKSAqIGd5X3NjYWxlLFxuICAgICAgejogdGhpcy5jaGFyMnNob3J0KHJhd19kYXRhWzEwXSwgcmF3X2RhdGFbMTFdKSAqIGd5X3NjYWxlLFxuICAgIH07XG5cbiAgICBjb25zdCB0ZW1wZXJhdHVyZSA9XG4gICAgICB0aGlzLmNoYXIyc2hvcnQocmF3X2RhdGFbMTJdLCByYXdfZGF0YVsxM10pIC8gMzMzLjg3ICsgMjEuMDtcblxuICAgIHJldHVybiB7XG4gICAgICBhY2NlbGVyb21ldGVyLFxuICAgICAgdGVtcGVyYXR1cmUsXG4gICAgICBneXJvc2NvcGUsXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGdldFRlbXBXYWl0KCkge1xuICAgIGxldCByYXdfZGF0YSA9IGF3YWl0IHRoaXMucmVhZFdhaXQodGhpcy5jb21tYW5kcy5vdXRwdXRUZW1wLCAyKTsgLy9yZXF1ZXN0IGFsbCBkYXRhXG4gICAgcmV0dXJuIHRoaXMuY2hhcjJzaG9ydChyYXdfZGF0YVsxXSwgcmF3X2RhdGFbMF0pIC8gMzMzLjg3ICsgMjEuMDtcbiAgfVxuXG4gIGFzeW5jIGdldEFjY2VsV2FpdCgpIHtcbiAgICByZXR1cm4gKGF3YWl0IHRoaXMuZ2V0QWxsRGF0YVdhaXQoKSkuYWNjZWxlcm9tZXRlcjtcbiAgfVxuXG4gIGFzeW5jIGdldEd5cm9XYWl0KCkge1xuICAgIHJldHVybiAoYXdhaXQgdGhpcy5nZXRBbGxEYXRhV2FpdCgpKS5neXJvc2NvcGU7XG4gIH1cbn1cblxuaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gU0gyMDBRO1xufVxuIl19
