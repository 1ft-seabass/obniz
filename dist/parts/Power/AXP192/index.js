"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
class AXP192 {
    constructor() {
        this.requiredKeys = [];
        this.keys = ['sda', 'scl', 'i2c'];
    }
    static info() {
        return {
            name: 'AXP192',
        };
    }
    wired(obniz) {
        this.params.mode = 'master'; //for i2c
        this.params.clock = 400 * 1000; //for i2c
        this.i2c = obniz.getI2CWithConfig(this.params);
    }
    // Module functions
    set(address, data) {
        this.i2c.write(AXP192_ADDRESS, [address, data]);
    }
    getWait(address) {
        return __awaiter(this, void 0, void 0, function* () {
            this.i2c.write(AXP192_ADDRESS, [address]);
            return yield this.i2c.readWait(AXP192_ADDRESS, 1);
        });
    }
    setLDO2Voltage(voltage) {
        return __awaiter(this, void 0, void 0, function* () {
            if (voltage < 1.8) {
                voltage = 1.8;
            }
            if (voltage > 3.3) {
                voltage = 3.3;
            }
            let set = yield this.getWait(REG_VOLT_SET_LDO2_3);
            let offset = (voltage - 1.8) * 10;
            if (offset > 15) {
                offset = 15;
            }
            set = (set & 0x0f) | (offset << 4);
            console.log('set voltage to ', set);
            this.set(REG_VOLT_SET_LDO2_3, set);
        });
    }
    setLDO3Voltage(voltage) {
        return __awaiter(this, void 0, void 0, function* () {
            if (voltage < 1.8) {
                voltage = 1.8;
            }
            if (voltage > 3.3) {
                voltage = 3.3;
            }
            let set = yield this.getWait(REG_VOLT_SET_LDO2_3);
            let offset = (voltage - 1.8) * 10;
            if (offset > 15) {
                offset = 15;
            }
            set = (set & 0xf0) | offset;
            this.set(REG_VOLT_SET_LDO2_3, set);
        });
    }
    set3VLDO2_3() {
        this.set(REG_VOLT_SET_LDO2_3, 0xcc);
    }
    enableLDO2_3() {
        this.set(REG_EN_DC1_LDO2_3, 0x4d);
    }
    toggleLDO2(val) {
        return __awaiter(this, void 0, void 0, function* () {
            const bit = val ? 1 : 0;
            let state = yield this.getWait(REG_EN_DC1_LDO2_3);
            state = (state & LDO2_EN_MASK) | (bit << 2);
            this.set(REG_EN_DC1_LDO2_3, state);
        });
    }
    toggleLDO3(val) {
        return __awaiter(this, void 0, void 0, function* () {
            const bit = val ? 1 : 0;
            let state = yield this.getWait(REG_EN_DC1_LDO2_3);
            state = (state & LDO3_EN_MASK) | (bit << 3);
            this.set(REG_EN_DC1_LDO2_3, state);
        });
    }
    initM5StickC() {
        this.i2c.write(AXP192_ADDRESS, [REG_EN_EXT_DC2, 0xff]);
        this.i2c.write(AXP192_ADDRESS, [REG_VOLT_SET_LDO2_3, 0xcc]);
        this.i2c.write(AXP192_ADDRESS, [REG_ADC_EN1, 0xff]);
        this.i2c.write(AXP192_ADDRESS, [REG_CHARGE_CTRL1, 0xc0]);
        this.i2c.write(AXP192_ADDRESS, [REG_CCOUNTER, 0x80]);
        this.i2c.write(AXP192_ADDRESS, [REG_EN_DC1_LDO2_3, 0x4d]);
        this.i2c.write(AXP192_ADDRESS, [REG_PEK, 0x0c]);
        this.i2c.write(AXP192_ADDRESS, [REG_GPIO0, 0x02]);
        this.i2c.write(AXP192_ADDRESS, [REG_VBUS_IPSOUT, 0xe0]);
        this.i2c.write(AXP192_ADDRESS, [REG_CHARGE_OVTEMP, 0xfc]);
        this.i2c.write(AXP192_ADDRESS, [REG_BCKUP_BAT, 0xa2]);
    }
    getVbat() {
        return __awaiter(this, void 0, void 0, function* () {
            this.i2c.write(AXP192_ADDRESS, [REG_VBAT_LSB]);
            let vbat_lsb = yield this.readWait(AXP192_ADDRESS, 1);
            this.i2c.write(AXP192_ADDRESS, [REG_VBAT_MSB]);
            let vbat_msb = yield this.readWait(AXP192_ADDRESS, 1);
            return (vbat_lsb << 4) + vbat_msb;
        });
    }
}
if (typeof module === 'object') {
    module.exports = AXP192;
}
const AXP192_ADDRESS = 0x34;
const REG_EN_EXT_DC2 = 0x10;
const REG_EN_DC1_LDO2_3 = 0x12;
const REG_VOLT_SET_LDO2_3 = 0x28;
const REG_VBUS_IPSOUT = 0x30;
const REG_CHARGE_CTRL1 = 0x33;
const REG_BCKUP_BAT = 0x35;
const REG_PEK = 0x36;
const REG_CHARGE_OVTEMP = 0x39;
const REG_VBAT_LSB = 0x78;
const REG_VBAT_MSB = 0x79;
const REG_ADC_EN1 = 0x82;
const REG_GPIO0 = 0x90;
const REG_CCOUNTER = 0xb8;
const LDO2_EN_MASK = 0xfb;
const LDO3_EN_MASK = 0xf7;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9Qb3dlci9BWFAxOTIvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLE1BQU0sTUFBTTtJQUNWO1FBQ0UsSUFBSSxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUVELE1BQU0sQ0FBQyxJQUFJO1FBQ1QsT0FBTztZQUNMLElBQUksRUFBRSxRQUFRO1NBQ2YsQ0FBQztJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsS0FBSztRQUNULElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxDQUFDLFNBQVM7UUFDdEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLFNBQVM7UUFDekMsSUFBSSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRCxtQkFBbUI7SUFDbkIsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJO1FBQ2YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVLLE9BQU8sQ0FBQyxPQUFPOztZQUNuQixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQzFDLE9BQU8sTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDcEQsQ0FBQztLQUFBO0lBRUssY0FBYyxDQUFDLE9BQU87O1lBQzFCLElBQUksT0FBTyxHQUFHLEdBQUcsRUFBRTtnQkFDakIsT0FBTyxH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UUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN0RCxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQy9DLElBQUksUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDdEQsT0FBTyxDQUFDLFFBQVEsSUFBSSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUM7UUFDcEMsQ0FBQztLQUFBO0NBQ0Y7QUFFRCxJQUFJLE9BQU8sTUFBTSxLQUFLLFFBQVEsRUFBRTtJQUM5QixNQUFNLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztDQUN6QjtBQUVELE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQztBQUU1QixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUM7QUFDNUIsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUM7QUFDL0IsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUM7QUFDakMsTUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDO0FBQzdCLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO0FBQzlCLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQztBQUMzQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFDckIsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUM7QUFDL0IsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDO0FBQzFCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQztBQUMxQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUM7QUFDekIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDO0FBQ3ZCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQztBQUUxQixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUM7QUFDMUIsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDIiwiZmlsZSI6InBhcnRzL1Bvd2VyL0FYUDE5Mi9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEFYUDE5MiB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMucmVxdWlyZWRLZXlzID0gW107XG4gICAgdGhpcy5rZXlzID0gWydzZGEnLCAnc2NsJywgJ2kyYyddO1xuICB9XG5cbiAgc3RhdGljIGluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6ICdBWFAxOTInLFxuICAgIH07XG4gIH1cblxuICB3aXJlZChvYm5peikge1xuICAgIHRoaXMucGFyYW1zLm1vZGUgPSAnbWFzdGVyJzsgLy9mb3IgaTJjXG4gICAgdGhpcy5wYXJhbXMuY2xvY2sgPSA0MDAgKiAxMDAwOyAvL2ZvciBpMmNcbiAgICB0aGlzLmkyYyA9IG9ibml6LmdldEkyQ1dpdGhDb25maWcodGhpcy5wYXJhbXMpO1xuICB9XG5cbiAgLy8gTW9kdWxlIGZ1bmN0aW9uc1xuICBzZXQoYWRkcmVzcywgZGF0YSkge1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbYWRkcmVzcywgZGF0YV0pO1xuICB9XG5cbiAgYXN5bmMgZ2V0V2FpdChhZGRyZXNzKSB7XG4gICAgdGhpcy5pMmMud3JpdGUoQVhQMTkyX0FERFJFU1MsIFthZGRyZXNzXSk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuaTJjLnJlYWRXYWl0KEFYUDE5Ml9BRERSRVNTLCAxKTtcbiAgfVxuXG4gIGFzeW5jIHNldExETzJWb2x0YWdlKHZvbHRhZ2UpIHtcbiAgICBpZiAodm9sdGFnZSA8IDEuOCkge1xuICAgICAgdm9sdGFnZSA9IDEuODtcbiAgICB9XG4gICAgaWYgKHZvbHRhZ2UgPiAzLjMpIHtcbiAgICAgIHZvbHRhZ2UgPSAzLjM7XG4gICAgfVxuICAgIGxldCBzZXQgPSBhd2FpdCB0aGlzLmdldFdhaXQoUkVHX1ZPTFRfU0VUX0xETzJfMyk7XG4gICAgbGV0IG9mZnNldCA9ICh2b2x0YWdlIC0gMS44KSAqIDEwO1xuICAgIGlmIChvZmZzZXQgPiAxNSkge1xuICAgICAgb2Zmc2V0ID0gMTU7XG4gICAgfVxuICAgIHNldCA9IChzZXQgJiAweDBmKSB8IChvZmZzZXQgPDwgNCk7XG4gICAgY29uc29sZS5sb2coJ3NldCB2b2x0YWdlIHRvICcsIHNldCk7XG4gICAgdGhpcy5zZXQoUkVHX1ZPTFRfU0VUX0xETzJfMywgc2V0KTtcbiAgfVxuXG4gIGFzeW5jIHNldExETzNWb2x0YWdlKHZvbHRhZ2UpIHtcbiAgICBpZiAodm9sdGFnZSA8IDEuOCkge1xuICAgICAgdm9sdGFnZSA9IDEuODtcbiAgICB9XG4gICAgaWYgKHZvbHRhZ2UgPiAzLjMpIHtcbiAgICAgIHZvbHRhZ2UgPSAzLjM7XG4gICAgfVxuICAgIGxldCBzZXQgPSBhd2FpdCB0aGlzLmdldFdhaXQoUkVHX1ZPTFRfU0VUX0xETzJfMyk7XG4gICAgbGV0IG9mZnNldCA9ICh2b2x0YWdlIC0gMS44KSAqIDEwO1xuICAgIGlmIChvZmZzZXQgPiAxNSkge1xuICAgICAgb2Zmc2V0ID0gMTU7XG4gICAgfVxuICAgIHNldCA9IChzZXQgJiAweGYwKSB8IG9mZnNldDtcbiAgICB0aGlzLnNldChSRUdfVk9MVF9TRVRfTERPMl8zLCBzZXQpO1xuICB9XG5cbiAgc2V0M1ZMRE8yXzMoKSB7XG4gICAgdGhpcy5zZXQoUkVHX1ZPTFRfU0VUX0xETzJfMywgMHhjYyk7XG4gIH1cblxuICBlbmFibGVMRE8yXzMoKSB7XG4gICAgdGhpcy5zZXQoUkVHX0VOX0RDMV9MRE8yXzMsIDB4NGQpO1xuICB9XG5cbiAgYXN5bmMgdG9nZ2xlTERPMih2YWwpIHtcbiAgICBjb25zdCBiaXQgPSB2YWwgPyAxIDogMDtcbiAgICBsZXQgc3RhdGUgPSBhd2FpdCB0aGlzLmdldFdhaXQoUkVHX0VOX0RDMV9MRE8yXzMpO1xuICAgIHN0YXRlID0gKHN0YXRlICYgTERPMl9FTl9NQVNLKSB8IChiaXQgPDwgMik7XG4gICAgdGhpcy5zZXQoUkVHX0VOX0RDMV9MRE8yXzMsIHN0YXRlKTtcbiAgfVxuXG4gIGFzeW5jIHRvZ2dsZUxETzModmFsKSB7XG4gICAgY29uc3QgYml0ID0gdmFsID8gMSA6IDA7XG4gICAgbGV0IHN0YXRlID0gYXdhaXQgdGhpcy5nZXRXYWl0KFJFR19FTl9EQzFfTERPMl8zKTtcbiAgICBzdGF0ZSA9IChzdGF0ZSAmIExETzNfRU5fTUFTSykgfCAoYml0IDw8IDMpO1xuICAgIHRoaXMuc2V0KFJFR19FTl9EQzFfTERPMl8zLCBzdGF0ZSk7XG4gIH1cblxuICBpbml0TTVTdGlja0MoKSB7XG4gICAgdGhpcy5pMmMud3JpdGUoQVhQMTkyX0FERFJFU1MsIFtSRUdfRU5fRVhUX0RDMiwgMHhmZl0pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX1ZPTFRfU0VUX0xETzJfMywgMHhjY10pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX0FEQ19FTjEsIDB4ZmZdKTtcbiAgICB0aGlzLmkyYy53cml0ZShBWFAxOTJfQUREUkVTUywgW1JFR19DSEFSR0VfQ1RSTDEsIDB4YzBdKTtcbiAgICB0aGlzLmkyYy53cml0ZShBWFAxOTJfQUREUkVTUywgW1JFR19DQ09VTlRFUiwgMHg4MF0pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX0VOX0RDMV9MRE8yXzMsIDB4NGRdKTtcbiAgICB0aGlzLmkyYy53cml0ZShBWFAxOTJfQUREUkVTUywgW1JFR19QRUssIDB4MGNdKTtcbiAgICB0aGlzLmkyYy53cml0ZShBWFAxOTJfQUREUkVTUywgW1JFR19HUElPMCwgMHgwMl0pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX1ZCVVNfSVBTT1VULCAweGUwXSk7XG4gICAgdGhpcy5pMmMud3JpdGUoQVhQMTkyX0FERFJFU1MsIFtSRUdfQ0hBUkdFX09WVEVNUCwgMHhmY10pO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX0JDS1VQX0JBVCwgMHhhMl0pO1xuICB9XG5cbiAgYXN5bmMgZ2V0VmJhdCgpIHtcbiAgICB0aGlzLmkyYy53cml0ZShBWFAxOTJfQUREUkVTUywgW1JFR19WQkFUX0xTQl0pO1xuICAgIGxldCB2YmF0X2xzYiA9IGF3YWl0IHRoaXMucmVhZFdhaXQoQVhQMTkyX0FERFJFU1MsIDEpO1xuICAgIHRoaXMuaTJjLndyaXRlKEFYUDE5Ml9BRERSRVNTLCBbUkVHX1ZCQVRfTVNCXSk7XG4gICAgbGV0IHZiYXRfbXNiID0gYXdhaXQgdGhpcy5yZWFkV2FpdChBWFAxOTJfQUREUkVTUywgMSk7XG4gICAgcmV0dXJuICh2YmF0X2xzYiA8PCA0KSArIHZiYXRfbXNiO1xuICB9XG59XG5cbmlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jykge1xuICBtb2R1bGUuZXhwb3J0cyA9IEFYUDE5Mjtcbn1cblxuY29uc3QgQVhQMTkyX0FERFJFU1MgPSAweDM0O1xuXG5jb25zdCBSRUdfRU5fRVhUX0RDMiA9IDB4MTA7XG5jb25zdCBSRUdfRU5fREMxX0xETzJfMyA9IDB4MTI7XG5jb25zdCBSRUdfVk9MVF9TRVRfTERPMl8zID0gMHgyODtcbmNvbnN0IFJFR19WQlVTX0lQU09VVCA9IDB4MzA7XG5jb25zdCBSRUdfQ0hBUkdFX0NUUkwxID0gMHgzMztcbmNvbnN0IFJFR19CQ0tVUF9CQVQgPSAweDM1O1xuY29uc3QgUkVHX1BFSyA9IDB4MzY7XG5jb25zdCBSRUdfQ0hBUkdFX09WVEVNUCA9IDB4Mzk7XG5jb25zdCBSRUdfVkJBVF9MU0IgPSAweDc4O1xuY29uc3QgUkVHX1ZCQVRfTVNCID0gMHg3OTtcbmNvbnN0IFJFR19BRENfRU4xID0gMHg4MjtcbmNvbnN0IFJFR19HUElPMCA9IDB4OTA7XG5jb25zdCBSRUdfQ0NPVU5URVIgPSAweGI4O1xuXG5jb25zdCBMRE8yX0VOX01BU0sgPSAweGZiO1xuY29uc3QgTERPM19FTl9NQVNLID0gMHhmNztcbiJdfQ==
