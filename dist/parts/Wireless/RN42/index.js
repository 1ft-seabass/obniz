"use strict";
class RN42 {
    constructor() {
        this.keys = ['tx', 'rx', 'gnd'];
        this.requiredKeys = ['tx', 'rx'];
    }
    static info() {
        return {
            name: 'RN42',
        };
    }
    wired(obniz) {
        if (obniz.isValidIO(this.params.gnd)) {
            obniz.getIO(this.params.gnd).output(false);
        }
        this.uart = obniz.getFreeUart();
        this.uart.start({
            tx: this.params.tx,
            rx: this.params.rx,
            baud: 115200,
            drive: '3v',
        });
        let self = this;
        this.uart.onreceive = (data, text) => {
            // this is not perfect. separation is possible.
            if (text.indexOf('CONNECT') >= 0) {
                console.log('connected');
            }
            else if (text.indexOf('DISCONNECT') >= 0) {
                console.log('disconnected');
            }
            if (typeof self.onreceive === 'function') {
                self.onreceive(data, text);
            }
        };
    }
    send(data) {
        this.uart.send(data);
    }
    sendCommand(data) {
        this.uart.send(data + '\n');
        this.obniz.wait(100);
    }
    enterCommandMode() {
        this.send('$$$');
        this.obniz.wait(100);
    }
    config(json) {
        this.enterCommandMode();
        if (typeof json !== 'object') {
            // TODO: warning
            return;
        }
        // remove noize data
        this.sendCommand('');
        if (json.master_slave) {
            this.config_masterslave(json.master_slave);
        }
        if (json.auth) {
            this.config_auth(json.auth);
        }
        if (json.hid_flag) {
            this.config_HIDflag(json.hid_flag);
        }
        if (json.profile) {
            this.config_profile(json.profile);
        }
        if (json.power) {
            this.config_power(json.power);
        }
        if (json.display_name) {
            this.config_displayName(json.display_name);
        }
        this.config_reboot();
    }
    config_reboot() {
        this.sendCommand('R,1');
    }
    config_masterslave(mode) {
        let val = -1;
        if (typeof mode === 'number') {
            val = mode;
        }
        else if (typeof mode === 'string') {
            let modes = [
                'slave',
                'master',
                'trigger',
                'auto-connect-master',
                'auto-connect-dtr',
                'auto-connect-any',
                'pairing',
            ];
            for (let i = 0; i < modes.length; i++) {
                if (modes[i] === mode) {
                    val = i;
                    break;
                }
            }
        }
        if (val === -1) {
            // TODO: warning
            return;
        }
        this.sendCommand('SM,' + val);
    }
    config_displayName(name) {
        this.sendCommand('SN,' + name);
    }
    // // SH,0200 HID Flag register. Descriptor=keyboard
    config_HIDflag(flag) {
        this.sendCommand('SH,' + flag);
    }
    config_profile(mode) {
        let val = -1;
        if (typeof mode === 'number') {
            val = mode;
        }
        else if (typeof mode === 'string') {
            let modes = [
                'SPP',
                'DUN-DCE',
                'DUN-DTE',
                'MDM-SPP',
                'SPP-DUN-DCE',
                'APL',
                'HID',
            ];
            for (let i = 0; i < modes.length; i++) {
                if (modes[i] === mode) {
                    val = i;
                    break;
                }
            }
        }
        if (val === -1) {
            // TODO: warning
            return;
        }
        this.sendCommand('S~,' + val);
    }
    config_revert_localecho() {
        this.sendCommand('+');
    }
    config_auth(mode) {
        let val = -1;
        if (typeof mode === 'number') {
            val = mode;
        }
        else if (typeof mode === 'string') {
            let modes = ['open', 'ssp-keyboard', 'just-work', 'pincode'];
            for (let i = 0; i < modes.length; i++) {
                if (modes[i] === mode) {
                    val = i;
                    break;
                }
            }
        }
        if (val === -1) {
            // TODO: warning
            return;
        }
        this.sendCommand('SA,' + val);
    }
    config_power(dbm) {
        let val = '0010';
        if (16 > dbm && dbm >= 12) {
            val = '000C';
        }
        else if (12 > dbm && dbm >= 8) {
            val = '0008';
        }
        else if (8 > dbm && dbm >= 4) {
            val = '0004';
        }
        else if (4 > dbm && dbm >= 0) {
            val = '0000';
        }
        else if (0 > dbm && dbm >= -4) {
            val = 'FFFC';
        }
        else if (-4 > dbm && dbm >= -8) {
            val = 'FFF8';
        }
        else if (-8 > dbm) {
            val = 'FFF4';
        }
        this.sendCommand('SY,' + val);
    }
    config_get_setting() {
        this.sendCommand('D');
    }
    config_get_extendSetting() {
        this.sendCommand('E');
    }
}
if (typeof module === 'object') {
    module.exports = RN42;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9XaXJlbGVzcy9STjQyL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxNQUFNLElBQUk7SUFDUjtRQUNFLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVELE1BQU0sQ0FBQyxJQUFJO1FBQ1QsT0FBTztZQUNMLElBQUksRUFBRSxNQUFNO1NBQ2IsQ0FBQztJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsS0FBSztRQUNULElBQUksS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3BDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDNUM7UUFFRCxJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUVoQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUNkLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDbEIsRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUNsQixJQUFJLEVBQUUsTUFBTTtZQUNaLEtBQUssRUFBRSxJQUFJO1NBQ1osQ0FBQyxDQUFDO1FBQ0gsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFO1lBQ25DLCtDQUErQztZQUMvQyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFD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QUFDO1NBQ2Q7YUFBTSxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRTtZQUM5QixHQUFHLEdBQUcsTUFBTSxDQUFDO1NBQ2Q7YUFBTSxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQyxFQUFFO1lBQy9CLEdBQUcsR0FBRyxNQUFNLENBQUM7U0FDZDthQUFNLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsRUFBRTtZQUNoQyxHQUFHLEdBQUcsTUFBTSxDQUFDO1NBQ2Q7YUFBTSxJQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRTtZQUNuQixHQUFHLEdBQUcsTUFBTSxDQUFDO1NBQ2Q7UUFFRCxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsa0JBQWtCO1FBQ2hCLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUVELHdCQUF3QjtRQUN0QixJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLENBQUM7Q0FDRjtBQUVELElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxFQUFFO0lBQzlCLE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0NBQ3ZCIiwiZmlsZSI6InBhcnRzL1dpcmVsZXNzL1JONDIvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBSTjQyIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5rZXlzID0gWyd0eCcsICdyeCcsICdnbmQnXTtcbiAgICB0aGlzLnJlcXVpcmVkS2V5cyA9IFsndHgnLCAncngnXTtcbiAgfVxuXG4gIHN0YXRpYyBpbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiAnUk40MicsXG4gICAgfTtcbiAgfVxuXG4gIHdpcmVkKG9ibml6KSB7XG4gICAgaWYgKG9ibml6LmlzVmFsaWRJTyh0aGlzLnBhcmFtcy5nbmQpKSB7XG4gICAgICBvYm5pei5nZXRJTyh0aGlzLnBhcmFtcy5nbmQpLm91dHB1dChmYWxzZSk7XG4gICAgfVxuXG4gICAgdGhpcy51YXJ0ID0gb2JuaXouZ2V0RnJlZVVhcnQoKTtcblxuICAgIHRoaXMudWFydC5zdGFydCh7XG4gICAgICB0eDogdGhpcy5wYXJhbXMudHgsXG4gICAgICByeDogdGhpcy5wYXJhbXMucngsXG4gICAgICBiYXVkOiAxMTUyMDAsXG4gICAgICBkcml2ZTogJzN2JyxcbiAgICB9KTtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy51YXJ0Lm9ucmVjZWl2ZSA9IChkYXRhLCB0ZXh0KSA9PiB7XG4gICAgICAvLyB0aGlzIGlzIG5vdCBwZXJmZWN0LiBzZXBhcmF0aW9uIGlzIHBvc3NpYmxlLlxuICAgICAgaWYgKHRleHQuaW5kZXhPZignQ09OTkVDVCcpID49IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2Nvbm5lY3RlZCcpO1xuICAgICAgfSBlbHNlIGlmICh0ZXh0LmluZGV4T2YoJ0RJU0NPTk5FQ1QnKSA+PSAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdkaXNjb25uZWN0ZWQnKTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2Ygc2VsZi5vbnJlY2VpdmUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgc2VsZi5vbnJlY2VpdmUoZGF0YSwgdGV4dCk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHNlbmQoZGF0YSkge1xuICAgIHRoaXMudWFydC5zZW5kKGRhdGEpO1xuICB9XG5cbiAgc2VuZENvbW1hbmQoZGF0YSkge1xuICAgIHRoaXMudWFydC5zZW5kKGRhdGEgKyAnXFxuJyk7XG4gICAgdGhpcy5vYm5pei53YWl0KDEwMCk7XG4gIH1cblxuICBlbnRlckNvbW1hbmRNb2RlKCkge1xuICAgIHRoaXMuc2VuZCgnJCQkJyk7XG4gICAgdGhpcy5vYm5pei53YWl0KDEwMCk7XG4gIH1cblxuICBjb25maWcoanNvbikge1xuICAgIHRoaXMuZW50ZXJDb21tYW5kTW9kZSgpO1xuICAgIGlmICh0eXBlb2YganNvbiAhPT0gJ29iamVjdCcpIHtcbiAgICAgIC8vIFRPRE86IHdhcm5pbmdcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gcmVtb3ZlIG5vaXplIGRhdGFcbiAgICB0aGlzLnNlbmRDb21tYW5kKCcnKTtcblxuICAgIGlmIChqc29uLm1hc3Rlcl9zbGF2ZSkge1xuICAgICAgdGhpcy5jb25maWdfbWFzdGVyc2xhdmUoanNvbi5tYXN0ZXJfc2xhdmUpO1xuICAgIH1cbiAgICBpZiAoanNvbi5hdXRoKSB7XG4gICAgICB0aGlzLmNvbmZpZ19hdXRoKGpzb24uYXV0aCk7XG4gICAgfVxuICAgIGlmIChqc29uLmhpZF9mbGFnKSB7XG4gICAgICB0aGlzLmNvbmZpZ19ISURmbGFnKGpzb24uaGlkX2ZsYWcpO1xuICAgIH1cbiAgICBpZiAoanNvbi5wcm9maWxlKSB7XG4gICAgICB0aGlzLmNvbmZpZ19wcm9maWxlKGpzb24ucHJvZmlsZSk7XG4gICAgfVxuICAgIGlmIChqc29uLnBvd2VyKSB7XG4gICAgICB0aGlzLmNvbmZpZ19wb3dlcihqc29uLnBvd2VyKTtcbiAgICB9XG4gICAgaWYgKGpzb24uZGlzcGxheV9uYW1lKSB7XG4gICAgICB0aGlzLmNvbmZpZ19kaXNwbGF5TmFtZShqc29uLmRpc3BsYXlfbmFtZSk7XG4gICAgfVxuICAgIHRoaXMuY29uZmlnX3JlYm9vdCgpO1xuICB9XG5cbiAgY29uZmlnX3JlYm9vdCgpIHtcbiAgICB0aGlzLnNlbmRDb21tYW5kKCdSLDEnKTtcbiAgfVxuXG4gIGNvbmZpZ19tYXN0ZXJzbGF2ZShtb2RlKSB7XG4gICAgbGV0IHZhbCA9IC0xO1xuICAgIGlmICh0eXBlb2YgbW9kZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHZhbCA9IG1vZGU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbW9kZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGxldCBtb2RlcyA9IFtcbiAgICAgICAgJ3NsYXZlJyxcbiAgICAgICAgJ21hc3RlcicsXG4gICAgICAgICd0cmlnZ2VyJyxcbiAgICAgICAgJ2F1dG8tY29ubmVjdC1tYXN0ZXInLFxuICAgICAgICAnYXV0by1jb25uZWN0LWR0cicsXG4gICAgICAgICdhdXRvLWNvbm5lY3QtYW55JyxcbiAgICAgICAgJ3BhaXJpbmcnLFxuICAgICAgXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbW9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKG1vZGVzW2ldID09PSBtb2RlKSB7XG4gICAgICAgICAgdmFsID0gaTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAodmFsID09PSAtMSkge1xuICAgICAgLy8gVE9ETzogd2FybmluZ1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNlbmRDb21tYW5kKCdTTSwnICsgdmFsKTtcbiAgfVxuXG4gIGNvbmZpZ19kaXNwbGF5TmFtZShuYW1lKSB7XG4gICAgdGhpcy5zZW5kQ29tbWFuZCgnU04sJyArIG5hbWUpO1xuICB9XG5cbiAgLy8gLy8gU0gsMDIwMCBISUQgRmxhZyByZWdpc3Rlci4gRGVzY3JpcHRvcj1rZXlib2FyZFxuICBjb25maWdfSElEZmxhZyhmbGFnKSB7XG4gICAgdGhpcy5zZW5kQ29tbWFuZCgnU0gsJyArIGZsYWcpO1xuICB9XG5cbiAgY29uZmlnX3Byb2ZpbGUobW9kZSkge1xuICAgIGxldCB2YWwgPSAtMTtcbiAgICBpZiAodHlwZW9mIG1vZGUgPT09ICdudW1iZXInKSB7XG4gICAgICB2YWwgPSBtb2RlO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBsZXQgbW9kZXMgPSBbXG4gICAgICAgICdTUFAnLFxuICAgICAgICAnRFVOLURDRScsXG4gICAgICAgICdEVU4tRFRFJyxcbiAgICAgICAgJ01ETS1TUFAnLFxuICAgICAgICAnU1BQLURVTi1EQ0UnLFxuICAgICAgICAnQVBMJyxcbiAgICAgICAgJ0hJRCcsXG4gICAgICBdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAobW9kZXNbaV0gPT09IG1vZGUpIHtcbiAgICAgICAgICB2YWwgPSBpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh2YWwgPT09IC0xKSB7XG4gICAgICAvLyBUT0RPOiB3YXJuaW5nXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2VuZENvbW1hbmQoJ1N+LCcgKyB2YWwpO1xuICB9XG5cbiAgY29uZmlnX3JldmVydF9sb2NhbGVjaG8oKSB7XG4gICAgdGhpcy5zZW5kQ29tbWFuZCgnKycpO1xuICB9XG5cbiAgY29uZmlnX2F1dGgobW9kZSkge1xuICAgIGxldCB2YWwgPSAtMTtcbiAgICBpZiAodHlwZW9mIG1vZGUgPT09ICdudW1iZXInKSB7XG4gICAgICB2YWwgPSBtb2RlO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBsZXQgbW9kZXMgPSBbJ29wZW4nLCAnc3NwLWtleWJvYXJkJywgJ2p1c3Qtd29yaycsICdwaW5jb2RlJ107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChtb2Rlc1tpXSA9PT0gbW9kZSkge1xuICAgICAgICAgIHZhbCA9IGk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHZhbCA9PT0gLTEpIHtcbiAgICAgIC8vIFRPRE86IHdhcm5pbmdcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZW5kQ29tbWFuZCgnU0EsJyArIHZhbCk7XG4gIH1cblxuICBjb25maWdfcG93ZXIoZGJtKSB7XG4gICAgbGV0IHZhbCA9ICcwMDEwJztcbiAgICBpZiAoMTYgPiBkYm0gJiYgZGJtID49IDEyKSB7XG4gICAgICB2YWwgPSAnMDAwQyc7XG4gICAgfSBlbHNlIGlmICgxMiA+IGRibSAmJiBkYm0gPj0gOCkge1xuICAgICAgdmFsID0gJzAwMDgnO1xuICAgIH0gZWxzZSBpZiAoOCA+IGRibSAmJiBkYm0gPj0gNCkge1xuICAgICAgdmFsID0gJzAwMDQnO1xuICAgIH0gZWxzZSBpZiAoNCA+IGRibSAmJiBkYm0gPj0gMCkge1xuICAgICAgdmFsID0gJzAwMDAnO1xuICAgIH0gZWxzZSBpZiAoMCA+IGRibSAmJiBkYm0gPj0gLTQpIHtcbiAgICAgIHZhbCA9ICdGRkZDJztcbiAgICB9IGVsc2UgaWYgKC00ID4gZGJtICYmIGRibSA+PSAtOCkge1xuICAgICAgdmFsID0gJ0ZGRjgnO1xuICAgIH0gZWxzZSBpZiAoLTggPiBkYm0pIHtcbiAgICAgIHZhbCA9ICdGRkY0JztcbiAgICB9XG5cbiAgICB0aGlzLnNlbmRDb21tYW5kKCdTWSwnICsgdmFsKTtcbiAgfVxuXG4gIGNvbmZpZ19nZXRfc2V0dGluZygpIHtcbiAgICB0aGlzLnNlbmRDb21tYW5kKCdEJyk7XG4gIH1cblxuICBjb25maWdfZ2V0X2V4dGVuZFNldHRpbmcoKSB7XG4gICAgdGhpcy5zZW5kQ29tbWFuZCgnRScpO1xuICB9XG59XG5cbmlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jykge1xuICBtb2R1bGUuZXhwb3J0cyA9IFJONDI7XG59XG4iXX0=
